# 🖊️ 爱签电子签名 MCP 服务使用指南

## 🎯 概述

**爱签电子签名 MCP 服务**将您现有的完善爱签集成转换为 Model Context Protocol (MCP) 服务，让AI助手能够直接操作电子签名功能。这意味着您可以通过自然语言与AI对话来完成合同签署、用户管理、模板处理等复杂的电子签名操作。

## 🚀 核心优势

### ✨ **AI原生体验**
- 🗣️ **自然语言交互**: "帮我创建一个劳动合同给张三签署"
- 🤖 **智能理解**: AI自动理解业务意图并调用相应的爱签API
- 🔄 **端到端自动化**: 从模板选择到签署完成的全流程自动化

### 🛠️ **完整功能覆盖**
- 📄 合同模板管理和预览
- 👥 用户注册和签署人管理  
- 🖊️ 完整签署流程创建
- 🏢 企业印章制作
- 📊 签署状态查询和文档下载

### 🔒 **企业级安全**
- 🔐 使用现有的爱签API安全机制
- 📝 完整的操作日志记录
- ⚡ 基于生产环境的稳定集成

## 📋 提供的MCP工具

### 1. **create_contract_template** - 创建合同模板
```bash
# AI使用示例：
"使用劳动合同模板TPL001为张三创建一份合同，职位是软件工程师，工资15000"
```

### 2. **create_signing_flow** - 创建完整签署流程  
```bash
# AI使用示例：
"创建一个完整的合同签署流程，合同编号LAB001，包含张三的基本信息"
```

### 3. **register_user** - 预注册用户
```bash  
# AI使用示例：
"在爱签平台注册用户张三，手机号13800138000，身份证330106199001011234"
```

### 4. **get_template_preview** - 获取模板预览
```bash
# AI使用示例：
"预览劳动合同模板，填入张三的信息"
```

### 5. **create_enterprise_seal** - 创建企业印章
```bash
# AI使用示例：
"为公司账户创建一个新的企业印章"
```

### 6. **get_template_list** - 获取可用模板
```bash
# AI使用示例：
"显示所有可用的合同模板"
```

### 7. **test_esign_connection** - 测试API连接
```bash
# AI使用示例：
"测试爱签API连接状态"
```

## 🎭 实际使用场景

### 场景1：员工入职合同签署
```
用户: "新员工张三入职，需要签署劳动合同，他的手机是13800138000，身份证是330106199001011234，职位软件工程师，月薪15000"

AI自动执行：
1. 注册用户张三到爱签平台
2. 选择劳动合同模板
3. 填充合同参数（姓名、职位、工资等）
4. 创建签署流程
5. 发送签署链接给张三
6. 返回合同编号和签署状态
```

### 场景2：批量处理合同
```
用户: "有3个新员工需要签合同：张三、李四、王五，都是软件工程师"

AI自动执行：
1. 批量注册用户
2. 为每人创建独立的合同
3. 生成批量签署链接
4. 提供进度跟踪
```

### 场景3：合同状态管理
```
用户: "查看所有未完成签署的合同状态"

AI自动执行：
1. 查询所有合同状态
2. 筛选未完成的合同
3. 生成状态报告
4. 提供催签建议
```

## ⚙️ 配置和启动

### 1. 检查依赖
确保您的项目已安装必要依赖：
```bash
cd andejiazhengcrm
npm install axios form-data crypto
```

### 2. 验证爱签配置
确保以下环境变量已正确设置：
```bash
ESIGN_APP_ID=141496759
ESIGN_HOST=https://prev.asign.cn  
ESIGN_PRIVATE_KEY=[您的私钥]
ESIGN_NOTIFY_URL=https://crm.andejiazheng.com/api/esign/callback
```

### 3. 启动MCP服务
MCP服务已添加到您的 `.cursor/mcp.json` 配置中：
```json
{
  "esign": {
    "command": "node",
    "args": ["mcp-esign-server.js"],
    "env": {
      "NODE_ENV": "production",
      "ESIGN_APP_ID": "141496759",
      "ESIGN_HOST": "https://prev.asign.cn"
    }
  }
}
```

### 4. 重启Cursor
重启Cursor以加载新的MCP服务配置。

## 💬 AI对话示例

### 基础操作
```
用户: "测试一下爱签连接是否正常"
AI: [调用 test_esign_connection] 
    ✅ 爱签API连接正常，配置验证通过

用户: "显示所有可用的合同模板"  
AI: [调用 get_template_list]
    📋 发现3个模板：劳动合同、服务协议、保密协议

用户: "预览劳动合同模板，员工姓名张三，职位软件工程师"
AI: [调用 get_template_preview]
    🔍 模板预览已生成：[预览链接]
```

### 复杂流程
```
用户: "帮我处理新员工张三的入职签约"
AI: 我来帮您完成张三的入职签约流程：

    1️⃣ 首先注册用户...
    [调用 register_user] ✅ 用户张三注册成功

    2️⃣ 创建劳动合同...  
    [调用 create_signing_flow] ✅ 合同LAB_20241201_001创建成功

    3️⃣ 签署流程已启动...
    📱 张三将收到签署短信通知
    🔗 签署链接: [链接地址]
    
    完成！张三可以通过手机验证码完成合同签署。
```

## 🔧 高级功能

### 资源查询
MCP服务还提供资源查询功能：
- `esign://templates` - 获取模板列表
- `esign://config` - 查看配置状态
- `esign://contracts/status` - 查看合同状态

### 错误处理
AI会自动处理常见错误：
- 网络连接问题
- API配置错误  
- 参数验证失败
- 签名验证问题

### 批量操作
支持批量处理多个合同和用户：
```
用户: "批量处理这个Excel表格中的员工入职合同"
AI: [分析表格] → [批量注册] → [批量创建合同] → [生成报告]
```

## 🚨 注意事项

### 安全考虑
- 🔐 确保私钥安全存储
- 📋 定期检查API调用日志
- ⚡ 使用生产环境配置

### 最佳实践
- 📝 为合同使用有意义的编号规则
- 👥 确保用户信息准确性
- 📊 定期备份重要合同数据

### 故障排除
- 检查网络连接和DNS解析
- 验证爱签API凭据和权限
- 查看MCP服务器日志文件

## 🎉 开始使用

1. 确保MCP服务正常运行
2. 在Cursor中开始与AI对话
3. 使用自然语言描述您的电子签名需求
4. AI将自动调用相应的爱签功能

**示例开始对话：**
```
"我需要为新员工创建一份劳动合同，帮我开始这个流程"
```

AI将引导您完成整个电子签名流程，从用户注册到合同签署完成！

---

🎯 **让AI助手成为您的电子签名专家！** 🖊️✨ 