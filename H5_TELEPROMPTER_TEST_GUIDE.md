# H5主持人端提词器功能测试指南

## 🔧 问题解决

### 404错误已修复

**问题**: `POST /api/zego/quick-start-teleprompter 404 (Not Found)`

**原因**: 后端服务需要重启以加载新的API路由

**解决方案**: 
- ✅ 后端已重新构建并重启
- ✅ API路由已验证正常工作

---

## 🧪 测试步骤

### 1. 清除浏览器缓存

由于HTML文件已更新，需要清除浏览器缓存：

**方法1: 强制刷新（推荐）**
- Windows/Linux: `Ctrl + Shift + R` 或 `Ctrl + F5`
- Mac: `Cmd + Shift + R`

**方法2: 清除缓存**
- Chrome: 打开开发者工具 → Network标签 → 勾选"Disable cache"
- 或者: 设置 → 隐私和安全 → 清除浏览数据 → 选择"缓存的图片和文件"

### 2. 访问H5主持人端页面

```
https://crm.andejiazheng.com/miniprogram/video-interview-host.html?token=YOUR_JWT_TOKEN
```

### 3. 创建房间

1. 输入房间名称
2. 输入你的姓名
3. 点击"创建房间"

### 4. 测试提词器功能

#### 步骤1: 打开提词器控制面板
- 在底部导航栏找到"📝 提词器"按钮（在"翻转"和"结束面试"之间）
- 点击按钮，应该会弹出提词器控制面板

#### 步骤2: 输入提词内容
```
欢迎参加今天的面试！
请先做一下自我介绍。
介绍一下你的工作经验。
```

#### 步骤3: 调整参数（可选）
- 滚动速度: 默认50像素/秒
- 显示高度: 默认中(50%)

#### 步骤4: 一键启动
- 点击"🚀 一键推送并开启"按钮
- 应该看到"正在启动提词器..."的提示
- 成功后会弹出"🚀 提词器已启动！"

### 5. 验证API调用

打开浏览器开发者工具（F12）→ Network标签，查看API请求：

**成功的请求应该是：**
```
POST /api/zego/quick-start-teleprompter
Status: 200 OK
Response: {"success": true, "message": "提词器已启动"}
```

**如果看到401错误：**
- 检查JWT Token是否有效
- 检查Token是否在URL参数中

**如果看到400错误：**
- 检查房间是否已创建
- 检查roomId是否正确

---

## 🐛 常见问题排查

### 问题1: 看不到"提词器"按钮

**可能原因**:
- 浏览器缓存了旧的HTML文件

**解决方案**:
- 强制刷新页面（Ctrl + Shift + R）
- 清除浏览器缓存

### 问题2: 点击按钮没有反应

**可能原因**:
- JavaScript错误

**解决方案**:
- 打开开发者工具（F12）→ Console标签
- 查看是否有JavaScript错误
- 截图错误信息并反馈

### 问题3: API返回404错误

**可能原因**:
- 后端服务未重启

**解决方案**:
- 已修复，后端已重启
- 如果仍有问题，检查后端服务状态：
  ```bash
  pm2 list
  pm2 logs backend-prod
  ```

### 问题4: API返回401错误

**可能原因**:
- JWT Token无效或过期

**解决方案**:
- 重新登录系统获取新的Token
- 确保URL中包含有效的token参数

### 问题5: 提词器启动成功但阿姨端看不到

**可能原因**:
- 阿姨端未加入房间
- 阿姨端未实现提词器显示功能

**解决方案**:
- 确保阿姨端已加入同一个房间
- 检查阿姨端是否有提词器轮询逻辑
- 查看阿姨端控制台日志

---

## 📊 测试检查清单

- [ ] 页面加载正常
- [ ] 底部导航栏显示"📝 提词器"按钮
- [ ] 点击按钮弹出控制面板
- [ ] 控制面板UI显示正常
- [ ] 输入提词内容正常
- [ ] 调整滚动速度正常
- [ ] 调整显示高度正常
- [ ] 点击"一键推送并开启"按钮正常
- [ ] API请求返回200状态码
- [ ] 显示成功提示信息
- [ ] 控制台无JavaScript错误
- [ ] 其他控制按钮（推送、显示、播放、暂停、关闭）正常

---

## 🔍 调试信息

### 后端服务状态
```bash
pm2 list
# backend-prod 应该是 online 状态
```

### 后端日志
```bash
pm2 logs backend-prod --lines 50
```

### API测试命令
```bash
# 测试API是否存在（应该返回401，说明路由存在）
curl -X POST http://localhost:3000/api/zego/quick-start-teleprompter \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer test" \
  -d '{"roomId":"test","content":"test","targetUserIds":["ALL"],"scrollSpeed":50,"displayHeight":"50vh"}' \
  -i
```

---

## ✅ 预期结果

1. **UI层面**:
   - 底部导航栏有5个按钮：麦克风、摄像头、翻转、提词器、结束面试
   - 点击提词器按钮弹出控制面板
   - 控制面板样式美观，主题色为#5DBFB3

2. **功能层面**:
   - 输入提词内容后点击"一键推送并开启"
   - API请求成功返回200
   - 显示"🚀 提词器已启动！"提示
   - 控制台输出"✅ 提词器启动成功"

3. **阿姨端**:
   - 阿姨端自动显示提词器浮层
   - 提词内容开始滚动
   - 显示"主持人控制中"标识

---

## 📞 问题反馈

如果测试过程中遇到问题，请提供以下信息：

1. 浏览器类型和版本
2. 操作系统
3. 错误截图（包括开发者工具的Console和Network标签）
4. 操作步骤
5. 预期结果 vs 实际结果

---

**测试时间**: 2025-11-17  
**版本**: v1.0  
**状态**: ✅ 后端已重启，API已就绪

