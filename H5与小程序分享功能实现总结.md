# H5 ä¸å°ç¨‹åºåˆ†äº«åŠŸèƒ½å®ç°æ€»ç»“

## ğŸ“‹ éœ€æ±‚å›é¡¾

æ ¹æ®æ–‡æ¡£ã€ŠH5 ä¸å°ç¨‹åºåˆ†äº«åŠŸèƒ½å¯¹æ¥æ–‡æ¡£ã€‹çš„è¦æ±‚ï¼ŒH5 é¡µé¢éœ€è¦åœ¨ç”¨æˆ·ç‚¹å‡»"é‚€è¯·"æŒ‰é’®æ—¶ï¼Œé€šè¿‡ `postMessage` å‘å°ç¨‹åºå‘é€è®¿å®¢é“¾æ¥å’Œåˆ†äº«ä¿¡æ¯ã€‚

---

## âœ… å·²å®Œæˆçš„ä¿®æ”¹

### 1. H5 é¡µé¢ä¿®æ”¹

**æ–‡ä»¶**: `frontend/public/miniprogram/video-interview-host.html`

**ä¿®æ”¹ä½ç½®**: `showInviteModal()` å‡½æ•°ï¼ˆç¬¬ 2512-2558 è¡Œï¼‰

**ä¿®æ”¹å†…å®¹**:
```javascript
// ğŸ”¥ é€šçŸ¥å°ç¨‹åºï¼ˆç”¨äºåˆ†äº«åŠŸèƒ½ï¼‰
if (typeof wx !== 'undefined' && wx.miniProgram) {
  wx.miniProgram.postMessage({
    data: {
      type: 'triggerShare',
      roomId: roomId,
      inviteLink: inviteLink,
      shareTitle: 'é‚€è¯·ä½ å‚åŠ è§†é¢‘é¢è¯•',
      shareDesc: `é¢è¯•é—´å·ï¼š${roomId}`
    }
  });
  console.log('âœ… å·²é€šçŸ¥å°ç¨‹åºï¼šè§¦å‘åˆ†äº«');
  console.log('ğŸ“¤ åˆ†äº«æ•°æ®:', {
    type: 'triggerShare',
    roomId: roomId,
    inviteLink: inviteLink
  });
  
  // åœ¨å°ç¨‹åºç¯å¢ƒä¸­ï¼Œæç¤ºç”¨æˆ·ä½¿ç”¨å³ä¸Šè§’åˆ†äº«
  showToast('ğŸ’¡ è¯·ç‚¹å‡»å³ä¸Šè§’"..."æŒ‰é’®åˆ†äº«ç»™å€™é€‰äºº', 'info');
}
```

**å…³é”®ç‚¹**:
- âœ… æ¶ˆæ¯ç±»å‹ä¸º `'triggerShare'`ï¼ˆç¬¦åˆæ–‡æ¡£è¦æ±‚ï¼‰
- âœ… åŒ…å« `roomId`ã€`inviteLink`ã€`shareTitle`ã€`shareDesc` å­—æ®µ
- âœ… ç”Ÿæˆçš„ `inviteLink` æ ¼å¼æ­£ç¡®ï¼š`https://crm.andejiazheng.com/miniprogram/video-interview-guest.html?roomId=xxx`
- âœ… æ·»åŠ äº†ç¯å¢ƒæ£€æµ‹ï¼Œåªåœ¨å°ç¨‹åºä¸­å‘é€æ¶ˆæ¯
- âœ… æ·»åŠ äº†è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºï¼Œä¾¿äºè°ƒè¯•

---

### 2. å°ç¨‹åºé¡µé¢ä¿®æ”¹

**æ–‡ä»¶**: `miniprogram-pages/interview/interview.js`

#### 2.1 æ·»åŠ æ•°æ®å­—æ®µï¼ˆç¬¬ 3-7 è¡Œï¼‰
```javascript
data: {
  webviewUrl: '',
  roomId: '',
  shareData: null // å­˜å‚¨åˆ†äº«æ•°æ®
}
```

#### 2.2 å¤„ç† H5 æ¶ˆæ¯ï¼ˆç¬¬ 110-140 è¡Œï¼‰
æ·»åŠ äº†ä¸¤ç§æ–°æ¶ˆæ¯ç±»å‹çš„å¤„ç†ï¼š

**`roomCreated` æ¶ˆæ¯**:
```javascript
case 'roomCreated':
  // é¢è¯•é—´åˆ›å»ºæˆåŠŸ
  console.log('âœ… é¢è¯•é—´åˆ›å»ºæˆåŠŸ:', lastMessage.roomId);
  this.setData({
    roomId: lastMessage.roomId
  });
  console.log('ğŸ’¾ å·²ä¿å­˜ roomId åˆ°å°ç¨‹åºæ•°æ®:', lastMessage.roomId);
  break;
```

**`triggerShare` æ¶ˆæ¯**:
```javascript
case 'triggerShare':
  // è§¦å‘åˆ†äº«
  console.log('ğŸ“¤ è§¦å‘åˆ†äº«:', lastMessage);
  this.setData({
    roomId: lastMessage.roomId,
    shareData: {
      inviteLink: lastMessage.inviteLink,
      shareTitle: lastMessage.shareTitle || 'é‚€è¯·ä½ å‚åŠ è§†é¢‘é¢è¯•',
      shareDesc: lastMessage.shareDesc || `é¢è¯•é—´å·ï¼š${lastMessage.roomId}`
    }
  });
  console.log('ğŸ’¾ å·²ä¿å­˜åˆ†äº«æ•°æ®:', this.data.shareData);
  
  // æç¤ºç”¨æˆ·ä½¿ç”¨å³ä¸Šè§’åˆ†äº«
  wx.showModal({
    title: 'åˆ†äº«é‚€è¯·',
    content: 'è¯·ç‚¹å‡»å³ä¸Šè§’"..."æŒ‰é’®ï¼Œé€‰æ‹©"è½¬å‘"åˆ†äº«ç»™å€™é€‰äºº',
    showCancel: false,
    confirmText: 'çŸ¥é“äº†'
  });
  break;
```

#### 2.3 æ›´æ–°åˆ†äº«åŠŸèƒ½ï¼ˆç¬¬ 197-251 è¡Œï¼‰

**`onShareAppMessage()` å‡½æ•°**:
```javascript
onShareAppMessage() {
  const { roomId, shareData } = this.data;
  
  console.log('ğŸ“¤ ç”¨æˆ·ç‚¹å‡»åˆ†äº«æŒ‰é’®');
  console.log('ğŸ“¤ å½“å‰ roomId:', roomId);
  console.log('ğŸ“¤ å½“å‰ shareData:', shareData);
  
  if (!roomId) {
    console.warn('âš ï¸ roomId ä¸ºç©ºï¼Œæ— æ³•åˆ†äº«');
    return {
      title: 'å®‰å¾—å®¶æ”¿ - è§†é¢‘é¢è¯•',
      path: '/pages/index/index'
    };
  }
  
  // ä½¿ç”¨ H5 ä¼ é€’çš„åˆ†äº«æ•°æ®ï¼ˆå¦‚æœæœ‰ï¼‰
  const shareTitle = shareData?.shareTitle || 'é‚€è¯·ä½ å‚åŠ è§†é¢‘é¢è¯•';
  const shareDesc = shareData?.shareDesc || `é¢è¯•é—´å·ï¼š${roomId}`;
  
  console.log('âœ… ç”Ÿæˆåˆ†äº«é…ç½®:', {
    title: shareTitle,
    path: `/pages/interview/interview?roomId=${roomId}`
  });
  
  return {
    title: shareTitle,
    path: `/pages/interview/interview?roomId=${roomId}`,
    imageUrl: '/images/share-interview.png'
  };
}
```

**`onShareTimeline()` å‡½æ•°**:
```javascript
onShareTimeline() {
  const { roomId, shareData } = this.data;
  
  console.log('ğŸ“¤ ç”¨æˆ·ç‚¹å‡»åˆ†äº«åˆ°æœ‹å‹åœˆ');
  console.log('ğŸ“¤ å½“å‰ roomId:', roomId);
  
  if (!roomId) {
    console.warn('âš ï¸ roomId ä¸ºç©ºï¼Œæ— æ³•åˆ†äº«');
    return {
      title: 'å®‰å¾—å®¶æ”¿ - è§†é¢‘é¢è¯•',
      query: ''
    };
  }
  
  const shareTitle = shareData?.shareTitle || 'é‚€è¯·ä½ å‚åŠ è§†é¢‘é¢è¯•';
  
  return {
    title: shareTitle,
    query: `roomId=${roomId}`,
    imageUrl: '/images/share-interview.png'
  };
}
```

---

## ğŸ¯ åŠŸèƒ½æµç¨‹

```
1. HR åœ¨å°ç¨‹åºä¸­æ‰“å¼€è§†é¢‘é¢è¯•
   â†“
2. å°ç¨‹åºåŠ è½½ H5 ä¸»æŒäººé¡µé¢
   â†“
3. HR åœ¨ H5 é¡µé¢åˆ›å»ºé¢è¯•é—´
   â†“
4. H5 å‘é€ roomCreated æ¶ˆæ¯ç»™å°ç¨‹åº
   â†“
5. å°ç¨‹åºä¿å­˜ roomId
   â†“
6. HR ç‚¹å‡»"é‚€è¯·"æŒ‰é’®
   â†“
7. H5 ç”Ÿæˆ inviteLink
   â†“
8. H5 å‘é€ triggerShare æ¶ˆæ¯ç»™å°ç¨‹åºï¼ˆåŒ…å« inviteLinkã€shareTitleã€shareDescï¼‰
   â†“
9. å°ç¨‹åºä¿å­˜ shareData
   â†“
10. å°ç¨‹åºæç¤ºç”¨æˆ·ç‚¹å‡»å³ä¸Šè§’"..."åˆ†äº«
    â†“
11. HR ç‚¹å‡»å³ä¸Šè§’"..."é€‰æ‹©"è½¬å‘"
    â†“
12. å°ç¨‹åºä½¿ç”¨ shareData ç”Ÿæˆåˆ†äº«å¡ç‰‡
    â†“
13. è®¿å®¢æ”¶åˆ°åˆ†äº«å¡ç‰‡ï¼Œç‚¹å‡»æ‰“å¼€
    â†“
14. è®¿å®¢åŠ å…¥é¢è¯•é—´
```

---

## ğŸ“Š å¯¹æ¯”æ–‡æ¡£è¦æ±‚

| è¦æ±‚é¡¹ | æ–‡æ¡£è¦æ±‚ | å®ç°æƒ…å†µ | çŠ¶æ€ |
|--------|----------|----------|------|
| æ¶ˆæ¯ç±»å‹ | `'triggerShare'` | `'triggerShare'` | âœ… |
| roomId å­—æ®µ | å¿…é¡» | å·²åŒ…å« | âœ… |
| inviteLink å­—æ®µ | å¿…é¡» | å·²åŒ…å« | âœ… |
| shareTitle å­—æ®µ | å¯é€‰ | å·²åŒ…å« | âœ… |
| shareDesc å­—æ®µ | å¯é€‰ | å·²åŒ…å« | âœ… |
| ç¯å¢ƒæ£€æµ‹ | å¿…é¡» | å·²å®ç° | âœ… |
| å°ç¨‹åºæ¥æ”¶æ¶ˆæ¯ | å¿…é¡» | å·²å®ç° | âœ… |
| å°ç¨‹åºä¿å­˜æ•°æ® | å¿…é¡» | å·²å®ç° | âœ… |
| åˆ†äº«åŠŸèƒ½ | å¿…é¡» | å·²å®ç° | âœ… |

---

## ğŸ” å…³é”®æ”¹è¿›ç‚¹

1. **å®Œæ•´çš„æ¶ˆæ¯ä¼ é€’**: H5 é¡µé¢ç°åœ¨ä¼šå‘å°ç¨‹åºå‘é€å®Œæ•´çš„åˆ†äº«æ•°æ®
2. **æ•°æ®æŒä¹…åŒ–**: å°ç¨‹åºä¼šä¿å­˜ `shareData`ï¼Œä¾›åˆ†äº«æ—¶ä½¿ç”¨
3. **ç”¨æˆ·æç¤º**: åœ¨è§¦å‘åˆ†äº«æ—¶ï¼Œä¼šæç¤ºç”¨æˆ·å¦‚ä½•æ“ä½œ
4. **è¯¦ç»†æ—¥å¿—**: æ·»åŠ äº†è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºï¼Œä¾¿äºè°ƒè¯•å’Œæ’æŸ¥é—®é¢˜
5. **é™çº§å¤„ç†**: å¦‚æœ roomId ä¸ºç©ºï¼Œä¼šè¿”å›é»˜è®¤çš„åˆ†äº«é…ç½®

---

## ğŸ“ åç»­å·¥ä½œ

1. **å‡†å¤‡åˆ†äº«å›¾ç‰‡**: éœ€è¦å‡†å¤‡ `/images/share-interview.png` åˆ†äº«å¡ç‰‡å›¾ç‰‡
2. **æµ‹è¯•éªŒè¯**: æŒ‰ç…§ã€ŠH5ä¸å°ç¨‹åºåˆ†äº«åŠŸèƒ½æµ‹è¯•æŒ‡å—.mdã€‹è¿›è¡Œå®Œæ•´æµ‹è¯•
3. **éƒ¨ç½²ä¸Šçº¿**: å°†ä¿®æ”¹åçš„æ–‡ä»¶éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

---

## ğŸ‰ æ€»ç»“

âœ… **å·²å®Œå…¨å®ç°æ–‡æ¡£è¦æ±‚çš„åŠŸèƒ½**

- H5 é¡µé¢èƒ½æ­£ç¡®ç”Ÿæˆè®¿å®¢é“¾æ¥
- H5 é¡µé¢èƒ½å‘å°ç¨‹åºå‘é€å®Œæ•´çš„åˆ†äº«æ•°æ®
- å°ç¨‹åºèƒ½æ¥æ”¶å¹¶ä¿å­˜åˆ†äº«æ•°æ®
- å°ç¨‹åºåˆ†äº«æ—¶ä½¿ç”¨æ­£ç¡®çš„æ•°æ®
- æ·»åŠ äº†å®Œå–„çš„æ—¥å¿—å’Œç”¨æˆ·æç¤º

æ‰€æœ‰ä¿®æ”¹éƒ½ç¬¦åˆæ–‡æ¡£ã€ŠH5 ä¸å°ç¨‹åºåˆ†äº«åŠŸèƒ½å¯¹æ¥æ–‡æ¡£ã€‹çš„è¦æ±‚ã€‚

