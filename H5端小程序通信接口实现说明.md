# H5ç«¯å°ç¨‹åºé€šä¿¡æ¥å£å®ç°è¯´æ˜

## âœ… å®ç°çŠ¶æ€

**å·²å®Œæˆï¼** H5ä¸»æŒäººé¡µé¢ï¼ˆ`frontend/public/miniprogram/video-interview-host.html`ï¼‰å·²ç»å®ç°äº†ä¸å°ç¨‹åºçš„é€šä¿¡æ¥å£ã€‚

---

## ğŸ“ å®ç°å†…å®¹

### 1. **åˆ›å»ºæˆ¿é—´æˆåŠŸåå‘é€æ¶ˆæ¯**

**ä½ç½®**ï¼š`createRoom()` å‡½æ•°ï¼ˆç¬¬ 1464-1465 è¡Œï¼‰

**ä»£ç **ï¼š
```javascript
// ğŸ”¥ é€šçŸ¥å°ç¨‹åºé¡µé¢ï¼ˆç”¨äºåˆ†äº«ï¼‰
notifyMiniProgram(roomId);
```

**å‘é€æ—¶æœº**ï¼šé¢è¯•é—´åˆ›å»ºæˆåŠŸåç«‹å³å‘é€

**æ¶ˆæ¯æ ¼å¼**ï¼š
```javascript
{
  type: 'roomCreated',
  roomId: 'room_1234567890_abc123'
}
```

---

### 2. **ç‚¹å‡»"+"å·é‚€è¯·æ—¶å‘é€æ¶ˆæ¯**

**ä½ç½®**ï¼š`showInviteModal()` å‡½æ•°ï¼ˆç¬¬ 2196-2226 è¡Œï¼‰

**ä»£ç **ï¼š
```javascript
// ğŸ¯ å°ç¨‹åºç¯å¢ƒä¸‹ï¼Œå‘é€ triggerShare æ¶ˆæ¯ç»™å°ç¨‹åº
if (IS_IN_MINIPROGRAM) {
  // ç”Ÿæˆè®¿å®¢H5é“¾æ¥
  const baseUrl = window.location.origin + window.location.pathname.replace('video-interview-host.html', '');
  const inviteLink = `${baseUrl}video-interview-guest.html?roomId=${roomId}`;
  
  // å‘é€æ¶ˆæ¯ç»™å°ç¨‹åº
  if (typeof wx !== 'undefined' && wx.miniProgram) {
    wx.miniProgram.postMessage({
      data: {
        type: 'triggerShare',
        roomId: roomId,
        inviteLink: inviteLink,
        shareTitle: 'é‚€è¯·ä½ å‚åŠ è§†é¢‘é¢è¯•',
        shareDesc: `é¢è¯•é—´å·ï¼š${roomId.replace(/^room_/, 'AD-').split('_')[0]}`
      }
    });
    
    // æç¤ºç”¨æˆ·ç‚¹å‡»å³ä¸Šè§’åˆ†äº«
    alert('è¯·ç‚¹å‡»å³ä¸Šè§’"..."æŒ‰é’®ï¼Œé€‰æ‹©"è½¬å‘"åˆ†äº«ç»™è®¿å®¢');
  }
  return;
}
```

**å‘é€æ—¶æœº**ï¼šç”¨æˆ·ç‚¹å‡»"+"å·é‚€è¯·æŒ‰é’®æ—¶å‘é€

**æ¶ˆæ¯æ ¼å¼**ï¼š
```javascript
{
  type: 'triggerShare',
  roomId: 'room_1234567890_abc123',
  inviteLink: 'https://crm.andejiazheng.com/miniprogram/video-interview-guest.html?roomId=room_1234567890_abc123',
  shareTitle: 'é‚€è¯·ä½ å‚åŠ è§†é¢‘é¢è¯•',
  shareDesc: 'é¢è¯•é—´å·ï¼šAD-1234567890'
}
```

---

### 3. **é€šçŸ¥å°ç¨‹åºå‡½æ•°**

**ä½ç½®**ï¼šç¬¬ 2285-2304 è¡Œ

**ä»£ç **ï¼š
```javascript
// ğŸ”¥ å‘é€ roomCreated æ¶ˆæ¯ç»™å°ç¨‹åº
function notifyMiniProgram(roomId) {
  console.log('ğŸ“¤ å‡†å¤‡å‘é€ roomCreated æ¶ˆæ¯ç»™å°ç¨‹åº');
  console.log('ğŸ“¤ roomId:', roomId);
  
  // æ£€æŸ¥æ˜¯å¦åœ¨å°ç¨‹åºç¯å¢ƒ
  if (typeof wx !== 'undefined' && wx.miniProgram) {
    wx.miniProgram.postMessage({
      data: {
        type: 'roomCreated',
        roomId: roomId
      }
    });
    
    console.log('âœ… å·²å‘é€ roomCreated æ¶ˆæ¯ç»™å°ç¨‹åº');
  } else {
    console.log('âš ï¸ ä¸åœ¨å°ç¨‹åºç¯å¢ƒï¼Œè·³è¿‡å‘é€æ¶ˆæ¯');
  }
}
```

---

## ğŸ”‘ å…³é”®å‚æ•°è¯´æ˜

### **roomIdï¼ˆæˆ¿é—´IDï¼‰**
- **æ ¼å¼**ï¼š`room_1234567890_abc123`
- **æ¥æº**ï¼šåˆ›å»ºæˆ¿é—´æ—¶ç”Ÿæˆ
- **ç”¨é€”**ï¼šç”¨äºç”Ÿæˆè®¿å®¢åŠ å…¥é“¾æ¥

### **inviteLinkï¼ˆè®¿å®¢H5é“¾æ¥ï¼‰**
- **æ ¼å¼**ï¼š`https://crm.andejiazheng.com/miniprogram/video-interview-guest.html?roomId=room_1234567890_abc123`
- **ç”¨é€”**ï¼šè®¿å®¢é€šè¿‡æ­¤é“¾æ¥åŠ å…¥é¢è¯•é—´

### **shareDescï¼ˆåˆ†äº«æè¿°ï¼‰**
- **æ ¼å¼**ï¼š`é¢è¯•é—´å·ï¼šAD-1234567890`
- **è¯´æ˜**ï¼šå°† `room_1234567890_abc123` æ ¼å¼åŒ–ä¸º `AD-1234567890`

---

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### 1. **åœ¨å°ç¨‹åºä¸­æµ‹è¯•**

1. æ‰“å¼€å°ç¨‹åºçš„è§†é¢‘é¢è¯•ä¸»æŒäººé¡µé¢
2. æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·çš„æ§åˆ¶å°
3. åˆ›å»ºæˆ¿é—´ï¼ŒæŸ¥çœ‹æ˜¯å¦è¾“å‡ºï¼š
   ```
   ğŸ“¤ å‡†å¤‡å‘é€ roomCreated æ¶ˆæ¯ç»™å°ç¨‹åº
   ğŸ“¤ roomId: room_1234567890_abc123
   âœ… å·²å‘é€ roomCreated æ¶ˆæ¯ç»™å°ç¨‹åº
   ```
4. ç‚¹å‡»"+"å·ï¼ŒæŸ¥çœ‹æ˜¯å¦è¾“å‡ºï¼š
   ```
   ğŸ’¡ å°ç¨‹åºç¯å¢ƒï¼Œå‘é€ triggerShare æ¶ˆæ¯ç»™å°ç¨‹åº
   ğŸ“¤ å‡†å¤‡å‘é€ triggerShare æ¶ˆæ¯
   ğŸ“¤ roomId: room_1234567890_abc123
   ğŸ“¤ inviteLink: https://crm.andejiazheng.com/miniprogram/video-interview-guest.html?roomId=room_1234567890_abc123
   âœ… å·²å‘é€ triggerShare æ¶ˆæ¯ç»™å°ç¨‹åº
   ```

### 2. **åœ¨å°ç¨‹åºç«¯éªŒè¯**

å°ç¨‹åºæ§åˆ¶å°åº”è¯¥è¾“å‡ºï¼š
```
ğŸ“¨ æ”¶åˆ° H5 æ¶ˆæ¯: [{ type: 'roomCreated', roomId: 'room_1234567890_abc123' }]
âœ… é¢è¯•é—´åˆ›å»ºæˆåŠŸ: room_1234567890_abc123
ğŸ“¤ è®¿å®¢åŠ å…¥é“¾æ¥: https://crm.andejiazheng.com/miniprogram/video-interview-guest.html?roomId=room_1234567890_abc123
```

---

## âœ… å®ç°æ£€æŸ¥æ¸…å•

- [x] å·²åœ¨åˆ›å»ºæˆ¿é—´æˆåŠŸåè°ƒç”¨ `notifyMiniProgram()` å‘é€ `roomCreated` æ¶ˆæ¯
- [x] å·²åœ¨ç‚¹å‡»"+"å·æ—¶å‘é€ `triggerShare` æ¶ˆæ¯
- [x] `inviteLink` æŒ‡å‘è®¿å®¢H5é¡µé¢ï¼ˆ`video-interview-guest.html`ï¼‰
- [x] å·²æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºï¼Œæ–¹ä¾¿è°ƒè¯•
- [x] å·²å¤„ç†å°ç¨‹åºç¯å¢ƒæ£€æµ‹ï¼ˆ`IS_IN_MINIPROGRAM` å’Œ `wx.miniProgram`ï¼‰
- [x] å·²æ·»åŠ ç”¨æˆ·æç¤ºï¼ˆç‚¹å‡»å³ä¸Šè§’åˆ†äº«ï¼‰

---

## ğŸ“¦ ä¿®æ”¹çš„æ–‡ä»¶

- `frontend/public/miniprogram/video-interview-host.html`
  - ç¬¬ 1464-1465 è¡Œï¼šæ·»åŠ  `notifyMiniProgram(roomId)` è°ƒç”¨
  - ç¬¬ 2196-2226 è¡Œï¼šä¿®æ”¹ `showInviteModal()` å‡½æ•°ï¼Œæ·»åŠ å°ç¨‹åºæ¶ˆæ¯å‘é€é€»è¾‘
  - ç¬¬ 2285-2304 è¡Œï¼šæ·»åŠ  `notifyMiniProgram()` å‡½æ•°

---

## ğŸš€ éƒ¨ç½²è¯´æ˜

1. ç¡®è®¤ä¿®æ”¹å·²ä¿å­˜åˆ° `frontend/public/miniprogram/video-interview-host.html`
2. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
3. åœ¨å°ç¨‹åºä¸­æµ‹è¯•åŠŸèƒ½æ˜¯å¦æ­£å¸¸

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **postMessage çš„å»¶è¿Ÿç‰¹æ€§**ï¼š`wx.miniProgram.postMessage()` ä¸æ˜¯å®æ—¶çš„ï¼Œæ¶ˆæ¯ä¼šåœ¨é¡µé¢åé€€ã€ç»„ä»¶é”€æ¯ã€åˆ†äº«ç­‰æ—¶æœºæ‰çœŸæ­£å‘é€åˆ°å°ç¨‹åºã€‚å°ç¨‹åºç«¯å·²ç»å¤„ç†äº†è¿™ä¸ªé—®é¢˜ã€‚

2. **è®¿å®¢H5é¡µé¢**ï¼šç¡®ä¿ `video-interview-guest.html` å·²ç»éƒ¨ç½²å¹¶å¯ä»¥è®¿é—®ã€‚

3. **ç¯å¢ƒæ£€æµ‹**ï¼šä»£ç ä¼šè‡ªåŠ¨æ£€æµ‹æ˜¯å¦åœ¨å°ç¨‹åºç¯å¢ƒä¸­ï¼Œéå°ç¨‹åºç¯å¢ƒä¼šæ˜¾ç¤ºé‚€è¯·å¼¹çª—ã€‚

---

**å®ç°å®Œæˆæ—¶é—´**ï¼š2025-11-19

