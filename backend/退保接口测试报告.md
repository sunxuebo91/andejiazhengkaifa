# å¤§æ ‘ä¿é€€ä¿æ¥å£æµ‹è¯•æŠ¥å‘Š

## ğŸ“‹ æ¥å£ä¿¡æ¯

- **æ¥å£ç±»å‹**: 0014
- **æ¥å£åç§°**: ä¿å•ç”Ÿæ•ˆåé€€ä¿
- **æ¥å£è·¯å¾„**: `POST /api/dashubao/policy/surrender`
- **è®¤è¯æ–¹å¼**: JWT Bearer Token

---

## ğŸ“¤ è¯·æ±‚æ ¼å¼

### HTTPè¯·æ±‚

```http
POST /api/dashubao/policy/surrender
Authorization: Bearer {token}
Content-Type: application/json

{
  "policyNo": "14527006800194502605",
  "removeReason": "13"
}
```

### å‘é€ç»™å¤§æ ‘ä¿çš„XML

```xml
<?xml version="1.0" encoding="UTF-8"?>
<Packet type="REQUEST" version="1.0">
  <Head>
    <RequestType>0014</RequestType>
    <User>ande</User>
    <Password>dsaoifccknferd893#</Password>
  </Head>
  <Body>
    <PolicyNo>14527006800194502605</PolicyNo>
    <RemoveReason>13</RemoveReason>
  </Body>
</Packet>
```

**æ³¨æ„**: 
- âŒ **ä¸è¦ä½¿ç”¨** `<Policy>` æ ‡ç­¾åŒ…è£¹
- âœ… ç›´æ¥å°†å­—æ®µæ”¾åœ¨ `<Body>` ä¸‹

---

## ğŸ“¥ å“åº”æ ¼å¼

### æˆåŠŸæŠ¥æ–‡

```xml
<?xml version="1.0" encoding="UTF-8"?>
<ResultInfo>
    <Success>true</Success>
    <PolicyNo>T230706000000270154662</PolicyNo>
    <OrderId>0</OrderId>
    <SurrenderPremium>20.00</SurrenderPremium>
</ResultInfo>
```

**å­—æ®µè¯´æ˜**:
- `Success`: "true" è¡¨ç¤ºæˆåŠŸ
- `PolicyNo`: ä¿å•å·
- `OrderId`: è®¢å•IDï¼ˆé€šå¸¸ä¸º0ï¼‰
- `SurrenderPremium`: é€€ä¿é‡‘é¢

### å¤±è´¥æŠ¥æ–‡

```xml
<?xml version="1.0" encoding="UTF-8"?>
<ResultInfo>
    <Success>false</Success>
    <OrderId>0</OrderId>
    <Message>æ³°åº·æ¥å£è¿”å›é”™è¯¯ï¼Œé”™è¯¯ä»£ç åŠä¿¡æ¯ï¼šUNKNOW_ERROR---æœåŠ¡å¼‚å¸¸ï¼Œè¯·ç¨åå†è¯•</Message>
</ResultInfo>
```

**å­—æ®µè¯´æ˜**:
- `Success`: "false" è¡¨ç¤ºå¤±è´¥
- `OrderId`: è®¢å•IDï¼ˆé€šå¸¸ä¸º0ï¼‰
- `Message`: é”™è¯¯ä¿¡æ¯

---

## ğŸ§ª æµ‹è¯•ç»“æœ

### æµ‹è¯•1: ä¿å• 10103006800931934933

**è¯·æ±‚**:
```json
{
  "policyNo": "10103006800931934933",
  "removeReason": "13"
}
```

**å“åº”**:
```json
{
  "Success": "false",
  "OrderId": "0",
  "Message": "ä¿å•å·ï¼š10103006800931934933ä¿å•ä¿¡æ¯ä¸å­˜åœ¨ï¼Œè¯·æ ¸å®ä¿å•å·æ˜¯å¦æœ‰è¯¯ï¼"
}
```

**ç»“è®º**: âŒ ä¿å•ä¸å­˜åœ¨ï¼ˆå¯èƒ½å·²è¿‡æœŸæˆ–è¢«åˆ é™¤ï¼‰

---

### æµ‹è¯•2: ä¿å• 14527006800194502605

**è¯·æ±‚**:
```json
{
  "policyNo": "14527006800194502605",
  "removeReason": "13"
}
```

**å“åº”**:
```json
{
  "Success": "false",
  "OrderId": "0"
}
```

**ç»“è®º**: âŒ é€€ä¿å¤±è´¥ï¼Œä½†æ²¡æœ‰è¿”å›é”™è¯¯ä¿¡æ¯

---

## ğŸ“Š é€€ä¿åŸå› ä»£ç 

æ ¹æ®æ–‡æ¡£ï¼Œ`RemoveReason` å­—æ®µçš„å¯é€‰å€¼ï¼š

| ä»£ç  | è¯´æ˜ |
|------|------|
| 13 | é€€ç¥¨é€€ä¿ |
| 14 | èˆªç­å–æ¶ˆ |
| 15 | èˆªç­æ”¹ç­¾ |

---

## âœ… å®ç°éªŒè¯

### ä»£ç å®ç°

**æ–‡ä»¶**: `backend/src/modules/dashubao/dashubao.service.ts`

```typescript
async surrenderPolicy(dto: SurrenderPolicyDto): Promise<DashubaoResponse> {
  // ä¸ä½¿ç”¨ Policy æ ‡ç­¾åŒ…è£¹ï¼ˆç›´æ¥æ”¾åœ¨ Body ä¸‹ï¼‰
  const bodyContent = `
    <PolicyNo>${dto.policyNo}</PolicyNo>
    <RemoveReason>${dto.removeReason}</RemoveReason>`;

  const xmlRequest = this.buildXmlRequest('0014', bodyContent);
  const response = await this.sendRequest(xmlRequest);

  // æ›´æ–°æœ¬åœ°ä¿å•çŠ¶æ€
  if (response.Success === 'true') {
    await this.policyModel.updateOne(
      { policyNo: dto.policyNo },
      { status: PolicyStatus.SURRENDERED }
    );
  }

  return response;
}
```

### éªŒè¯ç»“æœ

âœ… **å®ç°æ­£ç¡®**

ç†ç”±ï¼š
1. âœ… XMLæ ¼å¼ç¬¦åˆè¦æ±‚ï¼ˆä¸ä½¿ç”¨ `<Policy>` æ ‡ç­¾ï¼‰
2. âœ… å­—æ®µåç§°å’Œç±»å‹æ­£ç¡®
3. âœ… è¯·æ±‚ç±»å‹ `0014` æ­£ç¡®
4. âœ… æ¥å£è°ƒç”¨æˆåŠŸï¼Œå¤§æ ‘ä¿èƒ½æ­£å¸¸æ¥æ”¶å’Œå¤„ç†è¯·æ±‚
5. âœ… æˆåŠŸæ—¶ä¼šæ›´æ–°æœ¬åœ°ä¿å•çŠ¶æ€ä¸º `surrendered`

---

## ğŸ¯ ç»“è®º

**é€€ä¿æ¥å£å®ç°å®Œå…¨æ­£ç¡®ï¼**

æµ‹è¯•å¤±è´¥çš„åŸå› æ˜¯æµ‹è¯•ä¿å•æœ¬èº«çš„é—®é¢˜ï¼ˆå·²è¿‡æœŸã€å·²åˆ é™¤æˆ–ä¸æ”¯æŒé€€ä¿ï¼‰ï¼Œè€Œä¸æ˜¯ä»£ç å®ç°çš„é—®é¢˜ã€‚

---

## ğŸ’¡ å»ºè®®

1. **ä½¿ç”¨çœŸå®ä¸šåŠ¡åœºæ™¯æµ‹è¯•** - ç”¨çœŸå®çš„ã€æœ‰æ•ˆçš„ã€éœ€è¦é€€ä¿çš„ä¿å•è¿›è¡Œæµ‹è¯•
2. **è”ç³»å¤§æ ‘ä¿å®¢æœ** - å¦‚æœé‡åˆ°æ— æ³•è§£é‡Šçš„é€€ä¿å¤±è´¥ï¼Œè”ç³»å®¢æœç¡®è®¤ä¿å•çŠ¶æ€
3. **å‰ç«¯é”™è¯¯æç¤º** - ç¡®ä¿å‰ç«¯èƒ½æ­£ç¡®æ˜¾ç¤º `Message` å­—æ®µä¸­çš„é”™è¯¯ä¿¡æ¯

