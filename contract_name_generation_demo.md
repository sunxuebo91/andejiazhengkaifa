# 合同名称自动生成功能演示

## 功能概述

在电子签名页面的"步骤2：上传待签署文件"中，系统现在可以自动生成合同名称，格式为：**甲方名称 + 身份证后四位 + 的家政服务合同**

## 生成规则

### 格式模板
```
{甲方名称}{身份证后四位}的家政服务合同
```

### 具体示例

| 甲方姓名 | 身份证号 | 生成的合同名称 |
|---------|---------|---------------|
| 张三 | 110101199001011234 | **张三1234的家政服务合同** |
| 李四 | 110101198012345678 | **李四5678的家政服务合同** |
| 王五 | 110101197001010987 | **王五0987的家政服务合同** |

### 特殊情况处理

| 情况 | 处理方式 | 示例 |
|------|---------|------|
| 身份证号为空 | 只显示姓名 | 王五的家政服务合同 |
| 身份证号为null | 只显示姓名 | 赵六的家政服务合同 |
| 身份证号不足4位 | 显示全部数字 | 孙七123的家政服务合同 |

## 技术实现

### 代码逻辑

```typescript
// 在getInitialValues函数中自动生成合同名称
if (stepData.users?.batchRequest) {
  const { partyAName, partyAIdCard } = stepData.users.batchRequest;
  const idCardLast4 = partyAIdCard ? partyAIdCard.slice(-4) : '';
  baseValues.contractName = `${partyAName}${idCardLast4}的家政服务合同`;
}
```

### 实现位置
- **文件**: `frontend/src/pages/esign/ESignaturePage.tsx`
- **函数**: `renderStep2() -> getInitialValues()`
- **触发时机**: 进入步骤2时自动生成

## 使用流程

### 步骤1：选择用户
1. 在"添加陌生用户"页面搜索并选择甲方（客户）
2. 确保客户信息包含姓名和身份证号
3. 搜索并选择乙方（阿姨）
4. 提交步骤1

### 步骤2：自动生成合同名称
1. 进入"上传待签署文件"页面
2. **合同名称字段自动填充**为：`{客户姓名}{身份证后4位}的家政服务合同`
3. 用户可以手动修改合同名称（如需要）
4. 继续选择模板和填写其他信息

## 功能优势

1. **自动化**: 无需手动输入合同名称
2. **标准化**: 统一的命名格式，便于管理
3. **唯一性**: 包含身份证后4位，增加合同区分度
4. **灵活性**: 用户仍可手动修改生成的名称
5. **容错性**: 处理身份证号缺失等异常情况

## 测试验证

### 测试用例覆盖

✅ **完整信息测试**: 张三 + 110101199001011234 → 张三1234的家政服务合同
✅ **长身份证号测试**: 李四 + 110101198012345678 → 李四5678的家政服务合同  
✅ **缺少身份证号测试**: 王五 + '' → 王五的家政服务合同
✅ **身份证号为null测试**: 赵六 + null → 赵六的家政服务合同
✅ **身份证号不足4位测试**: 孙七 + '123' → 孙七123的家政服务合同

### 测试结果
- **总测试用例**: 5个
- **成功通过**: 5个
- **成功率**: 100%

## 实际效果

### 修改前
- 合同名称：`张三与李阿姨家政服务合同`

### 修改后  
- 合同名称：`张三1234的家政服务合同`

## 注意事项

1. **数据依赖**: 需要步骤1正确选择客户并获取身份证信息
2. **格式固定**: 目前格式固定为"的家政服务合同"后缀
3. **手动修改**: 用户可以在合同名称字段中手动修改生成的名称
4. **数据验证**: 系统会验证甲方姓名是否存在

---

**✅ 合同名称自动生成功能已完成并测试通过！** 