# iOS微信视频播放 - 测试指南

## 📱 测试前准备

### 设备要求
- **设备：** iPhone（iOS 14.3或更高版本）
- **浏览器：** 微信内置浏览器
- **网络：** WiFi或4G/5G（建议WiFi）
- **数量：** 至少2台设备（1台主持人 + 1台访客）

### 权限检查
确保微信有以下权限：
- ✅ 摄像头权限
- ✅ 麦克风权限
- ✅ 网络权限

## 🧪 测试场景

### 场景1：访客加入面试（最常见）

#### 步骤1：访客端操作
1. 用iPhone打开微信
2. 扫描或点击访客邀请链接
3. 进入访客页面，输入姓名
4. 选择角色（客户/阿姨）
5. 点击"加入面试"按钮
6. 允许摄像头和麦克风权限

**预期结果：**
- ✅ 能看到自己的视频画面
- ✅ 页面显示"等待主持人..."

#### 步骤2：主持人端操作
1. 另一台设备（可以是PC或手机）打开主持人页面
2. 点击"创建房间"
3. 允许摄像头和麦克风权限

**预期结果（访客端）：**
- ✅ 自动显示主持人的视频画面
- ✅ 能听到主持人的声音
- ✅ 主持人能听到访客的声音
- ✅ **不会出现"播放失败"提示**

#### 步骤3：如果出现播放按钮
如果iOS微信阻止了自动播放，会显示"▶️ 点击播放视频"按钮：

1. 点击播放按钮
2. 视频开始播放
3. 按钮自动消失

**预期结果：**
- ✅ 点击后视频正常播放
- ✅ 能听到声音
- ✅ 按钮消失

### 场景2：主持人在iOS微信中创建房间

#### 步骤1：主持人端操作
1. 用iPhone打开微信
2. 打开主持人页面
3. 点击"创建房间"
4. 允许摄像头和麦克风权限

**预期结果：**
- ✅ 能看到自己的视频画面
- ✅ 显示房间号和邀请按钮

#### 步骤2：访客端操作
1. 另一台设备打开访客页面
2. 输入姓名和角色
3. 点击"加入面试"

**预期结果（主持人端）：**
- ✅ 自动显示访客的视频画面
- ✅ 能听到访客的声音
- ✅ 访客能听到主持人的声音
- ✅ **不会出现"播放失败"提示**

### 场景3：多人面试（3-6人）

#### 测试步骤
1. 主持人创建房间
2. 访客1加入
3. 访客2加入
4. 访客3加入（可选）

**预期结果：**
- ✅ 所有人都能看到其他人的视频
- ✅ 所有人都能听到其他人的声音
- ✅ 视频画面自动排列
- ✅ 没有播放失败的提示

## 🔍 问题排查

### 问题1：看不到自己的视频

**可能原因：**
- 没有允许摄像头权限
- 摄像头被其他应用占用
- 浏览器不支持

**解决方法：**
1. 检查微信的摄像头权限：设置 → 隐私 → 相机 → 微信（开启）
2. 关闭其他使用摄像头的应用
3. 重启微信
4. 查看浏览器控制台错误信息

### 问题2：看不到对方的视频

**可能原因：**
- 对方没有开启摄像头
- 网络连接问题
- SDK播放失败

**解决方法：**
1. 确认对方已成功加入房间
2. 检查网络连接（建议使用WiFi）
3. 如果出现播放按钮，点击播放
4. 查看控制台日志：
   ```
   ✅ 开始播放远程流（SDK自动处理）
   ✅ 远程视频播放成功（有声音）
   ```

### 问题3：听不到声音

**可能原因：**
- 设备静音
- 音量太小
- 对方麦克风关闭
- 远程视频被静音

**解决方法：**
1. 检查设备音量和静音开关
2. 确认对方麦克风已开启
3. 查看控制台日志：
   ```
   🔊 设置远程视频音量为: 1 静音状态: false
   ```
4. 如果静音状态为true，说明代码有问题

### 问题4：仍然提示"播放失败"

**可能原因：**
- 代码未正确更新
- SDK版本问题
- 浏览器兼容性问题

**解决方法：**
1. 确认代码已更新到最新版本
2. 检查是否使用了正确的SDK调用方式：
   ```javascript
   // 应该是这样
   await zg.startPlayingStream(streamID, {
     video: videoElement,
     audio: true
   });
   ```
3. 清除浏览器缓存
4. 查看详细错误信息

## 📊 测试检查清单

### 基础功能测试
- [ ] 访客能看到自己的视频
- [ ] 主持人能看到自己的视频
- [ ] 访客能看到主持人的视频
- [ ] 主持人能看到访客的视频
- [ ] 访客能听到主持人的声音
- [ ] 主持人能听到访客的声音

### iOS微信特定测试
- [ ] 不会出现"播放失败"提示
- [ ] 如果出现播放按钮，点击后能正常播放
- [ ] 播放按钮点击后会消失
- [ ] 视频和音频都正常

### 多人测试
- [ ] 3人同时在线，视频和音频都正常
- [ ] 5人同时在线，视频和音频都正常
- [ ] 有人离开后，视频位置正确更新

### 控制功能测试
- [ ] 麦克风开关正常
- [ ] 摄像头开关正常
- [ ] 主持人能管理访客（关闭麦克风/摄像头）
- [ ] 主持人能移出访客

## 🐛 调试技巧

### 查看控制台日志

在微信中打开调试模式：
1. 微信 → 我 → 设置 → 通用 → 发现页管理
2. 开启"小程序"
3. 在小程序中打开调试

关键日志：
```
✅ 开始播放远程流（SDK自动处理）: stream_xxx
✅ 远程视频播放成功（有声音）: stream_xxx
🔊 当前音量: 1 静音状态: false
```

如果看到错误：
```
❌ 远程视频播放失败: NotAllowedError
⚠️ iOS需要用户交互才能播放，显示播放按钮
```
这是正常的，说明iOS需要用户点击才能播放。

### 网络检查

使用ZEGO SDK的网络质量检测：
```javascript
zg.on('roomStreamUpdate', (roomID, updateType, streamList, extendedData) => {
  console.log('网络质量:', extendedData);
});
```

## ✅ 测试通过标准

### 必须通过的测试
1. ✅ iOS微信中不会出现"播放失败"提示
2. ✅ 能正常看到对方的视频
3. ✅ 能正常听到对方的声音
4. ✅ 如果出现播放按钮，点击后能正常播放

### 可选通过的测试
1. ✅ 多人面试（3-6人）正常
2. ✅ 网络切换（WiFi ↔ 4G）后能自动恢复
3. ✅ 后台切换后能自动恢复

## 📝 测试报告模板

```
测试日期：2025-11-13
测试设备：iPhone 13, iOS 16.5
测试浏览器：微信 8.0.42
测试场景：访客加入面试

测试结果：
✅ 能看到自己的视频
✅ 能看到主持人的视频
✅ 能听到主持人的声音
✅ 主持人能听到访客的声音
✅ 没有出现"播放失败"提示
✅ 播放按钮功能正常

问题：
无

建议：
无

测试人员：XXX
```

## 🎯 总结

通过使用ZEGO SDK推荐的播放方式，iOS微信视频播放问题应该已经解决。如果仍然有问题，请：

1. 检查代码是否正确更新
2. 查看控制台日志
3. 确认SDK版本
4. 联系技术支持

---

**文档更新日期**: 2025-11-13  
**适用版本**: v1.4.0+

