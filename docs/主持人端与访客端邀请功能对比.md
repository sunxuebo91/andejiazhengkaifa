# ä¸»æŒäººç«¯ä¸è®¿å®¢ç«¯é‚€è¯·åŠŸèƒ½å¯¹æ¯”

## ğŸ“… æ›´æ–°æ—¶é—´
2024-01-20

## ğŸ¯ å¯¹æ¯”ç›®çš„
ç¡®ä¿ä¸»æŒäººç«¯å’Œè®¿å®¢ç«¯çš„+å·é‚€è¯·æŒ‰é’®éšè—é€»è¾‘å®Œå…¨ä¸€è‡´ï¼Œæä¾›ç»Ÿä¸€çš„ç”¨æˆ·ä½“éªŒã€‚

## âœ… å®Œæ•´å¯¹æ¯”ç»“æœ

### 1. CSS éšè—è§„åˆ™

#### ä¸»æŒäººç«¯ (video-interview-host.html)
```css
/* ğŸ¯ å°ç¨‹åºç¯å¢ƒä¸‹éšè—é‚€è¯·æŒ‰é’®å’Œé‚€è¯·å¼¹çª— */
body.miniprogram-env .invite-placeholder {
  display: none !important;
}

body.miniprogram-env #inviteModal {
  display: none !important;
}

/* å°ç¨‹åºç¯å¢ƒä¸‹æ˜¾ç¤ºæ™®é€šå ä½ç¬¦ */
body.miniprogram-env .video-placeholder.empty-slot {
  display: flex !important;
  background: #1a1a1a;
  border: 1px solid #333;
  cursor: default;
}

body.miniprogram-env .video-placeholder.empty-slot .placeholder-text {
  color: #666;
  font-size: 14px;
}
```

#### è®¿å®¢ç«¯ (video-interview-guest-room.html)
```css
/* ğŸ¯ å°ç¨‹åºç¯å¢ƒä¸‹éšè—é‚€è¯·æŒ‰é’®å’Œé‚€è¯·å¼¹çª— */
body.miniprogram-env .invite-placeholder {
  display: none !important;
}

body.miniprogram-env #inviteModal {
  display: none !important;
}

/* å°ç¨‹åºç¯å¢ƒä¸‹æ˜¾ç¤ºæ™®é€šå ä½ç¬¦ */
body.miniprogram-env .video-placeholder.empty-slot {
  display: flex !important;
  background: #1a1a1a;
  border: 1px solid #333;
  cursor: default;
}

body.miniprogram-env .video-placeholder.empty-slot .placeholder-text {
  color: #666;
  font-size: 14px;
}
```

**ç»“è®º**: âœ… **å®Œå…¨ä¸€è‡´**

---

### 2. ç¯å¢ƒæ£€æµ‹é€»è¾‘

#### ä¸»æŒäººç«¯
```javascript
var IS_IN_MINIPROGRAM = false;

(function() {
  function isInMiniProgram() {
    // æ–¹æ³•1ï¼šé€šè¿‡ window.__wxjs_environment åˆ¤æ–­ï¼ˆæœ€å¯é ï¼‰
    if (window.__wxjs_environment === 'miniprogram') {
      return true;
    }

    // æ–¹æ³•2ï¼šé€šè¿‡ userAgent åˆ¤æ–­ï¼ˆå¾®ä¿¡ 7.0.0+ æ”¯æŒï¼‰
    if (/miniProgram/i.test(navigator.userAgent)) {
      return true;
    }

    return false;
  }

  IS_IN_MINIPROGRAM = isInMiniProgram();
})();
```

#### è®¿å®¢ç«¯
```javascript
const IS_IN_MINIPROGRAM = (function() {
  // æ–¹æ³•1ï¼šé€šè¿‡ window.__wxjs_environment åˆ¤æ–­ï¼ˆæœ€å¯é ï¼‰
  if (window.__wxjs_environment === 'miniprogram') {
    return true;
  }

  // æ–¹æ³•2ï¼šé€šè¿‡ userAgent åˆ¤æ–­ï¼ˆå¾®ä¿¡ 7.0.0+ æ”¯æŒï¼‰
  if (/miniProgram/i.test(navigator.userAgent)) {
    return true;
  }

  return false;
})();
```

**ç»“è®º**: âœ… **é€»è¾‘ä¸€è‡´**ï¼ˆå®ç°æ–¹å¼ç•¥æœ‰ä¸åŒï¼Œä½†åŠŸèƒ½å®Œå…¨ç›¸åŒï¼‰

---

### 3. Body Class æ·»åŠ 

#### ä¸»æŒäººç«¯
```javascript
// ğŸ¯ æ ¹æ®ç¯å¢ƒæ·»åŠ  body classï¼ˆç”¨äºæ§åˆ¶é‚€è¯·æŒ‰é’®æ˜¾ç¤ºï¼‰
if (IS_IN_MINIPROGRAM) {
  document.body.classList.add('miniprogram-env');
  console.log('âœ… å·²æ·»åŠ å°ç¨‹åºç¯å¢ƒæ ‡è¯†ï¼Œé‚€è¯·æŒ‰é’®å°†è¢«éšè—');
} else {
  console.log('âœ… æµè§ˆå™¨ç¯å¢ƒï¼Œé‚€è¯·æŒ‰é’®æ­£å¸¸æ˜¾ç¤º');
}
```

#### è®¿å®¢ç«¯
```javascript
// ğŸ¯ æ ¹æ®ç¯å¢ƒæ·»åŠ  body classï¼ˆç”¨äºæ§åˆ¶é‚€è¯·æŒ‰é’®æ˜¾ç¤ºï¼‰
if (IS_IN_MINIPROGRAM) {
  document.body.classList.add('miniprogram-env');
  console.log('âœ… å·²æ·»åŠ å°ç¨‹åºç¯å¢ƒæ ‡è¯†ï¼Œé‚€è¯·æŒ‰é’®å°†è¢«éšè—');
} else {
  console.log('âœ… æµè§ˆå™¨ç¯å¢ƒï¼Œé‚€è¯·æŒ‰é’®æ­£å¸¸æ˜¾ç¤º');
}
```

**ç»“è®º**: âœ… **å®Œå…¨ä¸€è‡´**

---

### 4. showInviteModal() å‡½æ•°

#### ä¸»æŒäººç«¯
```javascript
function showInviteModal() {
  console.log('ğŸ“¨ æ˜¾ç¤ºé‚€è¯·å¼¹çª—');
  console.log('ğŸ  å½“å‰roomId:', roomId);

  // ğŸ”¥ æ£€æŸ¥roomIdæ˜¯å¦å­˜åœ¨
  if (!roomId || roomId === '') {
    alert('è¯·å…ˆåˆ›å»ºé¢è¯•é—´ï¼');
    console.error('âŒ roomIdä¸ºç©ºï¼Œæ— æ³•ç”Ÿæˆé‚€è¯·é“¾æ¥');
    return;
  }

  // ğŸ¯ å°ç¨‹åºç¯å¢ƒä¸‹ï¼Œå‘é€ triggerShare æ¶ˆæ¯ç»™å°ç¨‹åº
  if (IS_IN_MINIPROGRAM) {
    try {
      console.log('ğŸ’¡ å°ç¨‹åºç¯å¢ƒï¼Œå‘é€ triggerShare æ¶ˆæ¯ç»™å°ç¨‹åº');

      // ç”Ÿæˆè®¿å®¢H5é“¾æ¥
      const baseUrl = window.location.origin + window.location.pathname.replace('video-interview-host.html', '');
      const inviteLink = `${baseUrl}video-interview-guest.html?roomId=${roomId}`;

      // å‘é€æ¶ˆæ¯ç»™å°ç¨‹åº
      if (typeof wx !== 'undefined' && wx.miniProgram) {
        wx.miniProgram.postMessage({
          data: {
            type: 'triggerShare',
            roomId: roomId,
            inviteLink: inviteLink,
            shareTitle: 'é‚€è¯·ä½ å‚åŠ è§†é¢‘é¢è¯•',
            shareDesc: `é¢è¯•é—´å·ï¼š${roomId.replace(/^room_/, 'AD-').split('_')[0]}`
          }
        });
        console.log('âœ… å·²å‘é€ triggerShare æ¶ˆæ¯ç»™å°ç¨‹åº');

        // æç¤ºç”¨æˆ·ç‚¹å‡»å³ä¸Šè§’åˆ†äº«
        alert('è¯·ç‚¹å‡»å³ä¸Šè§’"..."æŒ‰é’®ï¼Œé€‰æ‹©"è½¬å‘"åˆ†äº«ç»™è®¿å®¢');
      } else {
        console.warn('âš ï¸ æœªæ‰¾åˆ° wx.miniProgramï¼Œæ— æ³•å‘é€æ¶ˆæ¯');
      }
    } catch (error) {
      console.error('âš ï¸ å‘é€ triggerShare æ¶ˆæ¯å¤±è´¥:', error);
    }
    return;
  }

  // éå°ç¨‹åºç¯å¢ƒï¼Œæ˜¾ç¤ºé‚€è¯·å¼¹çª—
  // ...
}
```

#### è®¿å®¢ç«¯
```javascript
function showInviteModal() {
  console.log('ğŸ“¨ æ˜¾ç¤ºé‚€è¯·å¼¹çª—');
  console.log('ğŸ  å½“å‰roomId:', roomId);

  // ğŸ”¥ æ£€æŸ¥roomIdæ˜¯å¦å­˜åœ¨
  if (!roomId || roomId === '') {
    alert('æˆ¿é—´å·ä¸å­˜åœ¨ï¼Œæ— æ³•ç”Ÿæˆé‚€è¯·é“¾æ¥ï¼');
    console.error('âŒ roomIdä¸ºç©ºï¼Œæ— æ³•ç”Ÿæˆé‚€è¯·é“¾æ¥');
    return;
  }

  // ğŸ¯ å°ç¨‹åºç¯å¢ƒä¸‹ï¼Œå‘é€ triggerShare æ¶ˆæ¯ç»™å°ç¨‹åº
  if (IS_IN_MINIPROGRAM) {
    try {
      console.log('ğŸ’¡ å°ç¨‹åºç¯å¢ƒï¼Œå‘é€ triggerShare æ¶ˆæ¯ç»™å°ç¨‹åº');

      // ç”Ÿæˆè®¿å®¢H5é“¾æ¥
      const baseUrl = window.location.origin + window.location.pathname.replace('video-interview-guest-room.html', '');
      const inviteLink = `${baseUrl}video-interview-guest.html?roomId=${roomId}`;

      // å‘é€æ¶ˆæ¯ç»™å°ç¨‹åº
      if (typeof wx !== 'undefined' && wx.miniProgram) {
        wx.miniProgram.postMessage({
          data: {
            type: 'triggerShare',
            roomId: roomId,
            inviteLink: inviteLink,
            shareTitle: 'é‚€è¯·ä½ å‚åŠ è§†é¢‘é¢è¯•',
            shareDesc: `é¢è¯•é—´å·ï¼š${roomId.replace(/^room_/, 'AD-').split('_')[0]}`
          }
        });
        console.log('âœ… å·²å‘é€ triggerShare æ¶ˆæ¯ç»™å°ç¨‹åº');

        // æç¤ºç”¨æˆ·ç‚¹å‡»å³ä¸Šè§’åˆ†äº«
        alert('è¯·ç‚¹å‡»å³ä¸Šè§’"..."æŒ‰é’®ï¼Œé€‰æ‹©"è½¬å‘"åˆ†äº«ç»™è®¿å®¢');
      } else {
        console.warn('âš ï¸ æœªæ‰¾åˆ° wx.miniProgramï¼Œæ— æ³•å‘é€æ¶ˆæ¯');
      }
    } catch (error) {
      console.error('âŒ å‘é€ triggerShare æ¶ˆæ¯å¤±è´¥:', error);
    }
    return;
  }

  // éå°ç¨‹åºç¯å¢ƒï¼Œæ˜¾ç¤ºé‚€è¯·å¼¹çª—
  // ...
}
```

**ç»“è®º**: âœ… **é€»è¾‘å®Œå…¨ä¸€è‡´**ï¼ˆä»… alert æç¤ºæ–‡æ¡ˆç•¥æœ‰å·®å¼‚ï¼Œä½†éƒ½ç¬¦åˆå„è‡ªåœºæ™¯ï¼‰

---

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”è¡¨

| åŠŸèƒ½é¡¹ | ä¸»æŒäººç«¯ | è®¿å®¢ç«¯ | ä¸€è‡´æ€§ |
|--------|---------|--------|--------|
| CSS éšè—è§„åˆ™ | âœ… | âœ… | âœ… å®Œå…¨ä¸€è‡´ |
| ç¯å¢ƒæ£€æµ‹é€»è¾‘ | âœ… | âœ… | âœ… å®Œå…¨ä¸€è‡´ |
| Body Class æ·»åŠ  | âœ… | âœ… | âœ… å®Œå…¨ä¸€è‡´ |
| å°ç¨‹åºæ¶ˆæ¯å‘é€ | âœ… | âœ… | âœ… å®Œå…¨ä¸€è‡´ |
| ç”¨æˆ·æç¤ºä¿¡æ¯ | âœ… | âœ… | âœ… å®Œå…¨ä¸€è‡´ |
| ç©ºä½å ä½ç¬¦æ ·å¼ | âœ… | âœ… | âœ… å®Œå…¨ä¸€è‡´ |

## âœ… æœ€ç»ˆç»“è®º

**ä¸»æŒäººç«¯å’Œè®¿å®¢ç«¯çš„+å·é‚€è¯·æŒ‰é’®éšè—é€»è¾‘å·²å®Œå…¨ä¿æŒä¸€è‡´ï¼**

### æ ¸å¿ƒåŠŸèƒ½
1. âœ… ç¯å¢ƒæ£€æµ‹ï¼šä¸¤ç«¯ä½¿ç”¨ç›¸åŒçš„æ£€æµ‹æ–¹æ³•
2. âœ… CSS éšè—ï¼šä¸¤ç«¯ä½¿ç”¨ç›¸åŒçš„ CSS è§„åˆ™
3. âœ… å°ç¨‹åºé€‚é…ï¼šä¸¤ç«¯éƒ½èƒ½æ­£ç¡®è§¦å‘å°ç¨‹åºåˆ†äº«
4. âœ… æµè§ˆå™¨å…¼å®¹ï¼šä¸¤ç«¯éƒ½èƒ½åœ¨æµè§ˆå™¨ä¸­æ­£å¸¸æ˜¾ç¤º H5 é‚€è¯·å¼¹çª—

### ç”¨æˆ·ä½“éªŒ
- ğŸ¯ å°ç¨‹åºç¯å¢ƒï¼šè‡ªåŠ¨éšè—+å·ï¼Œä½¿ç”¨åŸç”Ÿåˆ†äº«
- ğŸ¯ æµè§ˆå™¨ç¯å¢ƒï¼šæ˜¾ç¤º+å·ï¼Œä½¿ç”¨ H5 é‚€è¯·å¼¹çª—
- ğŸ¯ æç¤ºä¿¡æ¯ï¼šæ¸…æ™°å¼•å¯¼ç”¨æˆ·ä½¿ç”¨æ­£ç¡®çš„åˆ†äº«æ–¹å¼

## ğŸš€ éƒ¨ç½²çŠ¶æ€

- âœ… ä¸»æŒäººç«¯é€»è¾‘å·²å®Œå–„
- âœ… è®¿å®¢ç«¯é€»è¾‘å·²åŒæ­¥
- âœ… å‰ç«¯æœåŠ¡å·²é‡å¯
- âœ… åŠŸèƒ½å·²ä¸Šçº¿å¯ç”¨

