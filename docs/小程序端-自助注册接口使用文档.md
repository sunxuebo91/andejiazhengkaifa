# å°ç¨‹åºç«¯ - é˜¿å§¨è‡ªåŠ©æ³¨å†Œæ¥å£ä½¿ç”¨æ–‡æ¡£

**ç‰ˆæœ¬**: v1.0.0  
**æ›´æ–°æ—¥æœŸ**: 2025-10-17  
**çŠ¶æ€**: âœ… ç”Ÿäº§ç¯å¢ƒå·²éƒ¨ç½²

---

## ğŸ“‹ ç›®å½•

1. [æ¥å£æ¦‚è¿°](#æ¥å£æ¦‚è¿°)
2. [åˆ›å»ºæ¥æºè¯´æ˜](#åˆ›å»ºæ¥æºè¯´æ˜) â­ æ–°å¢
3. [å®Œæ•´ä½¿ç”¨æµç¨‹](#å®Œæ•´ä½¿ç”¨æµç¨‹)
4. [OCRè¯†åˆ«æ¥å£](#ocrè¯†åˆ«æ¥å£)
5. [è‡ªåŠ©æ³¨å†Œæ¥å£](#è‡ªåŠ©æ³¨å†Œæ¥å£)
6. [é”™è¯¯å¤„ç†](#é”™è¯¯å¤„ç†)
7. [å®Œæ•´ä»£ç ç¤ºä¾‹](#å®Œæ•´ä»£ç ç¤ºä¾‹)
8. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## æ¥å£æ¦‚è¿°

é˜¿å§¨è‡ªåŠ©æ³¨å†ŒåŠŸèƒ½åŒ…å«ä¸¤ä¸ªä¸»è¦æ¥å£ï¼š

| æ¥å£ | ç”¨é€” | è®¤è¯ |
|------|------|------|
| OCRè¯†åˆ«æ¥å£ | è¯†åˆ«èº«ä»½è¯ä¿¡æ¯ | âœ… æ— éœ€ç™»å½• |
| è‡ªåŠ©æ³¨å†Œæ¥å£ | åˆ›å»ºç®€å† | âœ… æ— éœ€ç™»å½• |

**ç”Ÿäº§ç¯å¢ƒåœ°å€**: `https://crm.andejiazheng.com/api`

---

## ğŸ¯ åˆ›å»ºæ¥æºè¯´æ˜ â­ é‡è¦

### ä»€ä¹ˆæ˜¯åˆ›å»ºæ¥æºï¼Ÿ

**åˆ›å»ºæ¥æº** = è¿™æ¡ç®€å†æ˜¯è°åˆ›å»ºçš„

| åˆ›å»ºæ¥æº | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|---------|------|---------|
| **è‡ªåŠ©æ³¨å†Œ** | é˜¿å§¨é€šè¿‡å°ç¨‹åºè‡ªå·±åˆ›å»º | ä½¿ç”¨æœ¬æ¥å£ |
| **å‘˜å·¥åˆ›å»º** | é”€å”®/HRé€šè¿‡CRMç³»ç»Ÿåˆ›å»º | ä¸æ¶‰åŠå°ç¨‹åº |

### å°ç¨‹åºç«¯çš„èŒè´£

âœ… **ä½ éœ€è¦åšçš„**:
1. è°ƒç”¨è‡ªåŠ©æ³¨å†Œæ¥å£
2. åç«¯ä¼šè‡ªåŠ¨æ ‡è®°ä¸º"è‡ªåŠ©æ³¨å†Œ"
3. æ— éœ€æ‰‹åŠ¨è®¾ç½®åˆ›å»ºæ¥æº

âŒ **ä½ ä¸éœ€è¦åšçš„**:
1. ä¸è¦å°è¯•ä¼ é€’ `userId` å­—æ®µ
2. ä¸è¦å°è¯•ä¼ é€’ `createdBy` å­—æ®µ
3. ä¸è¦å°è¯•ä¼ é€’ `leadSource` å­—æ®µ

### åç«¯å¦‚ä½•å¤„ç†ï¼Ÿ

åç«¯ä¼š**è‡ªåŠ¨å¼ºåˆ¶è®¾ç½®**ä»¥ä¸‹å­—æ®µï¼š

```javascript
{
  // åç«¯è‡ªåŠ¨è®¾ç½®ï¼Œè¡¨ç¤ºè‡ªåŠ©æ³¨å†Œ
  userId: null,                    // â­ è‡ªåŠ©æ³¨å†Œæ ‡è®°
  leadSource: 'self-registration', // çº¿ç´¢æ¥æº
  status: 'draft',                 // ç®€å†çŠ¶æ€

  // å°ç¨‹åºç«¯éœ€è¦æä¾›
  name: 'å¼ ä¸‰',
  phone: '13900000000',
  age: 25,
  gender: 'female',
  jobType: 'yuer'
}
```

### CRMç«¯å¦‚ä½•æ˜¾ç¤ºï¼Ÿ

CRMç³»ç»Ÿä¼šæ ¹æ® `userId` å­—æ®µåŒºåˆ†ï¼š

| å­—æ®µå€¼ | CRMæ˜¾ç¤º | é¢œè‰² |
|--------|--------|------|
| `userId: null` | è‡ªåŠ©æ³¨å†Œ | ğŸ”µ è“è‰² |
| `userId: ObjectId` | å‘˜å·¥åˆ›å»º | ğŸŸ  æ©™è‰² |

**ä½ çš„ç®€å†ä¼šæ˜¾ç¤ºä¸º**: ğŸ”µ **è‡ªåŠ©æ³¨å†Œ**ï¼ˆè“è‰²æ ‡ç­¾ï¼‰

---

## å®Œæ•´ä½¿ç”¨æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é˜¿å§¨è‡ªåŠ©æ³¨å†Œæµç¨‹                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. ç”¨æˆ·ä¸Šä¼ èº«ä»½è¯ç…§ç‰‡
   â†“
2. è°ƒç”¨ OCR æ¥å£è¯†åˆ«èº«ä»½è¯
   POST /api/ocr/idcard
   â†“
3. è‡ªåŠ¨å¡«å……è¡¨å•ï¼ˆå§“åã€èº«ä»½è¯å·ã€å‡ºç”Ÿæ—¥æœŸç­‰ï¼‰
   â†“
4. ç”¨æˆ·è¡¥å……å…¶ä»–ä¿¡æ¯ï¼ˆæ‰‹æœºå·ã€å¹´é¾„ã€å·¥ç§ç­‰ï¼‰
   â†“
5. è°ƒç”¨è‡ªåŠ©æ³¨å†Œæ¥å£åˆ›å»ºç®€å†
   POST /api/resumes/miniprogram/self-register
   â†“
6. æ³¨å†ŒæˆåŠŸï¼Œæ˜¾ç¤ºç»“æœ
```

---

## OCRè¯†åˆ«æ¥å£

### åŸºæœ¬ä¿¡æ¯

```
POST /api/ocr/idcard
Content-Type: multipart/form-data
è®¤è¯: æ— éœ€ç™»å½•
```

### è¯·æ±‚å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| file | File | æ˜¯ | èº«ä»½è¯å›¾ç‰‡æ–‡ä»¶ï¼ˆJPG/PNGï¼Œæœ€å¤§5MBï¼‰ |

### å°ç¨‹åºä»£ç ç¤ºä¾‹

```javascript
// 1. é€‰æ‹©å›¾ç‰‡
wx.chooseImage({
  count: 1,
  sizeType: ['compressed'],
  sourceType: ['album', 'camera'],
  success: async (res) => {
    const tempFilePath = res.tempFilePaths[0];
    
    // 2. ä¸Šä¼ å¹¶è¯†åˆ«
    wx.uploadFile({
      url: 'https://crm.andejiazheng.com/api/ocr/idcard',
      filePath: tempFilePath,
      name: 'file',
      header: {
        'Content-Type': 'multipart/form-data'
      },
      success: (uploadRes) => {
        const data = JSON.parse(uploadRes.data);
        
        if (data.success) {
          // 3. æå–è¯†åˆ«ç»“æœ
          const ocrResult = data.data.words_result;
          const name = ocrResult.å§“å.words;
          const idNumber = ocrResult.å…¬æ°‘èº«ä»½å·ç .words;
          const birthDate = ocrResult.å‡ºç”Ÿ.words;
          const gender = ocrResult.æ€§åˆ«.words === 'å¥³' ? 'female' : 'male';
          const ethnicity = ocrResult.æ°‘æ—.words;
          const address = ocrResult.ä½å€.words;
          
          // 4. è‡ªåŠ¨å¡«å……è¡¨å•
          this.setData({
            name: name,
            idNumber: idNumber,
            birthDate: this.formatBirthDate(birthDate),
            gender: gender,
            ethnicity: ethnicity,
            hukouAddress: address
          });
          
          wx.showToast({
            title: 'è¯†åˆ«æˆåŠŸ',
            icon: 'success'
          });
        } else {
          wx.showToast({
            title: data.message || 'è¯†åˆ«å¤±è´¥',
            icon: 'none'
          });
        }
      },
      fail: (error) => {
        console.error('OCRè¯†åˆ«å¤±è´¥:', error);
        wx.showToast({
          title: 'è¯†åˆ«å¤±è´¥ï¼Œè¯·é‡è¯•',
          icon: 'none'
        });
      }
    });
  }
});

// æ ¼å¼åŒ–å‡ºç”Ÿæ—¥æœŸï¼š19890101 -> 1989-01-01
formatBirthDate(dateStr) {
  if (!dateStr || dateStr.length !== 8) return '';
  return `${dateStr.substr(0, 4)}-${dateStr.substr(4, 2)}-${dateStr.substr(6, 2)}`;
}
```

### æˆåŠŸå“åº”

```json
{
  "success": true,
  "data": {
    "words_result": {
      "å§“å": { "words": "å¼ ä¸‰" },
      "æ°‘æ—": { "words": "æ±‰" },
      "ä½å€": { "words": "åŒ—äº¬å¸‚æœé˜³åŒºxxx" },
      "å…¬æ°‘èº«ä»½å·ç ": { "words": "110101198901011234" },
      "æ€§åˆ«": { "words": "å¥³" },
      "å‡ºç”Ÿ": { "words": "19890101" }
    },
    "risk_info": []
  },
  "requestId": "xxx"
}
```

### é”™è¯¯å“åº”

```json
{
  "success": false,
  "message": "æ²¡æœ‰ä¸Šä¼ æ–‡ä»¶",
  "error": "IMAGE_PROCESSING_ERROR"
}
```

---

## è‡ªåŠ©æ³¨å†Œæ¥å£

### åŸºæœ¬ä¿¡æ¯

```
POST /api/resumes/miniprogram/self-register
Content-Type: application/json
è®¤è¯: æ— éœ€ç™»å½•
```

### è¯·æ±‚å‚æ•°

#### å¿…å¡«å­—æ®µ

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| name | string | å§“åï¼ˆ2-20å­—ç¬¦ï¼‰ | "å¼ ä¸‰" |
| phone | string | æ‰‹æœºå·ï¼ˆ11ä½ï¼‰ | "13800138000" |
| age | number | å¹´é¾„ï¼ˆ18-65ï¼‰ | 35 |
| gender | string | æ€§åˆ«ï¼ˆmale/femaleï¼‰ | "female" |
| jobType | string | å·¥ç§ | "yuexin" |

#### å¯é€‰å­—æ®µ

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|------|--------|
| idNumber | string | èº«ä»½è¯å·ï¼ˆ18ä½ï¼‰ | - |
| birthDate | string | å‡ºç”Ÿæ—¥æœŸï¼ˆYYYY-MM-DDï¼‰ | - |
| ethnicity | string | æ°‘æ— | - |
| nativePlace | string | ç±è´¯ | - |
| hukouAddress | string | æˆ·å£åœ°å€ | - |
| education | string | å­¦å† | "middle" |
| expectedSalary | number | æœŸæœ›è–ªèµ„ | 0 |
| experienceYears | number | å·¥ä½œå¹´é™ | 0 |
| skills | array | æŠ€èƒ½åˆ—è¡¨ | [] |

#### å·¥ç§æšä¸¾å€¼

```javascript
const jobTypes = {
  'yuexin': 'æœˆå«‚',
  'zhujia-yuer': 'ä½å®¶è‚²å„¿',
  'baiban-yuer': 'ç™½ç­è‚²å„¿',
  'baojie': 'ä¿æ´',
  'baiban-baomu': 'ç™½ç­ä¿å§†',
  'zhujia-baomu': 'ä½å®¶ä¿å§†',
  'yangchong': 'å…»å® ',
  'xiaoshi': 'å°æ—¶å·¥',
  'zhujia-hulao': 'ä½å®¶æŠ¤è€'
};
```

**æ³¨æ„**: è¿™äº›æ˜¯åç«¯å®é™…æ”¯æŒçš„å·¥ç§ç±»å‹ï¼Œè¯·ç¡®ä¿å°ç¨‹åºç«¯ä½¿ç”¨è¿™äº›å€¼ã€‚

### å°ç¨‹åºä»£ç ç¤ºä¾‹

```javascript
// åœ¨ services/resume.js ä¸­
const publicRequest = require('./request').publicRequest;

/**
 * é˜¿å§¨è‡ªåŠ©æ³¨å†Œ
 */
async function selfRegister(data) {
  try {
    // æ•°æ®éªŒè¯
    if (!data.name || data.name.length < 2) {
      throw new Error('è¯·è¾“å…¥å§“åï¼ˆ2-20ä¸ªå­—ç¬¦ï¼‰');
    }
    
    if (!data.phone || !/^1[3-9]\d{9}$/.test(data.phone)) {
      throw new Error('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·');
    }
    
    if (!data.age || data.age < 18 || data.age > 65) {
      throw new Error('å¹´é¾„å¿…é¡»åœ¨18-65å²ä¹‹é—´');
    }
    
    if (!data.gender || !['male', 'female'].includes(data.gender)) {
      throw new Error('è¯·é€‰æ‹©æ€§åˆ«');
    }
    
    if (!data.jobType) {
      throw new Error('è¯·é€‰æ‹©å·¥ç§');
    }
    
    // è°ƒç”¨æ¥å£
    const response = await publicRequest({
      url: '/resumes/miniprogram/self-register',
      method: 'POST',
      data: {
        name: data.name,
        phone: data.phone,
        age: data.age,
        gender: data.gender,
        jobType: data.jobType,
        idNumber: data.idNumber || undefined,
        birthDate: data.birthDate || undefined,
        ethnicity: data.ethnicity || undefined,
        nativePlace: data.nativePlace || undefined,
        hukouAddress: data.hukouAddress || undefined,
        education: data.education || 'middle',
        expectedSalary: data.expectedSalary || 0,
        experienceYears: data.experienceYears || 0,
        skills: data.skills || []
      }
    });
    
    return response;
  } catch (error) {
    console.error('è‡ªåŠ©æ³¨å†Œå¤±è´¥:', error);
    throw error;
  }
}

module.exports = {
  selfRegister
};
```

### é¡µé¢è°ƒç”¨ç¤ºä¾‹

```javascript
// åœ¨é¡µé¢ JS ä¸­
const resumeService = require('../../services/resume');

Page({
  data: {
    name: '',
    phone: '',
    age: '',
    gender: '',
    jobType: '',
    idNumber: '',
    // ... å…¶ä»–å­—æ®µ
  },
  
  // æäº¤æ³¨å†Œ
  async handleSubmit() {
    try {
      wx.showLoading({ title: 'æäº¤ä¸­...' });
      
      const result = await resumeService.selfRegister({
        name: this.data.name,
        phone: this.data.phone,
        age: parseInt(this.data.age),
        gender: this.data.gender,
        jobType: this.data.jobType,
        idNumber: this.data.idNumber,
        birthDate: this.data.birthDate,
        ethnicity: this.data.ethnicity,
        nativePlace: this.data.nativePlace,
        hukouAddress: this.data.hukouAddress
      });
      
      wx.hideLoading();
      
      if (result.success) {
        wx.showToast({
          title: 'æ³¨å†ŒæˆåŠŸ',
          icon: 'success',
          duration: 2000
        });
        
        // 2ç§’åè·³è½¬
        setTimeout(() => {
          wx.navigateBack();
        }, 2000);
      } else {
        wx.showToast({
          title: result.message || 'æ³¨å†Œå¤±è´¥',
          icon: 'none'
        });
      }
    } catch (error) {
      wx.hideLoading();
      wx.showToast({
        title: error.message || 'æ³¨å†Œå¤±è´¥ï¼Œè¯·é‡è¯•',
        icon: 'none'
      });
    }
  }
});
```

### æˆåŠŸå“åº”

```json
{
  "success": true,
  "message": "ç®€å†åˆ›å»ºæˆåŠŸ",
  "data": {
    "_id": "68f1b225d51f9afd7181f23b",
    "id": "68f1b225d51f9afd7181f23b",
    "name": "å¼ ä¸‰",
    "phone": "13800138000",
    "status": "draft",
    "leadSource": "self-registration",
    "createdAt": "2025-10-17T03:04:05.276Z"
  }
}
```

---

## é”™è¯¯å¤„ç†

### é”™è¯¯ç è¯´æ˜

| é”™è¯¯ç  | HTTPçŠ¶æ€ç  | è¯´æ˜ | å¤„ç†æ–¹å¼ |
|--------|-----------|------|---------|
| VALIDATION_ERROR | 400 | æ•°æ®éªŒè¯å¤±è´¥ | æ£€æŸ¥å¿…å¡«å­—æ®µå’Œæ ¼å¼ |
| DUPLICATE_ERROR | 409 | æ‰‹æœºå·å·²æ³¨å†Œ | æç¤ºç”¨æˆ·è¯¥æ‰‹æœºå·å·²æ³¨å†Œ |
| DUPLICATE_ID_NUMBER | 409 | èº«ä»½è¯å·å·²æ³¨å†Œ | æç¤ºç”¨æˆ·è¯¥èº«ä»½è¯å·å·²æ³¨å†Œ |
| RATE_LIMIT_EXCEEDED | 429 | è¯·æ±‚è¿‡äºé¢‘ç¹ | æç¤ºç”¨æˆ·ç¨åå†è¯• |
| INTERNAL_ERROR | 500 | æœåŠ¡å™¨é”™è¯¯ | æç¤ºç”¨æˆ·ç¨åé‡è¯• |

### é”™è¯¯å¤„ç†ç¤ºä¾‹

```javascript
async function handleRegister(data) {
  try {
    const result = await resumeService.selfRegister(data);
    
    if (result.success) {
      wx.showToast({
        title: 'æ³¨å†ŒæˆåŠŸ',
        icon: 'success'
      });
    }
  } catch (error) {
    // æ ¹æ®é”™è¯¯ç æ˜¾ç¤ºä¸åŒæç¤º
    let message = 'æ³¨å†Œå¤±è´¥ï¼Œè¯·é‡è¯•';
    
    if (error.response?.data) {
      const errorData = error.response.data;
      
      switch (errorData.error) {
        case 'VALIDATION_ERROR':
          message = errorData.details?.[0]?.message || 'æ•°æ®æ ¼å¼ä¸æ­£ç¡®';
          break;
        case 'DUPLICATE_ERROR':
          message = 'è¯¥æ‰‹æœºå·å·²æ³¨å†Œï¼Œè¯·ä½¿ç”¨å…¶ä»–æ‰‹æœºå·';
          break;
        case 'DUPLICATE_ID_NUMBER':
          message = 'è¯¥èº«ä»½è¯å·å·²æ³¨å†Œ';
          break;
        case 'RATE_LIMIT_EXCEEDED':
          message = 'æäº¤è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•';
          break;
        default:
          message = errorData.message || message;
      }
    }
    
    wx.showToast({
      title: message,
      icon: 'none',
      duration: 3000
    });
  }
}
```

---

## å®Œæ•´ä»£ç ç¤ºä¾‹

### services/resume.js

```javascript
const { publicRequest } = require('./request');

/**
 * é˜¿å§¨è‡ªåŠ©æ³¨å†Œ
 */
async function selfRegister(data) {
  return await publicRequest({
    url: '/resumes/miniprogram/self-register',
    method: 'POST',
    data: data
  });
}

module.exports = {
  selfRegister
};
```

### pages/self-register/index.js

```javascript
const resumeService = require('../../services/resume');

Page({
  data: {
    // è¡¨å•æ•°æ®
    name: '',
    phone: '',
    age: '',
    gender: '',
    jobType: '',
    idNumber: '',
    birthDate: '',
    ethnicity: '',
    nativePlace: '',
    hukouAddress: '',
    
    // å·¥ç§é€‰é¡¹
    jobTypeOptions: [
      { value: 'yuexin', label: 'æœˆå«‚' },
      { value: 'zhujia-yuer', label: 'ä½å®¶è‚²å„¿' },
      { value: 'baiban-yuer', label: 'ç™½ç­è‚²å„¿' },
      { value: 'baojie', label: 'ä¿æ´' },
      { value: 'baiban-baomu', label: 'ç™½ç­ä¿å§†' },
      { value: 'zhujia-baomu', label: 'ä½å®¶ä¿å§†' },
      { value: 'yangchong', label: 'å…»å® ' },
      { value: 'xiaoshi', label: 'å°æ—¶å·¥' },
      { value: 'zhujia-hulao', label: 'ä½å®¶æŠ¤è€' }
    ],
    
    // æ€§åˆ«é€‰é¡¹
    genderOptions: [
      { value: 'female', label: 'å¥³' },
      { value: 'male', label: 'ç”·' }
    ]
  },
  
  // OCRè¯†åˆ«èº«ä»½è¯
  async handleOCR() {
    wx.chooseImage({
      count: 1,
      sizeType: ['compressed'],
      sourceType: ['album', 'camera'],
      success: async (res) => {
        wx.showLoading({ title: 'è¯†åˆ«ä¸­...' });
        
        wx.uploadFile({
          url: 'https://crm.andejiazheng.com/api/ocr/idcard',
          filePath: res.tempFilePaths[0],
          name: 'file',
          success: (uploadRes) => {
            wx.hideLoading();
            const data = JSON.parse(uploadRes.data);
            
            if (data.success) {
              const result = data.data.words_result;
              this.setData({
                name: result.å§“å.words,
                idNumber: result.å…¬æ°‘èº«ä»½å·ç .words,
                birthDate: this.formatBirthDate(result.å‡ºç”Ÿ.words),
                gender: result.æ€§åˆ«.words === 'å¥³' ? 'female' : 'male',
                ethnicity: result.æ°‘æ—.words,
                hukouAddress: result.ä½å€.words
              });
              wx.showToast({ title: 'è¯†åˆ«æˆåŠŸ', icon: 'success' });
            } else {
              wx.showToast({ title: 'è¯†åˆ«å¤±è´¥', icon: 'none' });
            }
          },
          fail: () => {
            wx.hideLoading();
            wx.showToast({ title: 'è¯†åˆ«å¤±è´¥', icon: 'none' });
          }
        });
      }
    });
  },
  
  // æäº¤æ³¨å†Œ
  async handleSubmit() {
    try {
      // éªŒè¯å¿…å¡«å­—æ®µ
      if (!this.data.name) {
        wx.showToast({ title: 'è¯·è¾“å…¥å§“å', icon: 'none' });
        return;
      }
      if (!this.data.phone) {
        wx.showToast({ title: 'è¯·è¾“å…¥æ‰‹æœºå·', icon: 'none' });
        return;
      }
      if (!this.data.age) {
        wx.showToast({ title: 'è¯·è¾“å…¥å¹´é¾„', icon: 'none' });
        return;
      }
      if (!this.data.gender) {
        wx.showToast({ title: 'è¯·é€‰æ‹©æ€§åˆ«', icon: 'none' });
        return;
      }
      if (!this.data.jobType) {
        wx.showToast({ title: 'è¯·é€‰æ‹©å·¥ç§', icon: 'none' });
        return;
      }
      
      wx.showLoading({ title: 'æäº¤ä¸­...' });
      
      const result = await resumeService.selfRegister({
        name: this.data.name,
        phone: this.data.phone,
        age: parseInt(this.data.age),
        gender: this.data.gender,
        jobType: this.data.jobType,
        idNumber: this.data.idNumber,
        birthDate: this.data.birthDate,
        ethnicity: this.data.ethnicity,
        nativePlace: this.data.nativePlace,
        hukouAddress: this.data.hukouAddress
      });
      
      wx.hideLoading();
      
      if (result.success) {
        wx.showToast({
          title: 'æ³¨å†ŒæˆåŠŸ',
          icon: 'success',
          duration: 2000
        });
        setTimeout(() => {
          wx.navigateBack();
        }, 2000);
      }
    } catch (error) {
      wx.hideLoading();
      
      let message = 'æ³¨å†Œå¤±è´¥ï¼Œè¯·é‡è¯•';
      if (error.response?.data) {
        const errorData = error.response.data;
        if (errorData.error === 'DUPLICATE_ERROR') {
          message = 'è¯¥æ‰‹æœºå·å·²æ³¨å†Œ';
        } else if (errorData.error === 'DUPLICATE_ID_NUMBER') {
          message = 'è¯¥èº«ä»½è¯å·å·²æ³¨å†Œ';
        } else if (errorData.error === 'RATE_LIMIT_EXCEEDED') {
          message = 'æäº¤è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•';
        } else {
          message = errorData.message || message;
        }
      }
      
      wx.showToast({
        title: message,
        icon: 'none',
        duration: 3000
      });
    }
  },
  
  // æ ¼å¼åŒ–å‡ºç”Ÿæ—¥æœŸ
  formatBirthDate(dateStr) {
    if (!dateStr || dateStr.length !== 8) return '';
    return `${dateStr.substr(0, 4)}-${dateStr.substr(4, 2)}-${dateStr.substr(6, 2)}`;
  }
});
```

---

## å¸¸è§é—®é¢˜

### Q1: æ¥å£è¿”å›404é”™è¯¯

**åŸå› **: æ¥å£åœ°å€ä¸æ­£ç¡®  
**è§£å†³**: ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ç”Ÿäº§ç¯å¢ƒåœ°å€ `https://crm.andejiazheng.com/api`

### Q2: æ¥å£è¿”å›429é”™è¯¯ï¼ˆé™æµï¼‰

**åŸå› **: è¯·æ±‚è¿‡äºé¢‘ç¹ï¼ˆæ¯åˆ†é’Ÿæœ€å¤š3æ¬¡ï¼‰  
**è§£å†³**: ç­‰å¾…1åˆ†é’Ÿåé‡è¯•ï¼Œæˆ–åœ¨å‰ç«¯æ·»åŠ é˜²æŠ–å¤„ç†

### Q3: OCRè¯†åˆ«å¤±è´¥

**åŸå› **: å›¾ç‰‡è´¨é‡ä¸ä½³æˆ–æ ¼å¼ä¸æ”¯æŒ  
**è§£å†³**: 
- ç¡®ä¿å›¾ç‰‡æ¸…æ™°
- ä½¿ç”¨JPGæˆ–PNGæ ¼å¼
- å›¾ç‰‡å¤§å°ä¸è¶…è¿‡5MB

### Q4: æ‰‹æœºå·å·²æ³¨å†Œ

**åŸå› **: è¯¥æ‰‹æœºå·å·²ç»åœ¨ç³»ç»Ÿä¸­å­˜åœ¨  
**è§£å†³**: æç¤ºç”¨æˆ·ä½¿ç”¨å…¶ä»–æ‰‹æœºå·ï¼Œæˆ–è”ç³»ç®¡ç†å‘˜

### Q5: èº«ä»½è¯å·å·²æ³¨å†Œ

**åŸå› **: è¯¥èº«ä»½è¯å·å·²ç»åœ¨ç³»ç»Ÿä¸­å­˜åœ¨
**è§£å†³**: æç¤ºç”¨æˆ·è¯¥èº«ä»½è¯å·å·²æ³¨å†Œï¼Œé¿å…é‡å¤æ³¨å†Œ

### Q6: åˆ›å»ºæ¥æºæ˜¯ä»€ä¹ˆï¼Ÿ â­ æ–°å¢

**é—®é¢˜**: æˆ‘éœ€è¦åœ¨è¯·æ±‚ä¸­ä¼ é€’åˆ›å»ºæ¥æºå—ï¼Ÿ

**ç­”æ¡ˆ**: âŒ **ä¸éœ€è¦ï¼**

- âœ… åç«¯ä¼šè‡ªåŠ¨æ ‡è®°ä¸º"è‡ªåŠ©æ³¨å†Œ"
- âœ… ä½ åªéœ€è¦æä¾›åŸºæœ¬ä¿¡æ¯ï¼ˆå§“åã€æ‰‹æœºå·ã€å¹´é¾„ã€å·¥ç§ç­‰ï¼‰
- âŒ ä¸è¦å°è¯•ä¼ é€’ `userId`ã€`createdBy` æˆ– `leadSource` å­—æ®µ

**è¯·æ±‚ç¤ºä¾‹**:
```javascript
// âœ… æ­£ç¡®åšæ³•
const data = {
  name: 'å¼ ä¸‰',
  phone: '13900000000',
  age: 25,
  gender: 'female',
  jobType: 'yuer'
};

// âŒ é”™è¯¯åšæ³•ï¼ˆä¸è¦è¿™æ ·åšï¼‰
const wrongData = {
  name: 'å¼ ä¸‰',
  phone: '13900000000',
  age: 25,
  gender: 'female',
  jobType: 'yuer',
  userId: 'xxx',           // âŒ ä¸è¦ä¼ é€’
  createdBy: 'xxx',        // âŒ ä¸è¦ä¼ é€’
  leadSource: 'xxx'        // âŒ ä¸è¦ä¼ é€’
};
```

### Q7: å¦‚ä½•åœ¨CRMä¸­æŸ¥çœ‹åˆ›å»ºæ¥æºï¼Ÿ

**é—®é¢˜**: æˆ‘çš„ç®€å†åœ¨CRMä¸­å¦‚ä½•æ˜¾ç¤ºåˆ›å»ºæ¥æºï¼Ÿ

**ç­”æ¡ˆ**:
- ğŸ”µ **è“è‰²æ ‡ç­¾** = è‡ªåŠ©æ³¨å†Œï¼ˆä½ é€šè¿‡å°ç¨‹åºåˆ›å»ºçš„ï¼‰
- ğŸŸ  **æ©™è‰²æ ‡ç­¾** = å‘˜å·¥åˆ›å»ºï¼ˆé”€å”®/HRé€šè¿‡CRMåˆ›å»ºçš„ï¼‰

**æ˜¾ç¤ºä½ç½®**:
1. ç®€å†åˆ—è¡¨ä¸­çš„"åˆ›å»ºæ¥æº"åˆ—
2. ç®€å†è¯¦æƒ…é¡µé¢çš„"å·¥ä½œä¿¡æ¯"å¡ç‰‡

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»åç«¯å¼€å‘å›¢é˜Ÿã€‚

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**æœ€åæ›´æ–°**: 2025-10-17

