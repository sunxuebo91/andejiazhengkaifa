# 小程序简历创建标准规范

## 📋 概述

本文档定义了小程序端和CRM端简历创建的统一标准，确保数据结构、字段映射、验证规则完全一致。

## 🎯 目标

- 统一小程序端和CRM端的数据结构
- 规范字段映射关系和枚举值
- 确保数据验证规则一致
- 提供完整的技术实现指南

## 📊 数据结构标准

### 必填字段 (Required Fields)

| 字段名 | 类型 | 验证规则 | 示例 | 说明 |
|--------|------|----------|------|------|
| `name` | string | 2-20字符 | "张三" | 姓名 |
| `phone` | string | 11位手机号 | "13800138000" | 手机号码 |
| `gender` | enum | female/male | "female" | 性别 |
| `age` | number | 18-65 | 28 | 年龄 |
| `jobType` | enum | 见工种枚举 | "yuexin" | 工种 |
| `education` | enum | 见学历枚举 | "college" | 学历 |

### 可选字段 (Optional Fields)

| 字段名 | 类型 | 验证规则 | 示例 | 说明 |
|--------|------|----------|------|------|
| `wechat` | string | 无限制 | "wxid_123456" | 微信号 |
| `idNumber` | string | 18位身份证 | "110101199206151234" | 身份证号 |
| `school` | string | 最大50字符 | "北京大学" | 毕业院校 |
| `major` | string | 最大50字符 | "护理学" | 专业 |
| `experienceYears` | number | 0-50 | 5 | 工作经验年限 |
| `expectedSalary` | number | ≥0 | 8000 | 期望薪资 |
| `nativePlace` | string | 最大20字符 | "北京市" | 籍贯 |
| `skills` | array | 技能枚举数组 | ["muying","cuiru"] | 技能列表 |
| `serviceArea` | array | 字符串数组 | ["海淀区"] | 服务区域 |
| `workExperiences` | array | 工作经历对象数组 | 见下方结构 | 工作经历 |
| `maritalStatus` | enum | 见婚姻状况枚举 | "married" | 婚姻状况 |
| `religion` | enum | 见宗教信仰枚举 | "none" | 宗教信仰 |
| `zodiac` | enum | 见生肖枚举 | "pig" | 生肖 |
| `zodiacSign` | enum | 见星座枚举 | "gemini" | 星座 |
| `ethnicity` | string | 无限制 | "汉族" | 民族 |
| `birthDate` | string | YYYY-MM-DD | "1992-06-15" | 出生日期 |
| `currentAddress` | string | 无限制 | "北京市海淀区" | 现居住地址 |
| `hukouAddress` | string | 无限制 | "河南省郑州市" | 户籍地址 |
| `orderStatus` | enum | 见接单状态枚举 | "accepting" | 接单状态 |
| `leadSource` | enum | 见线索来源枚举 | "referral" | 线索来源 |
| `emergencyContactName` | string | 无限制 | "李联系人" | 紧急联系人姓名 |
| `emergencyContactPhone` | string | 11位手机号 | "13900139000" | 紧急联系人电话 |
| `medicalExamDate` | string | YYYY-MM-DD | "2024-01-15" | 体检时间 |
| `selfIntroduction` | string | 最大1000字符 | "自我介绍..." | 自我介绍 |

### 文件字段 (File Fields)

| 字段名 | 类型 | 说明 |
|--------|------|------|
| `idCardFrontUrl` | string | 身份证正面照片URL |
| `idCardBackUrl` | string | 身份证背面照片URL |
| `photoUrls` | array | 个人照片URL数组 |
| `certificateUrls` | array | 证书照片URL数组 |
| `medicalReportUrls` | array | 体检报告URL数组 |

### 工作经历结构 (Work Experience Structure)

```typescript
interface WorkExperience {
  startDate: string;    // YYYY-MM 格式
  endDate: string;      // YYYY-MM 格式
  description: string;  // 工作描述
}
```

## 🏷️ 枚举值映射标准

### 性别 (Gender)
```typescript
enum Gender {
  MALE = 'male',
  FEMALE = 'female'
}

const genderMap = {
  male: '男',
  female: '女'
};
```

### 学历 (Education)
```typescript
enum Education {
  NO = 'no',
  PRIMARY = 'primary',
  MIDDLE = 'middle',
  SECONDARY = 'secondary',
  VOCATIONAL = 'vocational',
  HIGH = 'high',
  COLLEGE = 'college',
  BACHELOR = 'bachelor',
  GRADUATE = 'graduate'
}

const educationMap = {
  no: '无学历',
  primary: '小学',
  middle: '初中',
  secondary: '中专',
  vocational: '职高',
  high: '高中',
  college: '大专',
  bachelor: '本科',
  graduate: '研究生及以上'
};
```

### 工种 (Job Type)
```typescript
enum JobType {
  YUEXIN = 'yuexin',
  ZHUJIA_YUER = 'zhujia-yuer',
  BAIBAN_YUER = 'baiban-yuer',
  BAOJIE = 'baojie',
  BAIBAN_BAOMU = 'baiban-baomu',
  ZHUJIA_BAOMU = 'zhujia-baomu',
  YANGCHONG = 'yangchong',
  XIAOSHI = 'xiaoshi',
  ZHUJIA_HULAO = 'zhujia-hulao'
}

const jobTypeMap = {
  yuexin: '月嫂',
  'zhujia-yuer': '住家育儿嫂',
  'baiban-yuer': '白班育儿',
  baojie: '保洁',
  'baiban-baomu': '白班保姆',
  'zhujia-baomu': '住家保姆',
  yangchong: '养宠',
  xiaoshi: '小时工',
  'zhujia-hulao': '住家护老'
};
```

### 婚姻状况 (Marital Status)
```typescript
enum MaritalStatus {
  SINGLE = 'single',
  MARRIED = 'married',
  DIVORCED = 'divorced',
  WIDOWED = 'widowed'
}

const maritalStatusMap = {
  single: '未婚',
  married: '已婚',
  divorced: '离异',
  widowed: '丧偶'
};
```

### 宗教信仰 (Religion)
```typescript
enum Religion {
  NONE = 'none',
  BUDDHISM = 'buddhism',
  TAOISM = 'taoism',
  CHRISTIANITY = 'christianity',
  CATHOLICISM = 'catholicism',
  ISLAM = 'islam',
  OTHER = 'other'
}

const religionMap = {
  none: '无',
  buddhism: '佛教',
  taoism: '道教',
  christianity: '基督教',
  catholicism: '天主教',
  islam: '伊斯兰教',
  other: '其他'
};
```

### 生肖 (Zodiac)
```typescript
enum Zodiac {
  RAT = 'rat',
  OX = 'ox',
  TIGER = 'tiger',
  RABBIT = 'rabbit',
  DRAGON = 'dragon',
  SNAKE = 'snake',
  HORSE = 'horse',
  GOAT = 'goat',
  MONKEY = 'monkey',
  ROOSTER = 'rooster',
  DOG = 'dog',
  PIG = 'pig'
}

const zodiacMap = {
  rat: '鼠',
  ox: '牛',
  tiger: '虎',
  rabbit: '兔',
  dragon: '龙',
  snake: '蛇',
  horse: '马',
  goat: '羊',
  monkey: '猴',
  rooster: '鸡',
  dog: '狗',
  pig: '猪'
};
```

### 星座 (Zodiac Sign)
```typescript
enum ZodiacSign {
  CAPRICORN = 'capricorn',
  AQUARIUS = 'aquarius',
  PISCES = 'pisces',
  ARIES = 'aries',
  TAURUS = 'taurus',
  GEMINI = 'gemini',
  CANCER = 'cancer',
  LEO = 'leo',
  VIRGO = 'virgo',
  LIBRA = 'libra',
  SCORPIO = 'scorpio',
  SAGITTARIUS = 'sagittarius'
}

const zodiacSignMap = {
  capricorn: '摩羯座',
  aquarius: '水瓶座',
  pisces: '双鱼座',
  aries: '白羊座',
  taurus: '金牛座',
  gemini: '双子座',
  cancer: '巨蟹座',
  leo: '狮子座',
  virgo: '处女座',
  libra: '天秤座',
  scorpio: '天蝎座',
  sagittarius: '射手座'
};
```

### 接单状态 (Order Status)
```typescript
enum OrderStatus {
  ACCEPTING = 'accepting',
  NOT_ACCEPTING = 'not-accepting',
  ON_SERVICE = 'on-service'
}

const orderStatusMap = {
  accepting: '想接单',
  'not-accepting': '不接单',
  'on-service': '已上户'
};
```

### 技能标签 (Skills)
```typescript
enum Skill {
  CHANHOU = 'chanhou',
  TESHU_YINGER = 'teshu-yinger',
  YILIAOBACKGROUND = 'yiliaobackground',
  YUYING = 'yuying',
  MUYING = 'muying',
  CUIRU = 'cuiru',
  JIASHI = 'jiashi',
  YINGYANG = 'yingyang',
  ZAOJIAO = 'zaojiao',
  XINLI = 'xinli',
  LILIAO_KANGFU = 'liliao-kangfu',
  SHUANGTAI_HULI = 'shuangtai-huli',
  YANGLAO_HULI = 'yanglao-huli'
}

const skillsMap = {
  chanhou: '产后修复师',
  'teshu-yinger': '特殊婴儿护理',
  yiliaobackground: '医疗背景',
  yuying: '高级育婴师',
  muying: '母婴护理师',
  cuiru: '高级催乳师',
  jiashi: '驾驶',
  yingyang: '营养师',
  zaojiao: '早教师',
  xinli: '心理咨询师',
  'liliao-kangfu': '理疗康复',
  'shuangtai-huli': '双胎护理',
  'yanglao-huli': '养老护理'
};
```

### 线索来源 (Lead Source)
```typescript
enum LeadSource {
  REFERRAL = 'referral',
  PAID_LEAD = 'paid-lead',
  COMMUNITY = 'community',
  DOOR_TO_DOOR = 'door-to-door',
  ONLINE_AD = 'online-ad',
  SOCIAL_MEDIA = 'social-media',
  WEBSITE = 'website',
  OTHER = 'other'
}

const leadSourceMap = {
  referral: '转介绍',
  'paid-lead': '付费线索',
  community: '社群线索',
  'door-to-door': '地推',
  'online-ad': '线上广告',
  'social-media': '社交媒体',
  website: '官网',
  other: '其他'
};
```

## 🔧 技术实现标准

### API接口规范

#### 创建简历接口
- **URL**: `POST /api/resumes/miniprogram/create`
- **Content-Type**: `application/json`
- **Headers**:
  - `Idempotency-Key`: 防重复提交的幂等性键

#### 请求数据格式
```typescript
interface CreateResumeRequest {
  // 必填字段
  name: string;
  phone: string;
  gender: 'male' | 'female';
  age: number;
  jobType: JobType;
  education: Education;

  // 可选字段
  wechat?: string;
  idNumber?: string;
  school?: string;
  major?: string;
  experienceYears?: number;
  expectedSalary?: number;
  nativePlace?: string;
  skills?: Skill[];
  serviceArea?: string[];
  workExperiences?: WorkExperience[];
  maritalStatus?: MaritalStatus;
  religion?: Religion;
  zodiac?: Zodiac;
  zodiacSign?: ZodiacSign;
  ethnicity?: string;
  birthDate?: string;
  currentAddress?: string;
  hukouAddress?: string;
  orderStatus?: OrderStatus;
  leadSource?: LeadSource;
  emergencyContactName?: string;
  emergencyContactPhone?: string;
  medicalExamDate?: string;
  selfIntroduction?: string;

  // 文件字段
  idCardFrontUrl?: string;
  idCardBackUrl?: string;
  photoUrls?: string[];
  certificateUrls?: string[];
  medicalReportUrls?: string[];
}
```

#### 响应数据格式
```typescript
interface CreateResumeResponse {
  success: boolean;
  message: string;
  data?: {
    _id: string;
    name: string;
    phone: string;
    createdAt: string;
  };
}
```

### 数据验证规则

#### 前端验证 (小程序端)
```javascript
// 必填字段验证
const validateRequired = (formData) => {
  const requiredFields = ['name', 'phone', 'gender', 'age', 'jobType', 'education'];
  const errors = [];

  requiredFields.forEach(field => {
    if (!formData[field]) {
      errors.push(`${field}不能为空`);
    }
  });

  return errors;
};

// 手机号验证
const validatePhone = (phone) => {
  const phoneRegex = /^1[3-9]\d{9}$/;
  return phoneRegex.test(phone);
};

// 年龄验证
const validateAge = (age) => {
  return age >= 18 && age <= 65;
};

// 身份证号验证
const validateIdNumber = (idNumber) => {
  if (!idNumber) return true; // 可选字段
  const idRegex = /^[1-9]\d{5}(18|19|20)\d{2}((0[1-9])|(1[0-2]))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/;
  return idRegex.test(idNumber);
};
```

#### 后端验证 (CRM API)
使用 `CreateResumeV2Dto` 进行严格验证，包括：
- 数据类型验证
- 长度限制验证
- 枚举值验证
- 格式验证（手机号、身份证等）
- 数据转换和清理

### 文件上传标准

#### 文件类型支持
- **图片**: JPG, JPEG, PNG, GIF
- **文档**: PDF

#### 文件大小限制
- **图片**: 最大 5MB
- **PDF**: 最大 10MB

#### 上传流程
1. 小程序选择文件
2. 调用上传接口 `POST /api/upload/file`
3. 获取文件URL
4. 将URL添加到对应的文件字段数组中

#### 上传接口示例
```javascript
// 小程序文件上传
const uploadFile = (filePath, fileType) => {
  return new Promise((resolve, reject) => {
    wx.uploadFile({
      url: `${API_BASE_URL}/api/upload/file`,
      filePath: filePath,
      name: 'file',
      formData: {
        type: fileType
      },
      success: (res) => {
        const data = JSON.parse(res.data);
        if (data.success) {
          resolve(data.data.url);
        } else {
          reject(new Error(data.message));
        }
      },
      fail: reject
    });
  });
};
```

## 📱 小程序端实现指南

### 表单数据结构
```javascript
// 小程序 data 结构
data: {
  formData: {
    // 必填字段
    name: '',
    phone: '',
    gender: '',
    age: '',
    jobType: '',
    education: '',

    // 可选字段
    wechat: '',
    idNumber: '',
    school: '',
    major: '',
    experienceYears: 0,
    expectedSalary: '',
    nativePlace: '',
    skills: [],
    serviceArea: [],
    workExperiences: [],
    maritalStatus: '',
    religion: '',
    zodiac: '',
    zodiacSign: '',
    ethnicity: '',
    birthDate: '',
    currentAddress: '',
    hukouAddress: '',
    orderStatus: '',
    leadSource: '',
    emergencyContactName: '',
    emergencyContactPhone: '',
    medicalExamDate: '',
    selfIntroduction: '',

    // 文件字段
    idCardFrontUrl: '',
    idCardBackUrl: '',
    photoUrls: [],
    certificateUrls: [],
    medicalReportUrls: []
  }
}
```

### 表单提交流程
```javascript
// 提交简历数据
const submitResume = async () => {
  try {
    // 1. 数据验证
    const errors = validateFormData(formData);
    if (errors.length > 0) {
      wx.showToast({
        title: errors[0],
        icon: 'error'
      });
      return;
    }

    // 2. 数据清理和格式化
    const submitData = formatFormData(formData);

    // 3. 生成幂等性键
    const idempotencyKey = generateIdempotencyKey();

    // 4. 提交数据
    const response = await wx.request({
      url: `${API_BASE_URL}/api/resumes/miniprogram/create`,
      method: 'POST',
      data: submitData,
      header: {
        'Content-Type': 'application/json',
        'Idempotency-Key': idempotencyKey
      }
    });

    // 5. 处理响应
    if (response.data.success) {
      wx.showToast({
        title: '提交成功',
        icon: 'success'
      });
      // 跳转到成功页面或返回
    } else {
      throw new Error(response.data.message);
    }

  } catch (error) {
    console.error('提交失败:', error);
    wx.showToast({
      title: '提交失败',
      icon: 'error'
    });
  }
};

// 数据格式化函数
const formatFormData = (data) => {
  return {
    ...data,
    age: Number(data.age),
    experienceYears: Number(data.experienceYears) || 0,
    expectedSalary: data.expectedSalary ? Number(data.expectedSalary) : undefined,
    skills: Array.isArray(data.skills) ? data.skills : [],
    serviceArea: Array.isArray(data.serviceArea) ? data.serviceArea : [],
    workExperiences: Array.isArray(data.workExperiences) ? data.workExperiences : [],
    photoUrls: Array.isArray(data.photoUrls) ? data.photoUrls : [],
    certificateUrls: Array.isArray(data.certificateUrls) ? data.certificateUrls : [],
    medicalReportUrls: Array.isArray(data.medicalReportUrls) ? data.medicalReportUrls : []
  };
};

// 生成幂等性键
const generateIdempotencyKey = () => {
  return `miniprogram_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
};
```

## ✅ 实施检查清单

### 小程序端检查项目

#### 📋 表单字段完整性
- [ ] 所有必填字段都有对应的输入组件
- [ ] 所有可选字段都有对应的输入组件
- [ ] 枚举字段使用正确的选择器组件
- [ ] 数组字段支持多选功能
- [ ] 文件字段支持上传功能

#### 🔍 数据验证
- [ ] 必填字段验证
- [ ] 手机号格式验证
- [ ] 身份证号格式验证
- [ ] 年龄范围验证
- [ ] 枚举值验证
- [ ] 文件类型和大小验证

#### 📤 数据提交
- [ ] 使用正确的API接口地址
- [ ] 设置正确的请求头
- [ ] 包含幂等性键
- [ ] 数据格式化正确
- [ ] 错误处理完善

#### 🗂️ 文件上传
- [ ] 支持选择多种文件类型
- [ ] 文件大小限制检查
- [ ] 上传进度显示
- [ ] 上传失败重试机制
- [ ] 文件预览功能

### CRM端检查项目

#### 🔧 API接口
- [ ] 接口地址正确
- [ ] 数据验证规则完整
- [ ] 错误响应格式统一
- [ ] 日志记录完善

#### 🗄️ 数据存储
- [ ] 数据库字段定义正确
- [ ] 索引设置合理
- [ ] 数据类型匹配
- [ ] 默认值设置

#### 🎨 前端显示
- [ ] 所有字段都有显示逻辑
- [ ] 枚举值映射完整
- [ ] 文件预览功能正常
- [ ] 空值处理正确

## 🚀 部署和测试

### 测试用例

#### 基础功能测试
1. **必填字段测试**: 验证所有必填字段的验证逻辑
2. **可选字段测试**: 验证可选字段的处理逻辑
3. **枚举值测试**: 验证所有枚举字段的映射关系
4. **文件上传测试**: 验证各种文件类型的上传功能

#### 边界条件测试
1. **数据长度测试**: 测试字段长度限制
2. **特殊字符测试**: 测试特殊字符的处理
3. **网络异常测试**: 测试网络中断时的处理
4. **重复提交测试**: 测试幂等性机制

#### 兼容性测试
1. **不同设备测试**: 测试不同型号手机的兼容性
2. **不同版本测试**: 测试不同微信版本的兼容性
3. **数据迁移测试**: 测试现有数据的兼容性

### 上线检查
- [ ] 小程序端代码部署
- [ ] CRM端代码部署
- [ ] 数据库结构更新
- [ ] API接口测试
- [ ] 端到端功能测试
- [ ] 性能测试
- [ ] 安全测试

## 📞 技术支持

如有技术问题，请联系开发团队或查看相关文档：
- 后端API文档: `/api/docs`
- 数据库设计文档: `docs/database-schema.md`
- 前端组件文档: `docs/frontend-components.md`

---

**版本**: v1.0
**更新时间**: 2025-09-20
**维护人员**: 开发团队
```
```
