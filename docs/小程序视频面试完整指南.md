# å¾®ä¿¡å°ç¨‹åºè§†é¢‘é¢è¯• - å®Œæ•´é›†æˆæŒ‡å—

> **é€‚ç”¨äººç¾¤**ï¼šå°ç¨‹åºç«¯AIå¼€å‘è€…  
> **ç‰ˆæœ¬**ï¼šv1.0.0  
> **æœ€åæ›´æ–°**ï¼š2024-01-15  
> **ç”Ÿäº§ç¯å¢ƒ**ï¼š`https://crm.andejiazheng.com`

---

## ğŸ“‹ ç›®å½•

1. [åŠŸèƒ½æ¦‚è¿°](#åŠŸèƒ½æ¦‚è¿°)
2. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
3. [å‰ç½®å‡†å¤‡](#å‰ç½®å‡†å¤‡)
4. [å¿«é€Ÿé›†æˆ](#å¿«é€Ÿé›†æˆ)
5. [APIæ¥å£æ–‡æ¡£](#apiæ¥å£æ–‡æ¡£)
6. [å®Œæ•´ä»£ç ç¤ºä¾‹](#å®Œæ•´ä»£ç ç¤ºä¾‹)
7. [å¸¸è§åœºæ™¯å®ç°](#å¸¸è§åœºæ™¯å®ç°)
8. [è°ƒè¯•æŒ‡å—](#è°ƒè¯•æŒ‡å—)
9. [å¸¸è§é—®é¢˜FAQ](#å¸¸è§é—®é¢˜faq)

---

## åŠŸèƒ½æ¦‚è¿°

### æ ¸å¿ƒåŠŸèƒ½

#### 1. è§†é¢‘é€šè¯åŠŸèƒ½
- âœ… å¤šäººè§†é¢‘é€šè¯ï¼ˆæœ€å¤š6äººï¼‰
- âœ… 720Pé«˜æ¸…è§†é¢‘è´¨é‡
- âœ… å®æ—¶éŸ³è§†é¢‘ä¼ è¾“
- âœ… è‡ªåŠ¨å¸ƒå±€åˆ‡æ¢ï¼ˆç”»å»Šè§†å›¾/æ¼”è®²è€…è§†å›¾ï¼‰
- âœ… å‰ç½®/åç½®æ‘„åƒå¤´åˆ‡æ¢
- âœ… æ‘„åƒå¤´/éº¦å…‹é£å¼€å…³æ§åˆ¶

#### 2. ç¾é¢œåŠŸèƒ½
- âœ… ç¾ç™½è°ƒèŠ‚ï¼ˆ0-100ï¼‰
- âœ… ç£¨çš®è°ƒèŠ‚ï¼ˆ0-100ï¼‰
- âœ… é”åŒ–è°ƒèŠ‚ï¼ˆ0-100ï¼‰
- âœ… çº¢æ¶¦è°ƒèŠ‚ï¼ˆ0-100ï¼‰
- âœ… å®æ—¶é¢„è§ˆæ•ˆæœ

#### 3. æè¯å™¨åŠŸèƒ½
- âœ… ä¸»æŒäººæ¨é€æè¯å†…å®¹
- âœ… æŒ‡å®šç”¨æˆ·æ¥æ”¶
- âœ… æ»šåŠ¨é€Ÿåº¦æ§åˆ¶
- âœ… æ˜¾ç¤ºé«˜åº¦è°ƒèŠ‚
- âœ… æ’­æ”¾/æš‚åœ/åœæ­¢æ§åˆ¶

#### 4. æˆ¿é—´ç®¡ç†
- âœ… åˆ›å»ºé¢è¯•æˆ¿é—´
- âœ… é‚€è¯·ä»–äººåŠ å…¥ï¼ˆåˆ†äº«é“¾æ¥/å°ç¨‹åºç ï¼‰
- âœ… å‚ä¸è€…åˆ—è¡¨æŸ¥çœ‹
- âœ… è§£æ•£æˆ¿é—´ï¼ˆä¸»æŒäººæƒé™ï¼‰
- âœ… æˆ¿é—´çŠ¶æ€æ£€æŸ¥

#### 5. å‚ä¸è€…ç®¡ç†
- âœ… æŸ¥çœ‹æ‰€æœ‰å‚ä¸è€…
- âœ… æ˜¾ç¤ºéŸ³è§†é¢‘çŠ¶æ€
- âœ… ç”¨æˆ·è¿›å‡ºæç¤º

---

## æŠ€æœ¯æ¶æ„

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å¾®ä¿¡å°ç¨‹åº                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  åˆ›å»ºæˆ¿é—´é¡µ   â”‚  â”‚  åŠ å…¥æˆ¿é—´é¡µ   â”‚  â”‚  è§†é¢‘é¢è¯•é¡µ   â”‚      â”‚
â”‚  â”‚  (åŸç”Ÿå°ç¨‹åº) â”‚  â”‚  (åŸç”Ÿå°ç¨‹åº) â”‚  â”‚  (WebView)   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                  â”‚                  â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                            â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CRMåç«¯æœåŠ¡                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  å¾®ä¿¡ç™»å½•API  â”‚  â”‚  ZEGO Token  â”‚  â”‚  æˆ¿é—´ç®¡ç†API  â”‚      â”‚
â”‚  â”‚  /wechat/*   â”‚  â”‚  /zego/*     â”‚  â”‚  /interview/* â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ZEGO Cloud SDK                          â”‚
â”‚              (è§†é¢‘é€šè¯ã€ç¾é¢œã€éŸ³è§†é¢‘å¤„ç†)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµç¨‹å›¾

```
HRåˆ›å»ºæˆ¿é—´æµç¨‹ï¼š
å°ç¨‹åº â†’ å¾®ä¿¡ç™»å½• â†’ è·å–JWT Token â†’ åˆ›å»ºæˆ¿é—´ â†’ ç”ŸæˆZEGO Token â†’ è¿›å…¥WebViewè§†é¢‘é¡µé¢

è®¿å®¢åŠ å…¥æµç¨‹ï¼š
å°ç¨‹åº â†’ æ‰«ç /é“¾æ¥ â†’ å¡«å†™å§“å â†’ ç”Ÿæˆè®¿å®¢Token â†’ è¿›å…¥WebViewè§†é¢‘é¡µé¢
```

---

## å‰ç½®å‡†å¤‡

### 1. å¾®ä¿¡å°ç¨‹åºåå°é…ç½®

#### ä¸šåŠ¡åŸŸåé…ç½®
åœ¨å¾®ä¿¡å°ç¨‹åºåå° â†’ å¼€å‘ â†’ å¼€å‘ç®¡ç† â†’ ä¸šåŠ¡åŸŸåï¼Œæ·»åŠ ï¼š
```
https://crm.andejiazheng.com
```

#### æœåŠ¡å™¨åŸŸåé…ç½®
åœ¨å¾®ä¿¡å°ç¨‹åºåå° â†’ å¼€å‘ â†’ å¼€å‘ç®¡ç† â†’ æœåŠ¡å™¨åŸŸåï¼Œæ·»åŠ ï¼š

**requeståˆæ³•åŸŸå**ï¼š
```
https://crm.andejiazheng.com
https://zego-webrtc-*.zego.im
```

**socketåˆæ³•åŸŸå**ï¼š
```
wss://zego-webrtc-*.zego.im
```

**uploadFileåˆæ³•åŸŸå**ï¼š
```
https://crm.andejiazheng.com
```

**downloadFileåˆæ³•åŸŸå**ï¼š
```
https://crm.andejiazheng.com
```

### 2. å°ç¨‹åºæƒé™é…ç½®

åœ¨ `app.json` ä¸­æ·»åŠ æƒé™å£°æ˜ï¼š

```json
{
  "permission": {
    "scope.camera": {
      "desc": "ç”¨äºè§†é¢‘é¢è¯•æ—¶å¼€å¯æ‘„åƒå¤´"
    },
    "scope.record": {
      "desc": "ç”¨äºè§†é¢‘é¢è¯•æ—¶å¼€å¯éº¦å…‹é£"
    }
  }
}
```

### 3. å¾®ä¿¡ç™»å½•æˆæƒ

å°ç¨‹åºéœ€è¦å…ˆå®Œæˆå¾®ä¿¡ç™»å½•ï¼Œè·å–JWT Tokenåæ‰èƒ½åˆ›å»ºæˆ¿é—´ã€‚

---

## å¿«é€Ÿé›†æˆ

### 4æ­¥å¿«é€Ÿé›†æˆ

#### ç¬¬1æ­¥ï¼šé…ç½®å°ç¨‹åºè·¯ç”±

åœ¨ `app.json` ä¸­æ·»åŠ é¡µé¢è·¯ç”±ï¼š

```json
{
  "pages": [
    "pages/index/index",
    "pages/interview/create/create",
    "pages/interview/host/host",
    "pages/interview/guest/guest",
    "pages/interview/video/video"
  ]
}
```

#### ç¬¬2æ­¥ï¼šåˆ›å»ºAPIè¯·æ±‚å·¥å…·

åˆ›å»º `utils/request.js`ï¼š

```javascript
const BASE_URL = 'https://crm.andejiazheng.com/api';

/**
 * é€šç”¨è¯·æ±‚å‡½æ•°ï¼ˆéœ€è¦ç™»å½•ï¼‰
 */
function request(url, method = 'GET', data = null) {
  const token = wx.getStorageSync('token');
  
  return new Promise((resolve, reject) => {
    wx.request({
      url: `${BASE_URL}${url}`,
      method,
      data,
      header: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      success: (res) => {
        if (res.statusCode === 200 && res.data.success) {
          resolve(res.data);
        } else {
          reject(new Error(res.data.message || 'è¯·æ±‚å¤±è´¥'));
        }
      },
      fail: reject
    });
  });
}

/**
 * å…¬å¼€è¯·æ±‚å‡½æ•°ï¼ˆæ— éœ€ç™»å½•ï¼‰
 */
function publicRequest(url, method = 'GET', data = null) {
  return new Promise((resolve, reject) => {
    wx.request({
      url: `${BASE_URL}${url}`,
      method,
      data,
      header: {
        'Content-Type': 'application/json'
      },
      success: (res) => {
        if (res.statusCode === 200 && res.data.success) {
          resolve(res.data);
        } else {
          reject(new Error(res.data.message || 'è¯·æ±‚å¤±è´¥'));
        }
      },
      fail: reject
    });
  });
}

module.exports = {
  request,
  publicRequest
};
```

#### ç¬¬3æ­¥ï¼šåˆ›å»ºæƒé™æ£€æŸ¥å·¥å…·

åˆ›å»º `utils/permission.js`ï¼š

```javascript
/**
 * æ£€æŸ¥å¹¶è¯·æ±‚æ‘„åƒå¤´æƒé™
 */
function checkCameraPermission() {
  return new Promise((resolve, reject) => {
    wx.getSetting({
      success(res) {
        if (res.authSetting['scope.camera']) {
          resolve(true);
        } else if (res.authSetting['scope.camera'] === false) {
          wx.showModal({
            title: 'éœ€è¦æ‘„åƒå¤´æƒé™',
            content: 'è§†é¢‘é¢è¯•éœ€è¦ä½¿ç”¨æ‘„åƒå¤´ï¼Œè¯·å‰å¾€è®¾ç½®é¡µé¢æˆæƒ',
            confirmText: 'å»è®¾ç½®',
            success(modalRes) {
              if (modalRes.confirm) {
                wx.openSetting({
                  success(settingRes) {
                    resolve(!!settingRes.authSetting['scope.camera']);
                  }
                });
              } else {
                reject(new Error('ç”¨æˆ·å–æ¶ˆæˆæƒ'));
              }
            }
          });
        } else {
          wx.authorize({
            scope: 'scope.camera',
            success: () => resolve(true),
            fail: () => reject(new Error('ç”¨æˆ·æ‹’ç»æˆæƒæ‘„åƒå¤´'))
          });
        }
      },
      fail: reject
    });
  });
}

/**
 * æ£€æŸ¥å¹¶è¯·æ±‚éº¦å…‹é£æƒé™
 */
function checkRecordPermission() {
  return new Promise((resolve, reject) => {
    wx.getSetting({
      success(res) {
        if (res.authSetting['scope.record']) {
          resolve(true);
        } else if (res.authSetting['scope.record'] === false) {
          wx.showModal({
            title: 'éœ€è¦éº¦å…‹é£æƒé™',
            content: 'è§†é¢‘é¢è¯•éœ€è¦ä½¿ç”¨éº¦å…‹é£ï¼Œè¯·å‰å¾€è®¾ç½®é¡µé¢æˆæƒ',
            confirmText: 'å»è®¾ç½®',
            success(modalRes) {
              if (modalRes.confirm) {
                wx.openSetting({
                  success(settingRes) {
                    resolve(!!settingRes.authSetting['scope.record']);
                  }
                });
              } else {
                reject(new Error('ç”¨æˆ·å–æ¶ˆæˆæƒ'));
              }
            }
          });
        } else {
          wx.authorize({
            scope: 'scope.record',
            success: () => resolve(true),
            fail: () => reject(new Error('ç”¨æˆ·æ‹’ç»æˆæƒéº¦å…‹é£'))
          });
        }
      },
      fail: reject
    });
  });
}

/**
 * æ£€æŸ¥æ‰€æœ‰å¿…éœ€æƒé™
 */
async function checkAllPermissions() {
  try {
    await checkCameraPermission();
    await checkRecordPermission();
    return true;
  } catch (error) {
    console.error('æƒé™æ£€æŸ¥å¤±è´¥:', error);
    return false;
  }
}

module.exports = {
  checkCameraPermission,
  checkRecordPermission,
  checkAllPermissions
};
```

#### ç¬¬4æ­¥ï¼šåˆ›å»ºè§†é¢‘é¢è¯•é¡µé¢

åˆ›å»º `pages/interview/host/host.wxml`ï¼š

```xml
<view class="container">
  <web-view 
    src="{{webviewUrl}}" 
    bindmessage="handleMessage"
    binderror="handleError"
    bindload="handleLoad"
  ></web-view>
  
  <!-- åŠ è½½æç¤º -->
  <view wx:if="{{loading}}" class="loading-mask">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <text class="loading-text">æ­£åœ¨åŠ è½½è§†é¢‘é¢è¯•...</text>
    </view>
  </view>
</view>
```

---

## APIæ¥å£æ–‡æ¡£

### 1. ç”ŸæˆZEGO Tokenï¼ˆå·²ç™»å½•ç”¨æˆ·ï¼‰

**æ¥å£åœ°å€**ï¼š`POST /api/zego/generate-token`

**éœ€è¦è®¤è¯**ï¼šâœ… æ˜¯ï¼ˆJWT Tokenï¼‰

**åŠŸèƒ½è¯´æ˜**ï¼šä¸ºå·²ç™»å½•çš„HRç”¨æˆ·ç”ŸæˆZEGO Tokenå¹¶åˆ›å»ºæˆ¿é—´

**è¯·æ±‚å¤´**ï¼š
```json
{
  "Authorization": "Bearer {token}",
  "Content-Type": "application/json"
}
```

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "userId": "user_123",
  "roomId": "room_1234567_abc",
  "userName": "å¼ ä¸‰",
  "expireTime": 7200
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "data": {
    "token": "04AAAAAGR...",
    "appId": 123456789
  }
}
```

**å°ç¨‹åºè°ƒç”¨ç¤ºä¾‹**ï¼š
```javascript
const { request } = require('../../../utils/request');

async function createRoom(roomId, userName) {
  const userId = wx.getStorageSync('userId');
  
  const res = await request('/zego/generate-token', 'POST', {
    userId,
    roomId,
    userName,
    expireTime: 7200
  });
  
  return res.data;
}
```

### 2. ç”Ÿæˆè®¿å®¢Tokenï¼ˆæ— éœ€ç™»å½•ï¼‰

**æ¥å£åœ°å€**ï¼š`POST /api/zego/generate-guest-token`

**éœ€è¦è®¤è¯**ï¼šâŒ å¦

**åŠŸèƒ½è¯´æ˜**ï¼šä¸ºè®¿å®¢ï¼ˆåº”è˜è€…ï¼‰ç”ŸæˆZEGO TokenåŠ å…¥æˆ¿é—´

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "userId": "guest_456",
  "roomId": "room_1234567_abc",
  "userName": "æå››",
  "expireTime": 7200
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "data": {
    "token": "04AAAAAGR...",
    "appId": 123456789
  }
}
```

**å°ç¨‹åºè°ƒç”¨ç¤ºä¾‹**ï¼š
```javascript
const { publicRequest } = require('../../../utils/request');

async function joinRoomAsGuest(roomId, userName) {
  const userId = `guest_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
  
  const res = await publicRequest('/zego/generate-guest-token', 'POST', {
    userId,
    roomId,
    userName,
    expireTime: 7200
  });
  
  return res.data;
}
```

### 3. æ£€æŸ¥æˆ¿é—´çŠ¶æ€

**æ¥å£åœ°å€**ï¼š`POST /api/zego/check-room`

**éœ€è¦è®¤è¯**ï¼šâŒ å¦

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "roomId": "room_1234567_abc"
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "data": {
    "exists": true,
    "isDismissed": false,
    "participantCount": 3,
    "hostUserId": "user_123"
  }
}
```

### 4. è§£æ•£æˆ¿é—´

**æ¥å£åœ°å€**ï¼š`POST /api/zego/dismiss-room`

**éœ€è¦è®¤è¯**ï¼šâœ… æ˜¯ï¼ˆä»…ä¸»æŒäººï¼‰

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "roomId": "room_1234567_abc"
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "message": "æˆ¿é—´å·²è§£æ•£ï¼Œæ‰€æœ‰ç”¨æˆ·å·²è¢«å¼ºåˆ¶è¸¢å‡º"
}
```

### 5. æ¨é€æè¯å™¨å†…å®¹

**æ¥å£åœ°å€**ï¼š`POST /api/zego/push-teleprompter`

**éœ€è¦è®¤è¯**ï¼šâœ… æ˜¯ï¼ˆä»…ä¸»æŒäººï¼‰

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "roomId": "room_1234567_abc",
  "content": "æ¬¢è¿å‚åŠ é¢è¯•ï¼Œè¯·å…ˆåšä¸€ä¸‹è‡ªæˆ‘ä»‹ç»...",
  "targetUserIds": ["user_456", "user_789"],
  "scrollSpeed": 30,
  "displayHeight": 200
}
```

### 6. è·å–æè¯å™¨æ¶ˆæ¯

**æ¥å£åœ°å€**ï¼š`POST /api/zego/get-teleprompter`

**éœ€è¦è®¤è¯**ï¼šâŒ å¦

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "roomId": "room_1234567_abc",
  "userId": "user_456",
  "lastTimestamp": 1699999999000
}
```

---

## å®Œæ•´ä»£ç ç¤ºä¾‹

### åœºæ™¯1ï¼šHRåˆ›å»ºé¢è¯•æˆ¿é—´

#### é¡µé¢ç»“æ„ï¼ˆcreate.wxmlï¼‰

```xml
<view class="container">
  <view class="header">
    <text class="title">åˆ›å»ºè§†é¢‘é¢è¯•</text>
  </view>

  <view class="form">
    <view class="form-item">
      <text class="label">æ‚¨çš„å§“å</text>
      <input 
        class="input" 
        value="{{userName}}" 
        bindinput="onUserNameInput"
        placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å"
      />
    </view>

    <button 
      class="create-btn" 
      type="primary"
      bindtap="createInterview"
      loading="{{loading}}"
    >
      åˆ›å»ºé¢è¯•é—´
    </button>
  </view>
</view>
```

#### é¡µé¢é€»è¾‘ï¼ˆcreate.jsï¼‰

```javascript
const { request } = require('../../../utils/request');
const { checkAllPermissions } = require('../../../utils/permission');

Page({
  data: {
    userName: '',
    loading: false
  },

  onLoad() {
    // è·å–ç”¨æˆ·ä¿¡æ¯
    const userInfo = wx.getStorageSync('userInfo');
    this.setData({
      userName: userInfo.name || ''
    });
  },

  onUserNameInput(e) {
    this.setData({
      userName: e.detail.value
    });
  },

  async createInterview() {
    const { userName } = this.data;

    if (!userName) {
      wx.showToast({
        title: 'è¯·è¾“å…¥å§“å',
        icon: 'none'
      });
      return;
    }

    // æ£€æŸ¥æƒé™
    const hasPermission = await checkAllPermissions();
    if (!hasPermission) {
      wx.showModal({
        title: 'æƒé™ä¸è¶³',
        content: 'è§†é¢‘é¢è¯•éœ€è¦æ‘„åƒå¤´å’Œéº¦å…‹é£æƒé™',
        showCancel: false
      });
      return;
    }

    // ç”Ÿæˆæˆ¿é—´å·
    const roomId = `room_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;

    this.setData({ loading: true });

    try {
      // è°ƒç”¨åç«¯APIç”ŸæˆTokenï¼ˆä¼šè‡ªåŠ¨åˆ›å»ºæˆ¿é—´ï¼‰
      const userId = wx.getStorageSync('userId');
      await request('/zego/generate-token', 'POST', {
        userId,
        roomId,
        userName,
        expireTime: 7200
      });

      // è·³è½¬åˆ°è§†é¢‘é¢è¯•é¡µé¢
      wx.navigateTo({
        url: `/pages/interview/host/host?roomId=${roomId}&userName=${encodeURIComponent(userName)}`
      });
    } catch (error) {
      wx.showToast({
        title: error.message || 'åˆ›å»ºå¤±è´¥',
        icon: 'none'
      });
    } finally {
      this.setData({ loading: false });
    }
  }
});
```

#### é¡µé¢æ ·å¼ï¼ˆcreate.wxssï¼‰

```css
.container {
  padding: 40rpx;
  background: linear-gradient(135deg, #5DBFB3 0%, #4A9D93 100%);
  min-height: 100vh;
}

.header {
  text-align: center;
  margin-bottom: 80rpx;
}

.title {
  font-size: 48rpx;
  font-weight: bold;
  color: #fff;
}

.form {
  background: #fff;
  border-radius: 20rpx;
  padding: 40rpx;
}

.form-item {
  margin-bottom: 40rpx;
}

.label {
  display: block;
  font-size: 28rpx;
  color: #333;
  margin-bottom: 20rpx;
}

.input {
  width: 100%;
  height: 80rpx;
  border: 2rpx solid #e0e0e0;
  border-radius: 10rpx;
  padding: 0 20rpx;
  font-size: 28rpx;
}

.create-btn {
  margin-top: 40rpx;
  background: #5DBFB3;
  border-radius: 10rpx;
  height: 88rpx;
  line-height: 88rpx;
  font-size: 32rpx;
}
```

### åœºæ™¯2ï¼šè®¿å®¢åŠ å…¥é¢è¯•

#### é¡µé¢ç»“æ„ï¼ˆguest.wxmlï¼‰

```xml
<view class="container">
  <view class="header">
    <text class="title">åŠ å…¥è§†é¢‘é¢è¯•</text>
    <text class="subtitle">æˆ¿é—´å·ï¼š{{roomId}}</text>
  </view>

  <view class="form">
    <view class="form-item">
      <text class="label">æ‚¨çš„å§“å</text>
      <input 
        class="input" 
        value="{{userName}}" 
        bindinput="onUserNameInput"
        placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å"
      />
    </view>

    <button 
      class="join-btn" 
      type="primary"
      bindtap="joinInterview"
      loading="{{loading}}"
    >
      åŠ å…¥é¢è¯•
    </button>
  </view>
</view>
```

#### é¡µé¢é€»è¾‘ï¼ˆguest.jsï¼‰

```javascript
const { publicRequest } = require('../../../utils/request');
const { checkAllPermissions } = require('../../../utils/permission');

Page({
  data: {
    roomId: '',
    userName: '',
    loading: false
  },

  onLoad(options) {
    // ä»URLå‚æ•°æˆ–æ‰«ç è·å–æˆ¿é—´å·
    const roomId = options.roomId || options.scene;
    
    if (!roomId) {
      wx.showModal({
        title: 'é”™è¯¯',
        content: 'æœªè·å–åˆ°æˆ¿é—´å·',
        showCancel: false,
        success: () => wx.navigateBack()
      });
      return;
    }

    this.setData({ roomId });
  },

  onUserNameInput(e) {
    this.setData({
      userName: e.detail.value.trim()
    });
  },

  async joinInterview() {
    const { roomId, userName } = this.data;

    if (!userName) {
      wx.showToast({
        title: 'è¯·è¾“å…¥æ‚¨çš„å§“å',
        icon: 'none'
      });
      return;
    }

    // æ£€æŸ¥æƒé™
    const hasPermission = await checkAllPermissions();
    if (!hasPermission) {
      wx.showModal({
        title: 'æƒé™ä¸è¶³',
        content: 'è§†é¢‘é¢è¯•éœ€è¦æ‘„åƒå¤´å’Œéº¦å…‹é£æƒé™',
        showCancel: false
      });
      return;
    }

    this.setData({ loading: true });

    try {
      // æ£€æŸ¥æˆ¿é—´çŠ¶æ€
      const roomStatus = await publicRequest('/zego/check-room', 'POST', { roomId });
      
      if (!roomStatus.data.exists || roomStatus.data.isDismissed) {
        throw new Error('æˆ¿é—´ä¸å­˜åœ¨æˆ–å·²ç»“æŸ');
      }

      // è·³è½¬åˆ°è§†é¢‘é¢è¯•é¡µé¢
      wx.navigateTo({
        url: `/pages/interview/video/video?roomId=${roomId}&userName=${encodeURIComponent(userName)}`
      });
    } catch (error) {
      wx.showToast({
        title: error.message || 'åŠ å…¥å¤±è´¥',
        icon: 'none'
      });
    } finally {
      this.setData({ loading: false });
    }
  }
});
```

### åœºæ™¯3ï¼šWebViewè§†é¢‘é¢è¯•é¡µé¢

#### é¡µé¢ç»“æ„ï¼ˆhost.wxmlï¼‰

```xml
<view class="container">
  <web-view 
    src="{{webviewUrl}}" 
    bindmessage="handleMessage"
    binderror="handleError"
    bindload="handleLoad"
  ></web-view>
  
  <view wx:if="{{loading}}" class="loading-mask">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <text class="loading-text">æ­£åœ¨åŠ è½½è§†é¢‘é¢è¯•...</text>
    </view>
  </view>
</view>
```

#### é¡µé¢é€»è¾‘ï¼ˆhost.jsï¼‰

```javascript
Page({
  data: {
    webviewUrl: '',
    loading: true
  },

  onLoad(options) {
    const { roomId, userName } = options;

    if (!roomId || !userName) {
      wx.showModal({
        title: 'é”™è¯¯',
        content: 'ç¼ºå°‘å¿…è¦å‚æ•°',
        showCancel: false,
        success: () => wx.navigateBack()
      });
      return;
    }

    // æ„å»ºWebView URL
    const token = wx.getStorageSync('token');
    const webviewUrl = `https://crm.andejiazheng.com/interview/miniprogram?roomId=${roomId}&userName=${encodeURIComponent(userName)}&token=${token}`;

    this.setData({ webviewUrl });
  },

  handleLoad() {
    this.setData({ loading: false });
  },

  handleError(e) {
    console.error('WebViewåŠ è½½å¤±è´¥:', e);
    wx.showModal({
      title: 'åŠ è½½å¤±è´¥',
      content: 'è§†é¢‘é¢è¯•é¡µé¢åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥',
      showCancel: false,
      success: () => wx.navigateBack()
    });
  },

  handleMessage(e) {
    const messages = e.detail.data;
    const lastMessage = messages[messages.length - 1];

    switch (lastMessage.type) {
      case 'joined':
        wx.showToast({
          title: 'å·²åŠ å…¥è§†é¢‘é¢è¯•',
          icon: 'success'
        });
        break;
      case 'leave':
        wx.showToast({
          title: 'å·²ç¦»å¼€è§†é¢‘é¢è¯•',
          icon: 'success'
        });
        setTimeout(() => wx.navigateBack(), 1000);
        break;
      case 'error':
        wx.showModal({
          title: 'å‘ç”Ÿé”™è¯¯',
          content: lastMessage.message,
          showCancel: false
        });
        break;
    }
  }
});
```

#### é¡µé¢æ ·å¼ï¼ˆhost.wxssï¼‰

```css
.container {
  width: 100vw;
  height: 100vh;
  position: relative;
}

.loading-mask {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

.loading-content {
  text-align: center;
}

.loading-spinner {
  width: 80rpx;
  height: 80rpx;
  border: 6rpx solid rgba(255, 255, 255, 0.3);
  border-top-color: #5DBFB3;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 30rpx;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.loading-text {
  color: #fff;
  font-size: 28rpx;
}
```

---

## å¸¸è§åœºæ™¯å®ç°

### åœºæ™¯1ï¼šåˆ†äº«é¢è¯•é—´

```javascript
// åœ¨ create.js ä¸­æ·»åŠ 
onShareAppMessage() {
  return {
    title: `${this.data.userName} é‚€è¯·æ‚¨å‚åŠ è§†é¢‘é¢è¯•`,
    path: `/pages/interview/guest/guest?roomId=${this.data.roomId}`,
    imageUrl: '/images/share-interview.png'
  };
}
```

### åœºæ™¯2ï¼šç”Ÿæˆå°ç¨‹åºç 

```javascript
const { request } = require('../../../utils/request');

async function generateQRCode(roomId) {
  const res = await request('/wechat/generate-qrcode', 'POST', {
    page: 'pages/interview/guest/guest',
    scene: `roomId=${roomId}`,
    width: 280
  });
  
  return res.data.qrcodeUrl;
}
```

---

## è°ƒè¯•æŒ‡å—

### 1. å¾®ä¿¡å¼€å‘è€…å·¥å…·è°ƒè¯•

1. æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·
2. ç‚¹å‡»"è¯¦æƒ…" â†’ "æœ¬åœ°è®¾ç½®"
3. å‹¾é€‰"ä¸æ ¡éªŒåˆæ³•åŸŸå"
4. å‹¾é€‰"æ‰“å¼€è°ƒè¯•"

### 2. çœŸæœºè°ƒè¯•

1. ç‚¹å‡»"çœŸæœºè°ƒè¯•"æŒ‰é’®
2. ä½¿ç”¨å¾®ä¿¡æ‰«ç 
3. æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—

### 3. æ—¥å¿—è¾“å‡ºè§„èŒƒ

```javascript
// å°ç¨‹åºç«¯
console.log('ğŸ“± [å°ç¨‹åº]', 'æ—¥å¿—å†…å®¹');

// H5ç«¯
console.log('ğŸŒ [H5]', 'æ—¥å¿—å†…å®¹');
```

---

## å¸¸è§é—®é¢˜FAQ

### Q1: WebViewæ— æ³•åŠ è½½ï¼Ÿ
**A**: æ£€æŸ¥ä¸šåŠ¡åŸŸåé…ç½®ï¼Œç¡®ä¿å·²æ·»åŠ  `https://crm.andejiazheng.com`

### Q2: è§†é¢‘é»‘å±ï¼Ÿ
**A**: æ£€æŸ¥æ‘„åƒå¤´æƒé™ã€ç½‘ç»œè¿æ¥ã€ZEGO Tokenæ˜¯å¦æ­£å¸¸

### Q3: æ— æ³•æ”¶åˆ°H5æ¶ˆæ¯ï¼Ÿ
**A**: postMessageåªåœ¨ç‰¹å®šæ—¶æœºè§¦å‘ï¼ˆé¡µé¢åé€€ã€ç»„ä»¶é”€æ¯ã€åˆ†äº«ï¼‰

### Q4: å¦‚ä½•å®ç°å®æ—¶é€šä¿¡ï¼Ÿ
**A**: ä½¿ç”¨WebSocketæˆ–è½®è¯¢API

### Q5: å¦‚ä½•ä¼˜åŒ–è§†é¢‘è´¨é‡ï¼Ÿ
**A**: ä½¿ç”¨WiFiã€è°ƒæ•´åˆ†è¾¨ç‡ã€é™åˆ¶å‚ä¸äººæ•°

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0.0  
**æœ€åæ›´æ–°**ï¼š2024-01-15  
**ç»´æŠ¤è€…**ï¼šå®‰å¾—å®¶æ”¿æŠ€æœ¯å›¢é˜Ÿ

