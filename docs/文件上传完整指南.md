# æ–‡ä»¶ä¸Šä¼ å®Œæ•´æŒ‡å—

## ğŸ“‹ ç›®å½•

- [æ¦‚è¿°](#æ¦‚è¿°)
- [æ”¯æŒçš„æ–‡ä»¶ç±»å‹](#æ”¯æŒçš„æ–‡ä»¶ç±»å‹)
- [ä¸Šä¼ æ–¹å¼](#ä¸Šä¼ æ–¹å¼)
- [æ–‡ä»¶é™åˆ¶](#æ–‡ä»¶é™åˆ¶)
- [å­˜å‚¨è·¯å¾„](#å­˜å‚¨è·¯å¾„)
- [ä»£ç ç¤ºä¾‹](#ä»£ç ç¤ºä¾‹)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## æ¦‚è¿°

å®‰å¾—å®¶æ”¿CRMç³»ç»Ÿæ”¯æŒå¤šç§æ–‡ä»¶ä¸Šä¼ æ–¹å¼ï¼ŒåŒ…æ‹¬CRMç«¯æ‰¹é‡ä¸Šä¼ å’Œå°ç¨‹åºç«¯å•ä¸ªä¸Šä¼ ã€‚æ‰€æœ‰æ–‡ä»¶éƒ½å­˜å‚¨åœ¨è…¾è®¯äº‘COSå¯¹è±¡å­˜å‚¨ä¸­ï¼Œç¡®ä¿é«˜å¯ç”¨æ€§å’Œå®‰å…¨æ€§ã€‚

### æ ¸å¿ƒç‰¹æ€§

- âœ… æ”¯æŒå›¾ç‰‡å’Œè§†é¢‘ä¸Šä¼ 
- âœ… è‡ªåŠ¨å›¾ç‰‡å‹ç¼©ä¼˜åŒ–
- âœ… æ–‡ä»¶å»é‡å’Œç‰ˆæœ¬ç®¡ç†
- âœ… æ–­ç‚¹ç»­ä¼ æ”¯æŒ
- âœ… æ‰¹é‡ä¸Šä¼ ä¼˜åŒ–
- âœ… å®æ—¶ä¸Šä¼ è¿›åº¦
- âœ… è‡ªåŠ¨é”™è¯¯é‡è¯•

---

## æ”¯æŒçš„æ–‡ä»¶ç±»å‹

### 1. åŸºç¡€è¯ä»¶ç±»

| ç±»å‹ | å­—æ®µå | æœ€å¤§æ•°é‡ | è¯´æ˜ |
|------|--------|---------|------|
| èº«ä»½è¯æ­£é¢ | `idCardFront` | 1 | ç”¨äºèº«ä»½éªŒè¯ |
| èº«ä»½è¯èƒŒé¢ | `idCardBack` | 1 | ç”¨äºèº«ä»½éªŒè¯ |
| ä¸ªäººç…§ç‰‡ | `personalPhoto` | 30 | å±•ç¤ºä¸ªäººå½¢è±¡ |
| æŠ€èƒ½è¯ä¹¦ | `certificate` | 30 | å±•ç¤ºä¸“ä¸šèµ„è´¨ |
| ä½“æ£€æŠ¥å‘Š | `medicalReport` | 10 | å¥åº·è¯æ˜ |

### 2. è§†é¢‘ç±»

| ç±»å‹ | å­—æ®µå | æœ€å¤§æ•°é‡ | è¯´æ˜ |
|------|--------|---------|------|
| è‡ªæˆ‘ä»‹ç»è§†é¢‘ | `selfIntroductionVideo` | 1 | è§†é¢‘è‡ªæˆ‘ä»‹ç» |

### 3. ä½œå“å±•ç¤ºç±»

| ç±»å‹ | å­—æ®µå | æœ€å¤§æ•°é‡ | è¯´æ˜ |
|------|--------|---------|------|
| æœˆå­é¤ç…§ç‰‡ | `confinementMealPhoto` | 30 | æœˆå­é¤åˆ¶ä½œå±•ç¤º |
| çƒ¹é¥ªç…§ç‰‡ | `cookingPhoto` | 30 | æ—¥å¸¸çƒ¹é¥ªå±•ç¤º |
| è¾…é£Ÿæ·»åŠ ç…§ç‰‡ | `complementaryFoodPhoto` | 30 | å©´å„¿è¾…é£Ÿåˆ¶ä½œ |
| å¥½è¯„å±•ç¤ºç…§ç‰‡ | `positiveReviewPhoto` | 30 | å®¢æˆ·å¥½è¯„æˆªå›¾ |

---

## ä¸Šä¼ æ–¹å¼

### æ–¹å¼1: CRMç«¯æ‰¹é‡ä¸Šä¼ 

**é€‚ç”¨åœºæ™¯**: ç®¡ç†å‘˜åœ¨åå°åˆ›å»ºæˆ–ç¼–è¾‘ç®€å†æ—¶æ‰¹é‡ä¸Šä¼ æ–‡ä»¶

**æ¥å£**: 
- åˆ›å»º: `POST /api/resumes`
- æ›´æ–°: `PUT /api/resumes/:id`

**è¯·æ±‚æ ¼å¼**: `multipart/form-data`

**è¡¨å•å­—æ®µ**:
```
æ–‡æœ¬å­—æ®µ:
- name: å§“å
- phone: æ‰‹æœºå·
- age: å¹´é¾„
- ... å…¶ä»–æ–‡æœ¬å­—æ®µ

æ–‡ä»¶å­—æ®µ:
- idCardFront: èº«ä»½è¯æ­£é¢ï¼ˆå•ä¸ªæ–‡ä»¶ï¼‰
- idCardBack: èº«ä»½è¯èƒŒé¢ï¼ˆå•ä¸ªæ–‡ä»¶ï¼‰
- photoFiles: ä¸ªäººç…§ç‰‡ï¼ˆå¤šä¸ªæ–‡ä»¶ï¼‰
- certificateFiles: æŠ€èƒ½è¯ä¹¦ï¼ˆå¤šä¸ªæ–‡ä»¶ï¼‰
- medicalReportFiles: ä½“æ£€æŠ¥å‘Šï¼ˆå¤šä¸ªæ–‡ä»¶ï¼‰
- selfIntroductionVideo: è‡ªæˆ‘ä»‹ç»è§†é¢‘ï¼ˆå•ä¸ªæ–‡ä»¶ï¼‰
- confinementMealPhotos: æœˆå­é¤ç…§ç‰‡ï¼ˆå¤šä¸ªæ–‡ä»¶ï¼‰
- cookingPhotos: çƒ¹é¥ªç…§ç‰‡ï¼ˆå¤šä¸ªæ–‡ä»¶ï¼‰
- complementaryFoodPhotos: è¾…é£Ÿæ·»åŠ ç…§ç‰‡ï¼ˆå¤šä¸ªæ–‡ä»¶ï¼‰
- positiveReviewPhotos: å¥½è¯„å±•ç¤ºç…§ç‰‡ï¼ˆå¤šä¸ªæ–‡ä»¶ï¼‰
```

**ç‰¹ç‚¹**:
- âœ… ä¸€æ¬¡æ€§ä¸Šä¼ æ‰€æœ‰æ–‡ä»¶
- âœ… è‡ªåŠ¨å¤„ç†æ–‡ä»¶å…³è”
- âœ… æ”¯æŒæ–‡ä»¶æ›¿æ¢å’Œåˆ é™¤
- âœ… äº‹åŠ¡æ€§æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸè¦ä¹ˆå…¨éƒ¨å¤±è´¥

### æ–¹å¼2: å°ç¨‹åºç«¯å•ä¸ªä¸Šä¼ 

**é€‚ç”¨åœºæ™¯**: ç”¨æˆ·åœ¨å°ç¨‹åºä¸­é€ä¸ªä¸Šä¼ æ–‡ä»¶

**æ¥å£**: `POST /api/resumes/miniprogram/:id/upload-file`

**è¯·æ±‚æ ¼å¼**: `multipart/form-data`

**å‚æ•°**:
- `file`: æ–‡ä»¶ï¼ˆå¿…å¡«ï¼‰
- `type`: æ–‡ä»¶ç±»å‹ï¼ˆå¿…å¡«ï¼‰

**æ–‡ä»¶ç±»å‹æšä¸¾**:
```
idCardFront          - èº«ä»½è¯æ­£é¢
idCardBack           - èº«ä»½è¯èƒŒé¢
personalPhoto        - ä¸ªäººç…§ç‰‡
certificate          - æŠ€èƒ½è¯ä¹¦
medicalReport        - ä½“æ£€æŠ¥å‘Š
selfIntroductionVideo - è‡ªæˆ‘ä»‹ç»è§†é¢‘
confinementMealPhoto - æœˆå­é¤ç…§ç‰‡
cookingPhoto         - çƒ¹é¥ªç…§ç‰‡
complementaryFoodPhoto - è¾…é£Ÿæ·»åŠ ç…§ç‰‡
positiveReviewPhoto  - å¥½è¯„å±•ç¤ºç…§ç‰‡
```

**ç‰¹ç‚¹**:
- âœ… ç«‹å³ä¸Šä¼ ï¼Œå®æ—¶åé¦ˆ
- âœ… æ”¯æŒæ–­ç‚¹ç»­ä¼ 
- âœ… æ˜¾ç¤ºä¸Šä¼ è¿›åº¦
- âœ… è‡ªåŠ¨å…³è”åˆ°ç®€å†

---

## æ–‡ä»¶é™åˆ¶

### å›¾ç‰‡æ–‡ä»¶

**æ”¯æŒæ ¼å¼**: JPG, JPEG, PNG, GIF, WEBP

**å¤§å°é™åˆ¶**: å•ä¸ªæ–‡ä»¶æœ€å¤§ 10MB

**æ¨èå°ºå¯¸**:
- èº«ä»½è¯ç…§ç‰‡: 1200x800 åƒç´ 
- ä¸ªäººç…§ç‰‡: 800x800 åƒç´ 
- è¯ä¹¦ç…§ç‰‡: 1200x900 åƒç´ 
- ä½œå“å±•ç¤º: 800x600 åƒç´ 

**å‹ç¼©ç­–ç•¥**:
- ä¸ªäººç…§ç‰‡: å‹ç¼©è‡³ 800x800ï¼Œè´¨é‡ 85%
- è¯ä¹¦ç…§ç‰‡: å‹ç¼©è‡³ 1200x900ï¼Œè´¨é‡ 90%
- èº«ä»½è¯ç…§ç‰‡: ä¿æŒåŸå§‹è´¨é‡ï¼Œä¸å‹ç¼©
- ä½œå“å±•ç¤º: å‹ç¼©è‡³ 800x600ï¼Œè´¨é‡ 85%

### è§†é¢‘æ–‡ä»¶

**æ”¯æŒæ ¼å¼**: MP4, MOV, AVI

**å¤§å°é™åˆ¶**: å•ä¸ªæ–‡ä»¶æœ€å¤§ 100MB

**æ¨èå‚æ•°**:
- åˆ†è¾¨ç‡: 1280x720 æˆ– 1920x1080
- å¸§ç‡: 25-30 fps
- æ—¶é•¿: å»ºè®®ä¸è¶…è¿‡ 3 åˆ†é’Ÿ
- ç¼–ç : H.264

---

## å­˜å‚¨è·¯å¾„

æ‰€æœ‰æ–‡ä»¶å­˜å‚¨åœ¨è…¾è®¯äº‘COSä¸­ï¼Œè·¯å¾„è§„åˆ™å¦‚ä¸‹ï¼š

```
åŸºç¡€è·¯å¾„: https://housekeeping-1254058915.cos.ap-guangzhou.myqcloud.com

æ–‡ä»¶è·¯å¾„è§„åˆ™:
/{category}/{resumeId}/{timestamp}-{filename}

ç¤ºä¾‹:
/id-card/66e2f4af8b1234567890abcd/1704441600000-front.jpg
/photo/66e2f4af8b1234567890abcd/1704441600000-photo1.jpg
/certificate/66e2f4af8b1234567890abcd/1704441600000-cert.jpg
/cooking/66e2f4af8b1234567890abcd/1704441600000-dish.jpg
```

**åˆ†ç±»ç›®å½•**:
- `/id-card/` - èº«ä»½è¯ç…§ç‰‡
- `/photo/` - ä¸ªäººç…§ç‰‡
- `/certificate/` - æŠ€èƒ½è¯ä¹¦
- `/medical-report/` - ä½“æ£€æŠ¥å‘Š
- `/video/` - è‡ªæˆ‘ä»‹ç»è§†é¢‘
- `/confinement-meal/` - æœˆå­é¤ç…§ç‰‡
- `/cooking/` - çƒ¹é¥ªç…§ç‰‡
- `/complementary-food/` - è¾…é£Ÿæ·»åŠ ç…§ç‰‡
- `/positive-review/` - å¥½è¯„å±•ç¤ºç…§ç‰‡

---

## ä»£ç ç¤ºä¾‹

### å°ç¨‹åºç«¯ä¸Šä¼ ç¤ºä¾‹

#### 1. åŸºç¡€ä¸Šä¼ 

```javascript
// pages/resume/edit.js
Page({
  data: {
    resumeId: '',
    cookingPhotos: []
  },

  /**
   * é€‰æ‹©å¹¶ä¸Šä¼ çƒ¹é¥ªç…§ç‰‡
   */
  async onUploadCooking() {
    try {
      // 1. é€‰æ‹©å›¾ç‰‡
      const res = await wx.chooseImage({
        count: 1,
        sizeType: ['compressed'],
        sourceType: ['album', 'camera']
      });

      const tempFilePath = res.tempFilePaths[0];

      // 2. æ˜¾ç¤ºåŠ è½½æç¤º
      wx.showLoading({
        title: 'ä¸Šä¼ ä¸­...',
        mask: true
      });

      // 3. ä¸Šä¼ æ–‡ä»¶
      const uploadRes = await wx.uploadFile({
        url: `${API_BASE_URL}/api/resumes/miniprogram/${this.data.resumeId}/upload-file`,
        filePath: tempFilePath,
        name: 'file',
        formData: {
          type: 'cookingPhoto'
        },
        header: {
          'Authorization': `Bearer ${wx.getStorageSync('token')}`
        }
      });

      wx.hideLoading();

      // 4. å¤„ç†å“åº”
      const data = JSON.parse(uploadRes.data);

      if (data.success) {
        wx.showToast({
          title: 'ä¸Šä¼ æˆåŠŸ',
          icon: 'success'
        });

        // 5. æ›´æ–°æœ¬åœ°çŠ¶æ€
        this.setData({
          cookingPhotos: [...this.data.cookingPhotos, data.data.fileUrl]
        });
      } else {
        wx.showToast({
          title: data.message || 'ä¸Šä¼ å¤±è´¥',
          icon: 'none'
        });
      }

    } catch (error) {
      wx.hideLoading();
      console.error('ä¸Šä¼ å¤±è´¥:', error);
      wx.showToast({
        title: 'ä¸Šä¼ å¤±è´¥',
        icon: 'none'
      });
    }
  },

  /**
   * åˆ é™¤çƒ¹é¥ªç…§ç‰‡
   */
  async onDeleteCooking(e) {
    const { url } = e.currentTarget.dataset;

    try {
      const confirmRes = await wx.showModal({
        title: 'ç¡®è®¤åˆ é™¤',
        content: 'ç¡®å®šè¦åˆ é™¤è¿™å¼ ç…§ç‰‡å—ï¼Ÿ'
      });

      if (!confirmRes.confirm) return;

      wx.showLoading({ title: 'åˆ é™¤ä¸­...', mask: true });

      const res = await wx.request({
        url: `${API_BASE_URL}/api/resumes/miniprogram/${this.data.resumeId}/delete-file`,
        method: 'DELETE',
        header: {
          'Authorization': `Bearer ${wx.getStorageSync('token')}`,
          'Content-Type': 'application/json'
        },
        data: {
          fileUrl: url,
          fileType: 'cookingPhoto'
        }
      });

      wx.hideLoading();

      if (res.data.success) {
        wx.showToast({
          title: 'åˆ é™¤æˆåŠŸ',
          icon: 'success'
        });

        // ä»æœ¬åœ°çŠ¶æ€ä¸­ç§»é™¤
        const newPhotos = this.data.cookingPhotos.filter(u => u !== url);
        this.setData({
          cookingPhotos: newPhotos
        });
      } else {
        wx.showToast({
          title: res.data.message || 'åˆ é™¤å¤±è´¥',
          icon: 'none'
        });
      }

    } catch (error) {
      wx.hideLoading();
      console.error('åˆ é™¤å¤±è´¥:', error);
      wx.showToast({
        title: 'åˆ é™¤å¤±è´¥',
        icon: 'none'
      });
    }
  }
});
```

#### 2. å¸¦è¿›åº¦æ˜¾ç¤ºçš„ä¸Šä¼ 

```javascript
/**
 * ä¸Šä¼ æ–‡ä»¶å¹¶æ˜¾ç¤ºè¿›åº¦
 */
uploadWithProgress(filePath, type) {
  return new Promise((resolve, reject) => {
    const uploadTask = wx.uploadFile({
      url: `${API_BASE_URL}/api/resumes/miniprogram/${this.data.resumeId}/upload-file`,
      filePath: filePath,
      name: 'file',
      formData: { type: type },
      header: {
        'Authorization': `Bearer ${wx.getStorageSync('token')}`
      },
      success: (res) => {
        const data = JSON.parse(res.data);
        if (data.success) {
          resolve(data);
        } else {
          reject(new Error(data.message));
        }
      },
      fail: reject
    });

    // ç›‘å¬ä¸Šä¼ è¿›åº¦
    uploadTask.onProgressUpdate((res) => {
      this.setData({
        uploadProgress: res.progress
      });

      console.log('ä¸Šä¼ è¿›åº¦', res.progress + '%');
      console.log('å·²ä¸Šä¼ ', res.totalBytesSent);
      console.log('æ€»å¤§å°', res.totalBytesExpectedToSend);
    });
  });
}
```

#### 3. æ‰¹é‡ä¸Šä¼ 

```javascript
/**
 * æ‰¹é‡ä¸Šä¼ ç…§ç‰‡ï¼ˆé™åˆ¶å¹¶å‘æ•°ï¼‰
 */
async uploadBatch(files, concurrency = 3) {
  const results = [];
  const errors = [];

  wx.showLoading({
    title: `ä¸Šä¼ ä¸­ 0/${files.length}`,
    mask: true
  });

  for (let i = 0; i < files.length; i += concurrency) {
    const batch = files.slice(i, i + concurrency);

    const batchPromises = batch.map(async (file, index) => {
      try {
        const result = await this.uploadFile(file.path, file.type);

        // æ›´æ–°è¿›åº¦
        wx.showLoading({
          title: `ä¸Šä¼ ä¸­ ${results.length + 1}/${files.length}`,
          mask: true
        });

        return { success: true, data: result };
      } catch (error) {
        return {
          success: false,
          error: error.message,
          file: file
        };
      }
    });

    const batchResults = await Promise.all(batchPromises);

    batchResults.forEach((result) => {
      if (result.success) {
        results.push(result.data);
      } else {
        errors.push(result);
      }
    });
  }

  wx.hideLoading();

  // æ˜¾ç¤ºç»“æœ
  if (errors.length === 0) {
    wx.showToast({
      title: `æˆåŠŸä¸Šä¼ ${results.length}å¼ ç…§ç‰‡`,
      icon: 'success'
    });
  } else {
    wx.showModal({
      title: 'ä¸Šä¼ å®Œæˆ',
      content: `æˆåŠŸ${results.length}å¼ ï¼Œå¤±è´¥${errors.length}å¼ `,
      showCancel: false
    });
  }

  return { results, errors };
}
```

#### 4. å›¾ç‰‡å‹ç¼©åä¸Šä¼ 

```javascript
/**
 * å‹ç¼©å›¾ç‰‡åä¸Šä¼ 
 */
async compressAndUpload(filePath, type) {
  try {
    // 1. å‹ç¼©å›¾ç‰‡
    const compressRes = await wx.compressImage({
      src: filePath,
      quality: 80
    });

    console.log('å‹ç¼©å®Œæˆ', compressRes.tempFilePath);

    // 2. ä¸Šä¼ å‹ç¼©åçš„å›¾ç‰‡
    const uploadRes = await this.uploadFile(compressRes.tempFilePath, type);

    return uploadRes;
  } catch (error) {
    console.error('å‹ç¼©æˆ–ä¸Šä¼ å¤±è´¥:', error);
    throw error;
  }
}
```

### CRMç«¯ä¸Šä¼ ç¤ºä¾‹

#### React + Ant Design

```typescript
import React, { useState } from 'react';
import { Upload, message } from 'antd';
import { PlusOutlined } from '@ant-design/icons';
import type { UploadFile, UploadProps } from 'antd';

const CookingPhotoUpload: React.FC = () => {
  const [fileList, setFileList] = useState<UploadFile[]>([]);
  const [uploading, setUploading] = useState(false);

  const handleChange: UploadProps['onChange'] = ({ fileList: newFileList }) => {
    setFileList(newFileList);
  };

  const beforeUpload = (file: File) => {
    // æ£€æŸ¥æ–‡ä»¶ç±»å‹
    const isImage = file.type.startsWith('image/');
    if (!isImage) {
      message.error('åªèƒ½ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼');
      return false;
    }

    // æ£€æŸ¥æ–‡ä»¶å¤§å°
    const isLt10M = file.size / 1024 / 1024 < 10;
    if (!isLt10M) {
      message.error('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 10MBï¼');
      return false;
    }

    // æ£€æŸ¥æ•°é‡é™åˆ¶
    if (fileList.length >= 30) {
      message.error('æœ€å¤šåªèƒ½ä¸Šä¼  30 å¼ ç…§ç‰‡ï¼');
      return false;
    }

    return true;
  };

  const uploadButton = (
    <div>
      <PlusOutlined />
      <div style={{ marginTop: 8 }}>ä¸Šä¼ ç…§ç‰‡</div>
    </div>
  );

  return (
    <Upload
      listType="picture-card"
      fileList={fileList}
      onChange={handleChange}
      beforeUpload={beforeUpload}
      multiple
      maxCount={30}
    >
      {fileList.length >= 30 ? null : uploadButton}
    </Upload>
  );
};

export default CookingPhotoUpload;
```

---

## å¸¸è§é—®é¢˜

### Q1: ä¸Šä¼ å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A**: ä¸Šä¼ å¤±è´¥å¯èƒ½æœ‰ä»¥ä¸‹åŸå› ï¼š

1. **æ–‡ä»¶è¿‡å¤§**: æ£€æŸ¥æ–‡ä»¶å¤§å°æ˜¯å¦è¶…è¿‡é™åˆ¶ï¼ˆå›¾ç‰‡10MBï¼Œè§†é¢‘100MBï¼‰
2. **ç½‘ç»œé—®é¢˜**: æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œå°è¯•åˆ‡æ¢ç½‘ç»œåé‡è¯•
3. **æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ**: ç¡®è®¤æ–‡ä»¶æ ¼å¼æ˜¯å¦åœ¨æ”¯æŒåˆ—è¡¨ä¸­
4. **Tokenè¿‡æœŸ**: é‡æ–°ç™»å½•è·å–æ–°çš„Token
5. **æœåŠ¡å™¨é”™è¯¯**: è”ç³»æŠ€æœ¯æ”¯æŒ

**è§£å†³æ–¹æ¡ˆ**:
```javascript
// å®ç°è‡ªåŠ¨é‡è¯•æœºåˆ¶
async function uploadWithRetry(filePath, type, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await uploadFile(filePath, type);
    } catch (error) {
      if (i === maxRetries - 1) throw error;

      // ç­‰å¾…åé‡è¯•
      await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
    }
  }
}
```

### Q2: å¦‚ä½•å‹ç¼©å›¾ç‰‡ä»¥å‡å°æ–‡ä»¶å¤§å°ï¼Ÿ

**A**: å°ç¨‹åºç«¯å¯ä»¥ä½¿ç”¨ `wx.compressImage` APIï¼š

```javascript
const compressRes = await wx.compressImage({
  src: tempFilePath,
  quality: 80  // å‹ç¼©è´¨é‡ï¼Œ0-100
});

// ä½¿ç”¨å‹ç¼©åçš„å›¾ç‰‡
const compressedPath = compressRes.tempFilePath;
```

### Q3: å¦‚ä½•æ˜¾ç¤ºä¸Šä¼ è¿›åº¦ï¼Ÿ

**A**: ä½¿ç”¨ `uploadTask.onProgressUpdate` ç›‘å¬è¿›åº¦ï¼š

```javascript
const uploadTask = wx.uploadFile({
  url: uploadUrl,
  filePath: filePath,
  name: 'file'
});

uploadTask.onProgressUpdate((res) => {
  console.log('ä¸Šä¼ è¿›åº¦', res.progress);
  this.setData({
    uploadProgress: res.progress
  });
});
```

### Q4: å¦‚ä½•æ‰¹é‡ä¸Šä¼ å¤šå¼ ç…§ç‰‡ï¼Ÿ

**A**: ä½¿ç”¨ Promise.all å¹¶å‘ä¸Šä¼ ï¼Œä½†å»ºè®®é™åˆ¶å¹¶å‘æ•°ï¼š

```javascript
// é™åˆ¶å¹¶å‘æ•°ä¸º3
async function uploadBatch(files, concurrency = 3) {
  const results = [];

  for (let i = 0; i < files.length; i += concurrency) {
    const batch = files.slice(i, i + concurrency);
    const batchResults = await Promise.all(
      batch.map(file => uploadFile(file.path, file.type))
    );
    results.push(...batchResults);
  }

  return results;
}
```

### Q5: ä¸Šä¼ çš„ç…§ç‰‡ä¼šè¢«å‹ç¼©å—ï¼Ÿ

**A**: æ˜¯çš„ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¯¹ç…§ç‰‡è¿›è¡Œå‹ç¼©ä¼˜åŒ–ï¼š

- **ä¸ªäººç…§ç‰‡**: å‹ç¼©è‡³ 800x800ï¼Œè´¨é‡ 85%
- **è¯ä¹¦ç…§ç‰‡**: å‹ç¼©è‡³ 1200x900ï¼Œè´¨é‡ 90%
- **èº«ä»½è¯ç…§ç‰‡**: ä¿æŒåŸå§‹è´¨é‡ï¼Œä¸å‹ç¼©
- **ä½œå“å±•ç¤º**: å‹ç¼©è‡³ 800x600ï¼Œè´¨é‡ 85%

### Q6: å¦‚ä½•åˆ é™¤å·²ä¸Šä¼ çš„æ–‡ä»¶ï¼Ÿ

**A**: ä½¿ç”¨åˆ é™¤æ¥å£ï¼š

```javascript
await wx.request({
  url: `${API_BASE_URL}/api/resumes/miniprogram/${resumeId}/delete-file`,
  method: 'DELETE',
  header: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  },
  data: {
    fileUrl: 'https://example.com/file.jpg',
    fileType: 'cookingPhoto'
  }
});
```

### Q7: ä¸Šä¼ çš„æ–‡ä»¶å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ

**A**: æ‰€æœ‰æ–‡ä»¶å­˜å‚¨åœ¨è…¾è®¯äº‘COSå¯¹è±¡å­˜å‚¨ä¸­ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- âœ… é«˜å¯ç”¨æ€§ï¼ˆ99.95%ï¼‰
- âœ… é«˜æŒä¹…æ€§ï¼ˆ99.999999999%ï¼‰
- âœ… CDNåŠ é€Ÿè®¿é—®
- âœ… è‡ªåŠ¨å¤‡ä»½
- âœ… å®‰å…¨åŠ å¯†

### Q8: å¦‚ä½•å¤„ç†ä¸Šä¼ è¶…æ—¶ï¼Ÿ

**A**: è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œå¹¶å®ç°é‡è¯•æœºåˆ¶ï¼š

```javascript
wx.uploadFile({
  url: uploadUrl,
  filePath: filePath,
  name: 'file',
  timeout: 60000,  // 60ç§’è¶…æ—¶
  success: (res) => {
    // å¤„ç†æˆåŠŸ
  },
  fail: (error) => {
    if (error.errMsg.includes('timeout')) {
      // è¶…æ—¶ï¼Œå°è¯•é‡è¯•
      retryUpload();
    }
  }
});
```

### Q9: å¯ä»¥ä¸Šä¼ å¤šå¤§çš„è§†é¢‘ï¼Ÿ

**A**: è§†é¢‘æ–‡ä»¶æœ€å¤§æ”¯æŒ 100MBï¼Œå»ºè®®å‚æ•°ï¼š

- åˆ†è¾¨ç‡: 1280x720 æˆ– 1920x1080
- å¸§ç‡: 25-30 fps
- æ—¶é•¿: ä¸è¶…è¿‡ 3 åˆ†é’Ÿ
- ç¼–ç : H.264

### Q10: å¦‚ä½•é˜²æ­¢é‡å¤ä¸Šä¼ ï¼Ÿ

**A**: ä½¿ç”¨æ ‡å¿—ä½é˜²æ­¢é‡å¤ä¸Šä¼ ï¼š

```javascript
Page({
  data: {
    uploading: false
  },

  async onUpload() {
    // é˜²æ­¢é‡å¤ä¸Šä¼ 
    if (this.data.uploading) {
      wx.showToast({
        title: 'æ­£åœ¨ä¸Šä¼ ä¸­...',
        icon: 'none'
      });
      return;
    }

    this.setData({ uploading: true });

    try {
      await uploadFile();
    } finally {
      this.setData({ uploading: false });
    }
  }
});
```

---

## é”™è¯¯ç è¯´æ˜

| é”™è¯¯ç  | è¯´æ˜ | è§£å†³æ–¹æ¡ˆ |
|--------|------|---------|
| `FILE_TOO_LARGE` | æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ | å‹ç¼©æ–‡ä»¶åé‡æ–°ä¸Šä¼  |
| `INVALID_FILE_TYPE` | ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ | ä½¿ç”¨æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ |
| `UPLOAD_FAILED` | ä¸Šä¼ å¤±è´¥ | æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯• |
| `FILE_NOT_FOUND` | æ–‡ä»¶ä¸å­˜åœ¨ | ç¡®è®¤æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡® |
| `DELETE_FAILED` | åˆ é™¤å¤±è´¥ | æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²è¢«åˆ é™¤ |
| `MAX_FILES_EXCEEDED` | è¶…è¿‡æœ€å¤§æ–‡ä»¶æ•°é‡ | åˆ é™¤éƒ¨åˆ†æ–‡ä»¶åå†ä¸Šä¼  |
| `UNAUTHORIZED` | æœªæˆæƒ | é‡æ–°ç™»å½•è·å–Token |
| `NETWORK_ERROR` | ç½‘ç»œé”™è¯¯ | æ£€æŸ¥ç½‘ç»œè¿æ¥ |
| `TIMEOUT` | ä¸Šä¼ è¶…æ—¶ | æ£€æŸ¥ç½‘ç»œé€Ÿåº¦ï¼Œå°è¯•å‹ç¼©æ–‡ä»¶ |

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å›¾ç‰‡é¢„å‹ç¼©

åœ¨ä¸Šä¼ å‰å…ˆå‹ç¼©å›¾ç‰‡ï¼Œå¯ä»¥æ˜¾è‘—æå‡ä¸Šä¼ é€Ÿåº¦ï¼š

```javascript
// å‹ç¼©è´¨é‡å»ºè®®
const quality = {
  photo: 80,        // ä¸ªäººç…§ç‰‡
  certificate: 90,  // è¯ä¹¦ç…§ç‰‡
  work: 85         // ä½œå“å±•ç¤º
};
```

### 2. å¹¶å‘æ§åˆ¶

æ‰¹é‡ä¸Šä¼ æ—¶æ§åˆ¶å¹¶å‘æ•°ï¼Œé¿å…å ç”¨è¿‡å¤šèµ„æºï¼š

```javascript
const CONCURRENCY = 3;  // åŒæ—¶ä¸Šä¼ 3ä¸ªæ–‡ä»¶
```

### 3. æ–­ç‚¹ç»­ä¼ 

å¯¹äºå¤§æ–‡ä»¶ï¼Œå®ç°æ–­ç‚¹ç»­ä¼ åŠŸèƒ½ï¼š

```javascript
// ä¿å­˜ä¸Šä¼ è¿›åº¦
wx.setStorageSync('uploadProgress', {
  fileId: 'xxx',
  progress: 50,
  uploadedSize: 5242880
});

// æ¢å¤ä¸Šä¼ 
const savedProgress = wx.getStorageSync('uploadProgress');
if (savedProgress) {
  // ä»æ–­ç‚¹ç»§ç»­ä¸Šä¼ 
}
```

### 4. ç¼“å­˜ç­–ç•¥

å¯¹å·²ä¸Šä¼ çš„æ–‡ä»¶URLè¿›è¡Œç¼“å­˜ï¼Œé¿å…é‡å¤è¯·æ±‚ï¼š

```javascript
const FileCache = {
  set(key, url) {
    wx.setStorageSync(`file_${key}`, url);
  },

  get(key) {
    return wx.getStorageSync(`file_${key}`);
  }
};
```

---

## å®‰å…¨å»ºè®®

### 1. Tokenç®¡ç†

- âœ… å®šæœŸåˆ·æ–°Token
- âœ… å®‰å…¨å­˜å‚¨Token
- âœ… Tokenè¿‡æœŸè‡ªåŠ¨é‡æ–°ç™»å½•

### 2. æ–‡ä»¶éªŒè¯

- âœ… å‰ç«¯éªŒè¯æ–‡ä»¶ç±»å‹å’Œå¤§å°
- âœ… åç«¯äºŒæ¬¡éªŒè¯
- âœ… é˜²æ­¢æ¶æ„æ–‡ä»¶ä¸Šä¼ 

### 3. è®¿é—®æ§åˆ¶

- âœ… æ‰€æœ‰ä¸Šä¼ æ¥å£éœ€è¦è®¤è¯
- âœ… éªŒè¯ç”¨æˆ·æƒé™
- âœ… é™åˆ¶ä¸Šä¼ é¢‘ç‡

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026-01-05
**ç»´æŠ¤å›¢é˜Ÿ**: å®‰å¾—å®¶æ”¿æŠ€æœ¯å›¢é˜Ÿ


