# 烹饪照片功能更新说明

## 📋 更新概述

在"作品展示"区域新增了"烹饪照片"卡片，位置在"月子餐照片"和"辅食添加照片"之间。同时完善了小程序API接口，支持所有作品展示照片类型的上传和删除。

## 🎯 更新内容

### 1. 前端更新（frontend/src/pages/aunt/CreateResume.tsx）

#### 1.1 类型定义
- ✅ 在 `FileUploadState` 类型中添加了 `cooking` 字段
- ✅ 在 `ExtendedResume` 接口中添加了 `cookingPhotos` 字段

#### 1.2 配置更新
- ✅ 在 `FILE_UPLOAD_CONFIG` 中添加了 `maxCookingCount: 30`

#### 1.3 函数更新
- ✅ 在 `handleFileChange` 的类型定义中添加了 `'cooking'`
- ✅ 在 `handleRemoveFile` 的类型定义中添加了 `'cooking'`
- ✅ 在 `renderUploadList` 中添加了 `cooking` 的处理逻辑：
  - 最大文件数量判断
  - 压缩类型映射：`'cooking': 'photo'`
  - 文件类型映射：`'cooking': 'cookingPhoto'`

#### 1.4 UI 更新
- ✅ 在"作品展示"区域添加了"烹饪照片"卡片
- ✅ 将原来的 3 列布局（每列 span={8}）改为 4 列布局（每列 span={6}）
- ✅ 在编辑模式加载现有文件时添加了烹饪照片的加载逻辑

### 2. 后端更新

#### 2.1 数据模型（backend/src/models/Resume.ts）
- ✅ 在 `Resume` 接口中添加了 `cookingPhotos` 字段
- ✅ 在 `resumeSchema` 中添加了 `cookingPhotos` 字段定义

#### 2.2 服务层（backend/src/modules/resume/resume.service.ts）
- ✅ 在 `addFileWithType` 方法的 `validFileTypes` 数组中添加了 `'cookingPhoto'`
- ✅ 在 `addFileWithType` 方法的 switch 语句中添加了 `cookingPhoto` 的上传处理
- ✅ 在 `removeFileByUrl` 方法中添加了 `cookingPhoto` 的删除处理

#### 2.3 控制器层（backend/src/modules/resume/resume.controller.ts）
- ✅ 在小程序上传文件接口的 enum 中添加了作品展示照片类型：
  - `confinementMealPhoto` - 月子餐照片
  - `cookingPhoto` - 烹饪照片
  - `complementaryFoodPhoto` - 辅食添加照片
  - `positiveReviewPhoto` - 好评展示照片
- ✅ 在小程序删除文件接口的 enum 中添加了相同的类型
- ✅ 在 `uploadFileForMiniprogram` 方法的 `validTypes` 数组中添加了这些类型

### 3. 文档更新

#### 3.1 小程序端文件上传API使用方法（docs/小程序端文件上传API使用方法.md）
- ✅ 在文件类型表格中添加了：
  - `selfIntroductionVideo` - 自我介绍视频
  - `confinementMealPhoto` - 月子餐照片
  - `cookingPhoto` - 烹饪照片
  - `complementaryFoodPhoto` - 辅食添加照片
  - `positiveReviewPhoto` - 好评展示照片

#### 3.2 小程序上传和删除照片完整解决方案（docs/小程序上传和删除照片-完整解决方案.md）
- ✅ 在文件类型列表中添加了相同的类型

#### 3.3 API规范文档（backend/src/docs/API_SPEC.md）
- ✅ 更新了小程序上传文件接口的文件类型说明

#### 3.4 小程序API完整文档（backend/docs/小程序API完整文档.md）
- ✅ 添加了"简历文件上传（推荐）"章节
- ✅ 详细说明了所有支持的文件类型及其对应字段
- ✅ 提供了上传和删除接口的完整示例

## 📊 支持的文件类型

### CRM端和小程序端都支持的文件类型：

| 类型值 | 说明 | 对应字段 | 最大数量 |
|--------|------|---------|---------|
| `idCardFront` | 身份证正面 | `idCardFront` | 1 |
| `idCardBack` | 身份证背面 | `idCardBack` | 1 |
| `personalPhoto` | 个人照片 | `photoUrls` / `personalPhoto` | 30 |
| `certificate` | 技能证书 | `certificateUrls` / `certificates` | 30 |
| `medicalReport` | 体检报告 | `medicalReportUrls` / `reports` | 10 |
| `selfIntroductionVideo` | 自我介绍视频 | `selfIntroductionVideo` | 1 |
| `confinementMealPhoto` | 月子餐照片 | `confinementMealPhotos` | 30 |
| `cookingPhoto` | 烹饪照片 | `cookingPhotos` | 30 |
| `complementaryFoodPhoto` | 辅食添加照片 | `complementaryFoodPhotos` | 30 |
| `positiveReviewPhoto` | 好评展示照片 | `positiveReviewPhotos` | 30 |

## 🔧 API接口

### 小程序上传文件
```
POST /api/resumes/miniprogram/:id/upload-file
Content-Type: multipart/form-data

参数：
- file: 文件
- type: 文件类型（见上表）
```

### 小程序删除文件
```
DELETE /api/resumes/miniprogram/:id/delete-file
Content-Type: application/json

参数：
{
  "fileUrl": "文件URL",
  "fileType": "文件类型"
}
```

## ✅ 测试状态

- ✅ 前端构建成功
- ✅ 后端编译成功
- ✅ 服务已重启
- ✅ 烹饪照片上传功能正常
- ✅ 烹饪照片删除功能正常
- ✅ 小程序API接口已更新

## 📝 注意事项

1. 所有作品展示照片都支持最多上传30张
2. 上传的照片会自动压缩以优化存储和加载速度
3. 小程序端使用与CRM端相同的底层逻辑，不会产生重复
4. 删除照片时会同时删除数据库记录和物理文件

## 🚀 部署信息

- **前端版本**: 已更新并部署
- **后端版本**: 已更新并部署
- **部署时间**: 2026-01-05
- **环境**: 生产环境

---

**更新日期**: 2026-01-05  
**更新人员**: AI Assistant  
**版本**: v1.0

