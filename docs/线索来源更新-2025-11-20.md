# 线索来源更新说明 - 2025-11-20

## 📋 更新内容

在客户的线索来源选项中新增了六个选项：

1. **莲心**
2. **美家**
3. **天机鹿**
4. **孕妈联盟**
5. **高阁**
6. **星星**

## 📝 修改详情

### 修改文件

#### 1. 前端类型定义

**文件路径**：`frontend/src/types/customer.types.ts`

**修改内容**：

```typescript
// 修改前
export const LEAD_SOURCES = ['美团', '抖音', '快手', '小红书', '转介绍', '杭州同馨', '握个手平台', '线索购买', '其他'] as const;

// 修改后
export const LEAD_SOURCES = ['美团', '抖音', '快手', '小红书', '转介绍', '杭州同馨', '握个手平台', '线索购买', '莲心', '美家', '天机鹿', '孕妈联盟', '高阁', '星星', '其他'] as const;
```

#### 2. 后端 DTO 验证

**文件路径**：`backend/src/modules/customers/dto/create-customer.dto.ts`

**修改内容**：

```typescript
// 修改前
@IsEnum(['美团', '抖音', '快手', '小红书', '转介绍', '杭州同馨', '握个手平台', '线索购买', '其他'], {
  message: '线索来源必须是：美团、抖音、快手、小红书、转介绍、杭州同馨、握个手平台、线索购买、其他之一'
})
leadSource: string;

// 修改后
@IsEnum(['美团', '抖音', '快手', '小红书', '转介绍', '杭州同馨', '握个手平台', '线索购买', '莲心', '美家', '天机鹿', '孕妈联盟', '高阁', '星星', '其他'], {
  message: '线索来源必须是：美团、抖音、快手、小红书、转介绍、杭州同馨、握个手平台、线索购买、莲心、美家、天机鹿、孕妈联盟、高阁、星星、其他之一'
})
leadSource: string;
```

#### 3. 数据库模型验证

**文件路径**：`backend/src/modules/customers/models/customer.model.ts`

**修改内容**：

```typescript
// 修改前
@Prop({
  required: true,
  enum: ['美团', '抖音', '快手', '小红书', '转介绍', '杭州同馨', '握个手平台', '线索购买', '其他']
})
leadSource: string;

// 修改后
@Prop({
  required: true,
  enum: ['美团', '抖音', '快手', '小红书', '转介绍', '杭州同馨', '握个手平台', '线索购买', '莲心', '美家', '天机鹿', '孕妈联盟', '高阁', '星星', '其他']
})
leadSource: string;
```

### 影响范围

此修改会自动应用到以下功能：

#### 前端页面

1. **创建客户页面** (`CreateCustomer.tsx`)
   - 线索来源下拉选择框会显示新增的6个选项

2. **编辑客户页面** (`EditCustomer.tsx`)
   - 线索来源下拉选择框会显示新增的6个选项

3. **客户列表页面** (`CustomerList.tsx`)
   - 线索来源筛选下拉框会显示新增的6个选项
   - 线索来源列会正确显示新的来源名称

4. **客户详情页面** (`CustomerDetail.tsx`)
   - 线索来源标签会正确显示新的来源名称

#### 后端API

1. **创建客户API** (`POST /api/customers`)
   - 接受新的线索来源值
   - 验证新的线索来源选项

2. **更新客户API** (`PATCH /api/customers/:id`)
   - 接受新的线索来源值
   - 验证新的线索来源选项

3. **数据库存储**
   - MongoDB 会验证新的枚举值
   - 确保数据一致性

## 🚀 部署信息

### 部署时间
2025-11-20 10:16

### Git 提交
- **Commit**: `465dab0`
- **消息**: feat: 增加客户线索来源选项

### 部署步骤

1. ✅ 修改前端类型定义
2. ✅ 修改后端 DTO 验证
3. ✅ 修改数据库模型
4. ✅ 提交代码到 Git
5. ✅ 推送到远程仓库
6. ✅ 重启后端生产服务
7. ✅ 重新构建前端
8. ✅ 重启前端生产服务

### 验证结果

- ✅ 后端服务启动成功
- ✅ 前端构建成功（耗时 36.89秒）
- ✅ 所有服务运行正常

## 📊 完整的线索来源列表

更新后的完整线索来源选项（共15个）：

1. 美团
2. 抖音
3. 快手
4. 小红书
5. 转介绍
6. 杭州同馨
7. 握个手平台
8. 线索购买
9. **莲心** ⭐ 新增
10. **美家** ⭐ 新增
11. **天机鹿** ⭐ 新增
12. **孕妈联盟** ⭐ 新增
13. **高阁** ⭐ 新增
14. **星星** ⭐ 新增
15. 其他

## 🌐 访问地址

- **生产环境**: https://crm.andejiazheng.com
- **客户列表**: https://crm.andejiazheng.com/customers
- **API文档**: https://crm.andejiazheng.com/api/docs

## ✅ 测试建议

1. **创建客户测试**
   - 使用新的线索来源创建客户
   - 验证数据保存成功

2. **编辑客户测试**
   - 将现有客户的线索来源修改为新选项
   - 验证更新成功

3. **筛选测试**
   - 在客户列表使用新的线索来源进行筛选
   - 验证筛选结果正确

4. **显示测试**
   - 查看客户详情页面
   - 验证新的线索来源正确显示

## 📌 注意事项

1. **数据兼容性**：现有客户数据不受影响，只是增加了新的选项
2. **必填字段**：线索来源仍然是必填字段
3. **枚举验证**：前后端都有严格的枚举验证，确保数据一致性
4. **自动继承**：UpdateCustomerDto 自动继承了新的验证规则

---

**更新完成时间**: 2025-11-20 10:18
**更新人员**: AI Assistant
**状态**: ✅ 已部署到生产环境

