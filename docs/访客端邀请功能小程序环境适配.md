# è®¿å®¢ç«¯é‚€è¯·åŠŸèƒ½å°ç¨‹åºç¯å¢ƒé€‚é…

## ğŸ“… æ›´æ–°æ—¶é—´
2024-01-20

## ğŸ¯ æ›´æ–°ç›®æ ‡
ä¸ºè®¿å®¢ç«¯ï¼ˆvideo-interview-guest-room.htmlï¼‰å®ç°ä¸ä¸»æŒäººç«¯ä¸€è‡´çš„å°ç¨‹åºç¯å¢ƒé€‚é…é€»è¾‘ï¼Œåœ¨å°ç¨‹åºç¯å¢ƒä¸‹éšè—é‚€è¯·æŒ‰é’®å’Œé‚€è¯·å¼¹çª—ï¼Œæ”¹ç”¨å°ç¨‹åºåŸç”Ÿåˆ†äº«åŠŸèƒ½ã€‚

## ğŸ“‹ é—®é¢˜èƒŒæ™¯

### åŸæœ‰é—®é¢˜
- âœ… ä¸»æŒäººç«¯å·²å®ç°å°ç¨‹åºç¯å¢ƒæ£€æµ‹å’Œé‚€è¯·æŒ‰é’®éšè—
- âŒ è®¿å®¢ç«¯æ²¡æœ‰å®ç°ç›¸åŒçš„é€»è¾‘
- âŒ è®¿å®¢ç«¯åœ¨å°ç¨‹åºä¸­ä»æ˜¾ç¤º H5 é‚€è¯·æŒ‰é’®ï¼ˆ+å·ï¼‰
- âŒ è®¿å®¢ç«¯ç‚¹å‡»é‚€è¯·æŒ‰é’®æ— æ³•è§¦å‘å°ç¨‹åºåˆ†äº«

### ç”¨æˆ·ä½“éªŒé—®é¢˜
åœ¨å°ç¨‹åºç¯å¢ƒä¸­ï¼š
- H5 çš„é‚€è¯·å¼¹çª—æ— æ³•æ­£å¸¸å·¥ä½œ
- åº”è¯¥ä½¿ç”¨å°ç¨‹åºåŸç”Ÿçš„åˆ†äº«åŠŸèƒ½
- éœ€è¦éšè— H5 çš„é‚€è¯·æŒ‰é’®ï¼Œé¿å…ç”¨æˆ·å›°æƒ‘

## âœ¨ å®ç°æ–¹æ¡ˆ

### 1. æ·»åŠ å°ç¨‹åºç¯å¢ƒæ£€æµ‹

åœ¨é¡µé¢åŠ è½½æ—¶æ£€æµ‹æ˜¯å¦åœ¨å°ç¨‹åºç¯å¢ƒä¸­ï¼š

```javascript
// ğŸ¯ æ£€æµ‹æ˜¯å¦åœ¨å°ç¨‹åºç¯å¢ƒä¸­
const IS_IN_MINIPROGRAM = (function() {
  // æ–¹æ³•1ï¼šé€šè¿‡ window.__wxjs_environment åˆ¤æ–­ï¼ˆæœ€å¯é ï¼‰
  if (window.__wxjs_environment === 'miniprogram') {
    return true;
  }

  // æ–¹æ³•2ï¼šé€šè¿‡ userAgent åˆ¤æ–­ï¼ˆå¾®ä¿¡ 7.0.0+ æ”¯æŒï¼‰
  if (/miniProgram/i.test(navigator.userAgent)) {
    return true;
  }

  return false;
})();
```

### 2. æ·»åŠ ç¯å¢ƒæ ‡è¯† Class

æ ¹æ®æ£€æµ‹ç»“æœä¸º body æ·»åŠ  classï¼š

```javascript
// ğŸ¯ æ ¹æ®ç¯å¢ƒæ·»åŠ  body classï¼ˆç”¨äºæ§åˆ¶é‚€è¯·æŒ‰é’®æ˜¾ç¤ºï¼‰
if (IS_IN_MINIPROGRAM) {
  document.body.classList.add('miniprogram-env');
  console.log('âœ… å·²æ·»åŠ å°ç¨‹åºç¯å¢ƒæ ‡è¯†ï¼Œé‚€è¯·æŒ‰é’®å°†è¢«éšè—');
} else {
  console.log('âœ… æµè§ˆå™¨ç¯å¢ƒï¼Œé‚€è¯·æŒ‰é’®æ­£å¸¸æ˜¾ç¤º');
}
```

### 3. CSS éšè—é‚€è¯·æŒ‰é’®

é€šè¿‡ CSS é€‰æ‹©å™¨éšè—å°ç¨‹åºç¯å¢ƒä¸‹çš„é‚€è¯·å…ƒç´ ï¼š

```css
/* ğŸ¯ å°ç¨‹åºç¯å¢ƒä¸‹éšè—é‚€è¯·æŒ‰é’®å’Œé‚€è¯·å¼¹çª— */
body.miniprogram-env .invite-placeholder {
  display: none !important;
}

body.miniprogram-env #inviteModal {
  display: none !important;
}

/* å°ç¨‹åºç¯å¢ƒä¸‹æ˜¾ç¤ºæ™®é€šå ä½ç¬¦ */
body.miniprogram-env .video-placeholder.empty-slot {
  display: flex !important;
}
```

### 4. å¢å¼ºé‚€è¯·å¼¹çª—é€»è¾‘

åœ¨ `showInviteModal()` å‡½æ•°ä¸­æ·»åŠ å°ç¨‹åºç¯å¢ƒå¤„ç†ï¼š

```javascript
function showInviteModal() {
  console.log('ğŸ“¨ æ˜¾ç¤ºé‚€è¯·å¼¹çª—');
  console.log('ğŸ  å½“å‰roomId:', roomId);

  // ğŸ”¥ æ£€æŸ¥roomIdæ˜¯å¦å­˜åœ¨
  if (!roomId || roomId === '') {
    alert('æˆ¿é—´å·ä¸å­˜åœ¨ï¼Œæ— æ³•ç”Ÿæˆé‚€è¯·é“¾æ¥ï¼');
    return;
  }

  // ğŸ¯ å°ç¨‹åºç¯å¢ƒä¸‹ï¼Œå‘é€ triggerShare æ¶ˆæ¯ç»™å°ç¨‹åº
  if (IS_IN_MINIPROGRAM) {
    try {
      console.log('ğŸ’¡ å°ç¨‹åºç¯å¢ƒï¼Œå‘é€ triggerShare æ¶ˆæ¯ç»™å°ç¨‹åº');

      // ç”Ÿæˆè®¿å®¢H5é“¾æ¥
      const baseUrl = window.location.origin + window.location.pathname.replace('video-interview-guest-room.html', '');
      const inviteLink = `${baseUrl}video-interview-guest.html?roomId=${roomId}`;

      // å‘é€æ¶ˆæ¯ç»™å°ç¨‹åº
      if (typeof wx !== 'undefined' && wx.miniProgram) {
        wx.miniProgram.postMessage({
          data: {
            type: 'triggerShare',
            roomId: roomId,
            inviteLink: inviteLink,
            shareTitle: 'é‚€è¯·ä½ å‚åŠ è§†é¢‘é¢è¯•',
            shareDesc: `é¢è¯•é—´å·ï¼š${roomId.replace(/^room_/, 'AD-').split('_')[0]}`
          }
        });
        console.log('âœ… å·²å‘é€ triggerShare æ¶ˆæ¯ç»™å°ç¨‹åº');

        // æç¤ºç”¨æˆ·ä½¿ç”¨å°ç¨‹åºåˆ†äº«åŠŸèƒ½
        alert('è¯·ä½¿ç”¨å³ä¸Šè§’çš„åˆ†äº«æŒ‰é’®é‚€è¯·å…¶ä»–äºº');
      }
    } catch (error) {
      console.error('âŒ å‘é€ triggerShare æ¶ˆæ¯å¤±è´¥:', error);
    }
    return;
  }

  // éå°ç¨‹åºç¯å¢ƒï¼Œæ˜¾ç¤ºé‚€è¯·å¼¹çª—
  const modal = document.getElementById('inviteModal');
  const inviteLinkInput = document.getElementById('inviteLink');

  // ç”Ÿæˆé‚€è¯·é“¾æ¥
  const baseUrl = window.location.origin + window.location.pathname.replace('video-interview-guest-room.html', 'video-interview-guest.html');
  const link = `${baseUrl}?roomId=${roomId}`;

  inviteLinkInput.value = link;
  modal.classList.add('show');
}
```

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”

### æ›´æ–°å‰
| ç¯å¢ƒ | é‚€è¯·æŒ‰é’® | ç‚¹å‡»è¡Œä¸º | ç”¨æˆ·ä½“éªŒ |
|------|---------|---------|---------|
| æµè§ˆå™¨ | âœ… æ˜¾ç¤º | æ˜¾ç¤º H5 å¼¹çª— | âœ… æ­£å¸¸ |
| å°ç¨‹åº | âŒ æ˜¾ç¤º | æ˜¾ç¤º H5 å¼¹çª— | âŒ æ— æ³•ä½¿ç”¨ |

### æ›´æ–°å
| ç¯å¢ƒ | é‚€è¯·æŒ‰é’® | ç‚¹å‡»è¡Œä¸º | ç”¨æˆ·ä½“éªŒ |
|------|---------|---------|---------|
| æµè§ˆå™¨ | âœ… æ˜¾ç¤º | æ˜¾ç¤º H5 å¼¹çª— | âœ… æ­£å¸¸ |
| å°ç¨‹åº | âœ… éšè— | è§¦å‘å°ç¨‹åºåˆ†äº« | âœ… æ­£å¸¸ |

## ğŸ¨ è§†è§‰æ•ˆæœ

### æµè§ˆå™¨ç¯å¢ƒ
- âœ… æ˜¾ç¤º +å· é‚€è¯·æŒ‰é’®
- âœ… ç‚¹å‡»æ˜¾ç¤ºé‚€è¯·é“¾æ¥å¼¹çª—
- âœ… å¯ä»¥å¤åˆ¶é“¾æ¥åˆ†äº«

### å°ç¨‹åºç¯å¢ƒ
- âœ… éšè— +å· é‚€è¯·æŒ‰é’®
- âœ… ç‚¹å‡»è§¦å‘å°ç¨‹åºåŸç”Ÿåˆ†äº«
- âœ… ä½¿ç”¨å°ç¨‹åºåˆ†äº«å¡ç‰‡

## ğŸ”„ ä¸ä¸»æŒäººç«¯ä¿æŒä¸€è‡´

ç°åœ¨è®¿å®¢ç«¯å’Œä¸»æŒäººç«¯çš„é‚€è¯·åŠŸèƒ½é€»è¾‘å®Œå…¨ä¸€è‡´ï¼š

1. âœ… éƒ½èƒ½æ£€æµ‹å°ç¨‹åºç¯å¢ƒ
2. âœ… éƒ½èƒ½è‡ªåŠ¨éšè—é‚€è¯·æŒ‰é’®
3. âœ… éƒ½èƒ½è§¦å‘å°ç¨‹åºåˆ†äº«
4. âœ… éƒ½èƒ½åœ¨æµè§ˆå™¨ä¸­æ­£å¸¸ä½¿ç”¨ H5 é‚€è¯·

## ğŸš€ éƒ¨ç½²çŠ¶æ€

- âœ… è®¿å®¢ç«¯ç¯å¢ƒæ£€æµ‹å·²æ·»åŠ 
- âœ… CSS éšè—è§„åˆ™å·²æ·»åŠ 
- âœ… é‚€è¯·å¼¹çª—é€»è¾‘å·²å¢å¼º
- âœ… å‰ç«¯æœåŠ¡å·²é‡å¯
- âœ… åŠŸèƒ½å·²ä¸Šçº¿å¯ç”¨

## ğŸ’¡ æŠ€æœ¯è¦ç‚¹

### ç¯å¢ƒæ£€æµ‹ä¼˜å…ˆçº§
1. `window.__wxjs_environment === 'miniprogram'` - æœ€å¯é 
2. `/miniProgram/i.test(navigator.userAgent)` - å…¼å®¹æ–¹æ¡ˆ

### CSS ä¼˜å…ˆçº§
ä½¿ç”¨ `!important` ç¡®ä¿åœ¨å°ç¨‹åºç¯å¢ƒä¸‹å¼ºåˆ¶éšè—ï¼š
```css
body.miniprogram-env .invite-placeholder {
  display: none !important;
}
```

### æ¶ˆæ¯ä¼ é€’
ä½¿ç”¨ `wx.miniProgram.postMessage()` å‘å°ç¨‹åºå‘é€ `triggerShare` æ¶ˆæ¯ï¼Œè§¦å‘å°ç¨‹åºåˆ†äº«åŠŸèƒ½ã€‚

