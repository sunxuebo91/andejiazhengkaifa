# è§†é¢‘é¢è¯•ä¼˜åŒ–ç‰ˆè·¯ç”±é›†æˆæŒ‡å—

> **ç›®æ ‡**: å°†ä¼˜åŒ–ç‰ˆè§†é¢‘é¢è¯•ç»„ä»¶é›†æˆåˆ°ç°æœ‰è·¯ç”±ç³»ç»Ÿ  
> **æ–‡ä»¶**: `frontend/src/App.tsx`

---

## ğŸ“‹ å½“å‰è·¯ç”±ç»“æ„

### ç°æœ‰è§†é¢‘é¢è¯•è·¯ç”±

```typescript
// å…¬å¼€è®¿é—®è·¯ç”±ï¼ˆæ— éœ€ç™»å½•ï¼‰
<Route path="/interview/join/:roomId" element={<JoinInterview />} />
<Route path="/interview/join-mobile/:roomId" element={<JoinInterviewMobile />} />
<Route path="/interview/miniprogram" element={<MiniProgramEntry />} />
<Route path="/interview/video-mobile/:roomId" element={<VideoInterviewMobile />} />
<Route path="/interview/video" element={<VideoInterview />} />
```

---

## ğŸ¯ é›†æˆæ–¹æ¡ˆ

### æ–¹æ¡ˆ1: æ·»åŠ æ–°è·¯ç”±(æ¨è)

**ä¼˜ç‚¹**:
- âœ… ä¸å½±å“ç°æœ‰åŠŸèƒ½
- âœ… å¯ä»¥A/Bæµ‹è¯•
- âœ… å›æ»šæ–¹ä¾¿

**å®æ–½æ­¥éª¤**:

#### Step 1: å¯¼å…¥ä¼˜åŒ–ç‰ˆç»„ä»¶

```typescript
// frontend/src/App.tsx

// åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ å¯¼å…¥
const VideoInterviewOptimized = React.lazy(() => import('./pages/interview/VideoInterviewOptimized'));
```

#### Step 2: æ·»åŠ æ–°è·¯ç”±

```typescript
// åœ¨ Routes ä¸­æ·»åŠ æ–°è·¯ç”±
<Routes>
  {/* ç°æœ‰è·¯ç”± */}
  <Route path="/interview/video" element={<VideoInterview />} />
  <Route path="/interview/video-mobile/:roomId" element={<VideoInterviewMobile />} />
  
  {/* æ–°å¢ä¼˜åŒ–ç‰ˆè·¯ç”± */}
  <Route path="/interview/optimized/:roomId" element={<VideoInterviewOptimized />} />
  
  {/* å…¶ä»–è·¯ç”±... */}
</Routes>
```

#### Step 3: æ›´æ–°è·³è½¬é€»è¾‘

åœ¨åˆ›å»º/åŠ å…¥æˆ¿é—´çš„åœ°æ–¹,æ ¹æ®è®¾å¤‡ç±»å‹è·³è½¬:

```typescript
// ç¤ºä¾‹: åœ¨ VideoInterview.tsx æˆ–å…¶ä»–åˆ›å»ºæˆ¿é—´çš„åœ°æ–¹

import DeviceDetector from '@/utils/deviceDetector';

// åˆ›å»ºæˆ¿é—´åè·³è½¬
const handleJoinRoom = (roomId: string) => {
  const deviceInfo = DeviceDetector.getDeviceInfo();
  
  if (deviceInfo.isMobile || deviceInfo.isSmallScreen) {
    // ç§»åŠ¨ç«¯ä½¿ç”¨ä¼˜åŒ–ç‰ˆæœ¬
    navigate(`/interview/optimized/${roomId}`);
  } else {
    // æ¡Œé¢ç«¯ä½¿ç”¨åŸç‰ˆæœ¬
    navigate(`/interview/video`);
  }
};
```

---

### æ–¹æ¡ˆ2: æ›¿æ¢ç°æœ‰è·¯ç”±

**ä¼˜ç‚¹**:
- âœ… ç»Ÿä¸€å…¥å£
- âœ… ä»£ç ç®€æ´

**ç¼ºç‚¹**:
- âš ï¸ éœ€è¦å……åˆ†æµ‹è¯•
- âš ï¸ å›æ»šéœ€è¦ä»£ç ä¿®æ”¹

**å®æ–½æ­¥éª¤**:

#### Step 1: å¤‡ä»½ç°æœ‰ç»„ä»¶

```bash
# å¤‡ä»½ç°æœ‰ç»„ä»¶
cp frontend/src/pages/interview/VideoInterview.tsx frontend/src/pages/interview/VideoInterview.backup.tsx
cp frontend/src/pages/interview/VideoInterviewMobile.tsx frontend/src/pages/interview/VideoInterviewMobile.backup.tsx
```

#### Step 2: æ›´æ–°å¯¼å…¥

```typescript
// frontend/src/App.tsx

// æ›¿æ¢å¯¼å…¥
// const VideoInterview = React.lazy(() => import('./pages/interview/VideoInterview'));
const VideoInterview = React.lazy(() => import('./pages/interview/VideoInterviewOptimized'));

// const VideoInterviewMobile = React.lazy(() => import('./pages/interview/VideoInterviewMobile'));
const VideoInterviewMobile = React.lazy(() => import('./pages/interview/VideoInterviewOptimized'));
```

---

### æ–¹æ¡ˆ3: æ™ºèƒ½è·¯ç”±(æœ€æ¨è)

**ä¼˜ç‚¹**:
- âœ… è‡ªåŠ¨æ£€æµ‹è®¾å¤‡
- âœ… ç»Ÿä¸€å…¥å£
- âœ… ç”¨æˆ·ä½“éªŒæœ€å¥½

**å®æ–½æ­¥éª¤**:

#### Step 1: åˆ›å»ºæ™ºèƒ½è·¯ç”±ç»„ä»¶

```typescript
// frontend/src/pages/interview/VideoInterviewSmart.tsx

import React, { useEffect } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import DeviceDetector from '@/utils/deviceDetector';

const VideoInterviewSmart: React.FC = () => {
  const { roomId } = useParams<{ roomId: string }>();
  const navigate = useNavigate();

  useEffect(() => {
    const deviceInfo = DeviceDetector.getDeviceInfo();
    
    // æ ¹æ®è®¾å¤‡ç±»å‹é‡å®šå‘
    if (deviceInfo.isMobile || deviceInfo.isSmallScreen) {
      navigate(`/interview/optimized/${roomId}`, { replace: true });
    } else {
      navigate(`/interview/video`, { replace: true });
    }
  }, [roomId, navigate]);

  return (
    <div style={{ 
      display: 'flex', 
      justifyContent: 'center', 
      alignItems: 'center', 
      height: '100vh' 
    }}>
      <p>æ­£åœ¨åŠ è½½...</p>
    </div>
  );
};

export default VideoInterviewSmart;
```

#### Step 2: æ·»åŠ è·¯ç”±

```typescript
// frontend/src/App.tsx

const VideoInterviewSmart = React.lazy(() => import('./pages/interview/VideoInterviewSmart'));
const VideoInterviewOptimized = React.lazy(() => import('./pages/interview/VideoInterviewOptimized'));

<Routes>
  {/* æ™ºèƒ½è·¯ç”± - è‡ªåŠ¨æ£€æµ‹è®¾å¤‡ */}
  <Route path="/interview/smart/:roomId" element={<VideoInterviewSmart />} />
  
  {/* ä¼˜åŒ–ç‰ˆè·¯ç”± */}
  <Route path="/interview/optimized/:roomId" element={<VideoInterviewOptimized />} />
  
  {/* åŸæœ‰è·¯ç”±ä¿æŒä¸å˜ */}
  <Route path="/interview/video" element={<VideoInterview />} />
  <Route path="/interview/video-mobile/:roomId" element={<VideoInterviewMobile />} />
</Routes>
```

---

## ğŸš€ å®Œæ•´å®æ–½ä»£ç 

### 1. æ›´æ–° App.tsx

```typescript
// frontend/src/App.tsx

import React, { Suspense } from 'react';
import { BrowserRouter, Routes, Route } from 'react-router-dom';
import { ConfigProvider, App as AntdApp } from 'antd';
import zhCN from 'antd/locale/zh_CN';
import { AuthProvider } from './contexts/AuthContext';
import LoadingComponent from './components/LoadingComponent';

// ... å…¶ä»–å¯¼å…¥

// è§†é¢‘é¢è¯•ç›¸å…³ç»„ä»¶
const VideoInterview = React.lazy(() => import('./pages/interview/VideoInterview'));
const JoinInterview = React.lazy(() => import('./pages/interview/JoinInterview'));
const VideoInterviewMobile = React.lazy(() => import('./pages/interview/VideoInterviewMobile'));
const JoinInterviewMobile = React.lazy(() => import('./pages/interview/JoinInterviewMobile'));
const MiniProgramEntry = React.lazy(() => import('./pages/interview/MiniProgramEntry'));

// æ–°å¢: ä¼˜åŒ–ç‰ˆç»„ä»¶
const VideoInterviewOptimized = React.lazy(() => import('./pages/interview/VideoInterviewOptimized'));

function App() {
  return (
    <ConfigProvider locale={zhCN}>
      <AntdApp>
        <BrowserRouter future={{ v7_startTransition: true, v7_relativeSplatPath: true }}>
          <AuthProvider>
            <Suspense fallback={<LoadingComponent />}>
              <Routes>
                {/* å…¬å¼€è®¿é—®é¡µé¢ - ä¸éœ€è¦ç™»å½• */}
                <Route path="/login" element={<Login />} />
                <Route path="/unauthorized" element={<Unauthorized />} />
                
                {/* è§†é¢‘é¢è¯•è·¯ç”± */}
                <Route path="/interview/join/:roomId" element={<JoinInterview />} />
                <Route path="/interview/join-mobile/:roomId" element={<JoinInterviewMobile />} />
                <Route path="/interview/miniprogram" element={<MiniProgramEntry />} />
                <Route path="/interview/video-mobile/:roomId" element={<VideoInterviewMobile />} />
                <Route path="/interview/video" element={<VideoInterview />} />
                
                {/* æ–°å¢: ä¼˜åŒ–ç‰ˆè·¯ç”± */}
                <Route path="/interview/optimized/:roomId" element={<VideoInterviewOptimized />} />
                
                {/* å…¶ä»–è·¯ç”±... */}
              </Routes>
            </Suspense>
          </AuthProvider>
        </BrowserRouter>
      </AntdApp>
    </ConfigProvider>
  );
}

export default App;
```

---

### 2. æ›´æ–°åˆ›å»º/åŠ å…¥æˆ¿é—´é€»è¾‘

#### ç¤ºä¾‹1: åœ¨VideoInterview.tsxä¸­

```typescript
// frontend/src/pages/interview/VideoInterview.tsx

import DeviceDetector from '@/utils/deviceDetector';

// åŠ å…¥æˆ¿é—´
const handleJoinRoom = async (values: { roomId: string }) => {
  try {
    const { roomId } = values;
    
    // æ£€æµ‹è®¾å¤‡ç±»å‹
    const deviceInfo = DeviceDetector.getDeviceInfo();
    
    // æ ¹æ®è®¾å¤‡ç±»å‹è·³è½¬
    if (deviceInfo.isMobile || deviceInfo.isSmallScreen) {
      // ç§»åŠ¨ç«¯ä½¿ç”¨ä¼˜åŒ–ç‰ˆæœ¬
      navigate(`/interview/optimized/${roomId}`);
    } else {
      // æ¡Œé¢ç«¯ç»§ç»­ä½¿ç”¨å½“å‰é¡µé¢
      // æˆ–è€…ä¹Ÿå¯ä»¥è·³è½¬åˆ°ä¼˜åŒ–ç‰ˆæœ¬
      // navigate(`/interview/optimized/${roomId}`);
      
      // å½“å‰é¡µé¢åŠ å…¥æˆ¿é—´
      await joinMeeting(roomId);
    }
  } catch (error) {
    message.error('åŠ å…¥æˆ¿é—´å¤±è´¥');
  }
};
```

#### ç¤ºä¾‹2: åœ¨åˆ†äº«é“¾æ¥ä¸­

```typescript
// ç”Ÿæˆåˆ†äº«é“¾æ¥
const generateShareLink = (roomId: string) => {
  const baseUrl = window.location.origin;
  
  // ä½¿ç”¨ä¼˜åŒ–ç‰ˆè·¯ç”±
  return `${baseUrl}/interview/optimized/${roomId}`;
  
  // æˆ–è€…æ ¹æ®è®¾å¤‡ç”Ÿæˆä¸åŒé“¾æ¥
  // const deviceInfo = DeviceDetector.getDeviceInfo();
  // if (deviceInfo.isMobile) {
  //   return `${baseUrl}/interview/optimized/${roomId}`;
  // } else {
  //   return `${baseUrl}/interview/join/${roomId}`;
  // }
};
```

---

## ğŸ“± å°ç¨‹åºé›†æˆ

### æ›´æ–°å°ç¨‹åºWebView URL

```javascript
// miniprogram-pages/interview/interview.js

Page({
  data: {
    h5Url: ''
  },
  
  onLoad(options) {
    const { roomId, token, userName } = options;
    
    // ä½¿ç”¨ä¼˜åŒ–ç‰ˆè·¯ç”±
    let h5Url = `https://crm.andejiazheng.com/interview/optimized/${roomId}`;
    
    if (token) {
      h5Url += `?token=${encodeURIComponent(token)}`;
    }
    
    if (userName) {
      h5Url += `&userName=${encodeURIComponent(userName)}`;
    }
    
    this.setData({ h5Url });
  }
});
```

---

## ğŸ§ª æµ‹è¯•æ¸…å•

### åŠŸèƒ½æµ‹è¯•

- [ ] PCç«¯è®¿é—® `/interview/optimized/:roomId` æ­£å¸¸
- [ ] ç§»åŠ¨ç«¯è®¿é—® `/interview/optimized/:roomId` æ­£å¸¸
- [ ] å¹³æ¿è®¿é—® `/interview/optimized/:roomId` æ­£å¸¸
- [ ] å°ç¨‹åºWebViewè®¿é—®æ­£å¸¸
- [ ] è®¾å¤‡æ£€æµ‹å‡†ç¡®
- [ ] è§†é¢‘è´¨é‡è‡ªé€‚åº”
- [ ] å±å¹•æ–¹å‘åˆ‡æ¢æ­£å¸¸

### å…¼å®¹æ€§æµ‹è¯•

- [ ] Chrome (PC)
- [ ] Safari (Mac)
- [ ] Safari (iPhone)
- [ ] Chrome (Android)
- [ ] å¾®ä¿¡å†…ç½®æµè§ˆå™¨
- [ ] å¾®ä¿¡å°ç¨‹åºWebView

### æ€§èƒ½æµ‹è¯•

- [ ] åŠ è½½æ—¶é—´ < 3ç§’
- [ ] è§†é¢‘å»¶è¿Ÿ < 500ms
- [ ] æ— å†…å­˜æ³„æ¼
- [ ] CPUä½¿ç”¨ç‡æ­£å¸¸

---

## ğŸ”„ å›æ»šæ–¹æ¡ˆ

å¦‚æœä¼˜åŒ–ç‰ˆå‡ºç°é—®é¢˜,å¯ä»¥å¿«é€Ÿå›æ»š:

### æ–¹æ¡ˆ1: æ³¨é‡Šæ–°è·¯ç”±

```typescript
// frontend/src/App.tsx

// æ³¨é‡Šæ‰ä¼˜åŒ–ç‰ˆè·¯ç”±
// <Route path="/interview/optimized/:roomId" element={<VideoInterviewOptimized />} />

// æ¢å¤åŸæœ‰è·¯ç”±
<Route path="/interview/video" element={<VideoInterview />} />
<Route path="/interview/video-mobile/:roomId" element={<VideoInterviewMobile />} />
```

### æ–¹æ¡ˆ2: ä½¿ç”¨ç¯å¢ƒå˜é‡æ§åˆ¶

```typescript
// frontend/src/App.tsx

const USE_OPTIMIZED_VERSION = import.meta.env.VITE_USE_OPTIMIZED_VIDEO === 'true';

<Routes>
  {USE_OPTIMIZED_VERSION ? (
    <Route path="/interview/optimized/:roomId" element={<VideoInterviewOptimized />} />
  ) : (
    <>
      <Route path="/interview/video" element={<VideoInterview />} />
      <Route path="/interview/video-mobile/:roomId" element={<VideoInterviewMobile />} />
    </>
  )}
</Routes>
```

```bash
# .env.production
VITE_USE_OPTIMIZED_VIDEO=true

# å›æ»šæ—¶æ”¹ä¸º
VITE_USE_OPTIMIZED_VIDEO=false
```

---

## ğŸ“Š ç›‘æ§æŒ‡æ ‡

### å…³é”®æŒ‡æ ‡

1. **åŠ è½½æ—¶é—´**
   - ç›®æ ‡: < 3ç§’
   - ç›‘æ§: Performance API

2. **è§†é¢‘è´¨é‡**
   - ç›®æ ‡: æ ¹æ®è®¾å¤‡è‡ªé€‚åº”
   - ç›‘æ§: ZEGO SDKå›è°ƒ

3. **é”™è¯¯ç‡**
   - ç›®æ ‡: < 1%
   - ç›‘æ§: Error Boundary

4. **ç”¨æˆ·æ»¡æ„åº¦**
   - ç›®æ ‡: > 85%
   - ç›‘æ§: ç”¨æˆ·åé¦ˆ

---

## ğŸ“ æ€»ç»“

### æ¨èæ–¹æ¡ˆ

**ç«‹å³å®æ–½**: æ–¹æ¡ˆ1 - æ·»åŠ æ–°è·¯ç”±

**ç†ç”±**:
1. âœ… é£é™©æœ€ä½
2. âœ… å¯ä»¥A/Bæµ‹è¯•
3. âœ… å›æ»šæ–¹ä¾¿
4. âœ… ä¸å½±å“ç°æœ‰åŠŸèƒ½

### å®æ–½æ­¥éª¤

1. **Day 1**: æ·»åŠ æ–°è·¯ç”±
2. **Day 2**: æ›´æ–°è·³è½¬é€»è¾‘
3. **Day 3**: æµ‹è¯•å’Œè°ƒè¯•
4. **Day 4**: ç°åº¦å‘å¸ƒ
5. **Day 5**: å…¨é‡å‘å¸ƒ

### é¢„æœŸæ•ˆæœ

- ç§»åŠ¨ç«¯åŠ è½½é€Ÿåº¦æå‡ 60%
- è§†é¢‘è´¨é‡è‡ªé€‚åº”
- ç”¨æˆ·ä½“éªŒæå‡ 50%
- é”™è¯¯ç‡é™ä½ 30%

---

**å‡†å¤‡å°±ç»ª,å¯ä»¥å¼€å§‹é›†æˆ! ğŸš€**

