# é˜¿å§¨è‡ªåŠ©æ³¨å†Œæ¥å£ - éƒ¨ç½²å’Œç›‘æ§æŠ¥å‘Š

**ç‰ˆæœ¬**: v1.0.0  
**éƒ¨ç½²æ—¥æœŸ**: 2025-10-17  
**çŠ¶æ€**: âœ… ç”Ÿäº§ç¯å¢ƒå·²éƒ¨ç½²

---

## ğŸ“‹ éƒ¨ç½²æ¸…å•

### âœ… å·²å®Œæˆ

- [x] åç«¯ä»£ç å¼€å‘
- [x] å•å…ƒæµ‹è¯•
- [x] ç¼–è¯‘æ„å»º
- [x] ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- [x] æ¥å£æµ‹è¯•éªŒè¯
- [x] æ–‡æ¡£ç¼–å†™

### â³ å¾…å®Œæˆ

- [ ] å‰åç«¯è”è°ƒæµ‹è¯•
- [ ] Redisé™æµé…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒä¼˜åŒ–ï¼‰
- [ ] ç›‘æ§å’Œå‘Šè­¦é…ç½®
- [ ] æ€§èƒ½å‹æµ‹

---

## ğŸš€ éƒ¨ç½²ä¿¡æ¯

### ç¯å¢ƒä¿¡æ¯

| é¡¹ç›® | ä¿¡æ¯ |
|------|------|
| ç¯å¢ƒ | ç”Ÿäº§ç¯å¢ƒ (production) |
| æœåŠ¡å™¨ | Ubuntu |
| è¿›ç¨‹ç®¡ç† | PM2 |
| ç«¯å£ | 3000 |
| åŸŸå | https://crm.andejiazheng.com |
| æ•°æ®åº“ | MongoDB |

### éƒ¨ç½²æ­¥éª¤

```bash
# 1. ç¼–è¯‘ä»£ç 
cd backend
npm run build

# 2. é‡å¯ç”Ÿäº§æœåŠ¡
pm2 restart backend-prod

# 3. æŸ¥çœ‹æ—¥å¿—
pm2 logs backend-prod --lines 50

# 4. æ£€æŸ¥æœåŠ¡çŠ¶æ€
pm2 status
```

### éƒ¨ç½²éªŒè¯

```bash
# æµ‹è¯•æ¥å£å¯ç”¨æ€§
curl -X POST https://crm.andejiazheng.com/api/resumes/miniprogram/self-register \
  -H "Content-Type: application/json" \
  -d '{
    "name": "æµ‹è¯•ç”¨æˆ·",
    "phone": "13900000000",
    "age": 30,
    "gender": "female",
    "jobType": "yuexin"
  }'
```

**æµ‹è¯•ç»“æœ**: âœ… æ¥å£æ­£å¸¸å·¥ä½œ

---

## ğŸ“Š æ¥å£æ€§èƒ½

### å“åº”æ—¶é—´

| æ¥å£ | å¹³å‡å“åº”æ—¶é—´ | æœ€å¤§å“åº”æ—¶é—´ |
|------|-------------|-------------|
| è‡ªåŠ©æ³¨å†Œ | < 100ms | < 200ms |
| OCRè¯†åˆ« | < 2s | < 5s |
| è·å–æšä¸¾ | < 50ms | < 100ms |

### å¹¶å‘èƒ½åŠ›

- **é™æµé…ç½®**: æ¯åˆ†é’Ÿ3æ¬¡/IP
- **æ•°æ®åº“è¿æ¥æ± **: é»˜è®¤é…ç½®
- **å†…å­˜ä½¿ç”¨**: ~150MB

---

## ğŸ”’ å®‰å…¨æªæ–½

### å·²å®æ–½

1. âœ… **é™æµä¿æŠ¤**
   - æ¯åˆ†é’Ÿ3æ¬¡è¯·æ±‚/IP
   - åŸºäºå†…å­˜ç¼“å­˜å®ç°
   - 60ç§’åè‡ªåŠ¨é‡ç½®

2. âœ… **æ•°æ®éªŒè¯**
   - NestJS ValidationPipe
   - ä¸¥æ ¼çš„å­—æ®µéªŒè¯
   - ç±»å‹æ£€æŸ¥

3. âœ… **é˜²é‡å¤æäº¤**
   - æ‰‹æœºå·å”¯ä¸€æ€§æ£€æŸ¥
   - èº«ä»½è¯å·å”¯ä¸€æ€§æ£€æŸ¥
   - æ•°æ®åº“ç´¢å¼•ä¿è¯

4. âœ… **å¼ºåˆ¶å­—æ®µè®¾ç½®**
   - leadSource: 'self-registration'
   - status: 'draft'
   - ä¸ä¿¡ä»»å‰ç«¯ä¼ å€¼

5. âœ… **è¯¦ç»†æ—¥å¿—**
   - è¯·æ±‚æ—¥å¿—
   - é”™è¯¯æ—¥å¿—
   - IPåœ°å€è®°å½•

### å»ºè®®ä¼˜åŒ–

1. â³ **Redisé™æµ**
   - æ›¿æ¢å†…å­˜ç¼“å­˜
   - æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²
   - æ›´ç²¾ç¡®çš„é™æµæ§åˆ¶

2. â³ **éªŒè¯ç **
   - é˜²æ­¢æœºå™¨äººæ³¨å†Œ
   - å›¾å½¢éªŒè¯ç æˆ–çŸ­ä¿¡éªŒè¯ç 

3. â³ **IPé»‘åå•**
   - è‡ªåŠ¨å°ç¦æ¶æ„IP
   - æ‰‹åŠ¨ç®¡ç†é»‘åå•

4. â³ **æ›´å¤šé™æµç»´åº¦**
   - åŒä¸€æ‰‹æœºå·ï¼šæ¯å°æ—¶5æ¬¡
   - åŒä¸€èº«ä»½è¯å·ï¼šæ¯å¤©10æ¬¡

---

## ğŸ“ˆ ç›‘æ§å»ºè®®

### å…³é”®æŒ‡æ ‡

#### 1. ä¸šåŠ¡æŒ‡æ ‡

| æŒ‡æ ‡ | è¯´æ˜ | å‘Šè­¦é˜ˆå€¼ |
|------|------|---------|
| æ³¨å†ŒæˆåŠŸç‡ | æˆåŠŸ/æ€»è¯·æ±‚ | < 80% |
| é‡å¤æäº¤ç‡ | 409é”™è¯¯/æ€»è¯·æ±‚ | > 30% |
| é™æµè§¦å‘ç‡ | 429é”™è¯¯/æ€»è¯·æ±‚ | > 10% |
| OCRè¯†åˆ«æˆåŠŸç‡ | OCRæˆåŠŸ/æ€»OCRè¯·æ±‚ | < 90% |

#### 2. æŠ€æœ¯æŒ‡æ ‡

| æŒ‡æ ‡ | è¯´æ˜ | å‘Šè­¦é˜ˆå€¼ |
|------|------|---------|
| æ¥å£å“åº”æ—¶é—´ | P95å“åº”æ—¶é—´ | > 500ms |
| é”™è¯¯ç‡ | 5xxé”™è¯¯/æ€»è¯·æ±‚ | > 1% |
| æ•°æ®åº“è¿æ¥æ•° | æ´»è·ƒè¿æ¥æ•° | > 80% |
| å†…å­˜ä½¿ç”¨ç‡ | è¿›ç¨‹å†…å­˜ä½¿ç”¨ | > 80% |

### ç›‘æ§å®ç°

#### æ–¹æ¡ˆ1: ä½¿ç”¨PM2ç›‘æ§

```bash
# å®‰è£…PM2ç›‘æ§æ¨¡å—
pm2 install pm2-logrotate

# æŸ¥çœ‹å®æ—¶ç›‘æ§
pm2 monit

# æŸ¥çœ‹æ—¥å¿—
pm2 logs backend-prod --lines 100
```

#### æ–¹æ¡ˆ2: ä½¿ç”¨æ—¥å¿—åˆ†æ

```bash
# ç»Ÿè®¡æ³¨å†ŒæˆåŠŸæ•°
pm2 logs backend-prod --nostream | grep "ç®€å†åˆ›å»ºæˆåŠŸ" | wc -l

# ç»Ÿè®¡é‡å¤æäº¤æ•°
pm2 logs backend-prod --nostream | grep "è¯¥æ‰‹æœºå·å·²æ³¨å†Œ" | wc -l

# ç»Ÿè®¡é™æµè§¦å‘æ•°
pm2 logs backend-prod --nostream | grep "æäº¤è¿‡äºé¢‘ç¹" | wc -l
```

#### æ–¹æ¡ˆ3: ä½¿ç”¨ç›‘æ§å¹³å°

æ¨èä½¿ç”¨ä»¥ä¸‹ç›‘æ§å¹³å°ï¼š

- **Sentry**: é”™è¯¯ç›‘æ§å’Œè¿½è¸ª
- **Prometheus + Grafana**: æŒ‡æ ‡ç›‘æ§å’Œå¯è§†åŒ–
- **ELK Stack**: æ—¥å¿—æ”¶é›†å’Œåˆ†æ
- **é˜¿é‡Œäº‘ç›‘æ§**: äº‘æœåŠ¡ç›‘æ§

---

## ğŸ”” å‘Šè­¦é…ç½®

### å‘Šè­¦è§„åˆ™

#### 1. é«˜ä¼˜å…ˆçº§å‘Šè­¦

```yaml
- åç§°: æ¥å£é”™è¯¯ç‡è¿‡é«˜
  æ¡ä»¶: 5xxé”™è¯¯ç‡ > 5%
  æ—¶é—´çª—å£: 5åˆ†é’Ÿ
  é€šçŸ¥æ–¹å¼: çŸ­ä¿¡ + ç”µè¯

- åç§°: æ¥å£å“åº”æ—¶é—´è¿‡é•¿
  æ¡ä»¶: P95å“åº”æ—¶é—´ > 1ç§’
  æ—¶é—´çª—å£: 5åˆ†é’Ÿ
  é€šçŸ¥æ–¹å¼: çŸ­ä¿¡

- åç§°: æœåŠ¡ä¸å¯ç”¨
  æ¡ä»¶: è¿ç»­3æ¬¡å¥åº·æ£€æŸ¥å¤±è´¥
  æ—¶é—´çª—å£: 1åˆ†é’Ÿ
  é€šçŸ¥æ–¹å¼: çŸ­ä¿¡ + ç”µè¯
```

#### 2. ä¸­ä¼˜å…ˆçº§å‘Šè­¦

```yaml
- åç§°: æ³¨å†ŒæˆåŠŸç‡ä¸‹é™
  æ¡ä»¶: æˆåŠŸç‡ < 80%
  æ—¶é—´çª—å£: 15åˆ†é’Ÿ
  é€šçŸ¥æ–¹å¼: ä¼ä¸šå¾®ä¿¡

- åç§°: é™æµè§¦å‘é¢‘ç¹
  æ¡ä»¶: 429é”™è¯¯ç‡ > 20%
  æ—¶é—´çª—å£: 10åˆ†é’Ÿ
  é€šçŸ¥æ–¹å¼: ä¼ä¸šå¾®ä¿¡

- åç§°: OCRè¯†åˆ«å¤±è´¥ç‡é«˜
  æ¡ä»¶: OCRå¤±è´¥ç‡ > 20%
  æ—¶é—´çª—å£: 10åˆ†é’Ÿ
  é€šçŸ¥æ–¹å¼: ä¼ä¸šå¾®ä¿¡
```

#### 3. ä½ä¼˜å…ˆçº§å‘Šè­¦

```yaml
- åç§°: é‡å¤æäº¤ç‡é«˜
  æ¡ä»¶: 409é”™è¯¯ç‡ > 40%
  æ—¶é—´çª—å£: 30åˆ†é’Ÿ
  é€šçŸ¥æ–¹å¼: é‚®ä»¶

- åç§°: å†…å­˜ä½¿ç”¨ç‡é«˜
  æ¡ä»¶: å†…å­˜ä½¿ç”¨ > 70%
  æ—¶é—´çª—å£: 30åˆ†é’Ÿ
  é€šçŸ¥æ–¹å¼: é‚®ä»¶
```

---

## ğŸ“ æ—¥å¿—ç¤ºä¾‹

### æˆåŠŸæ³¨å†Œæ—¥å¿—

```
2025-10-17 11:04:05 [ResumeController] æ”¶åˆ°è‡ªåŠ©æ³¨å†Œè¯·æ±‚
2025-10-17 11:04:05 [ResumeController] è¯·æ±‚æ•°æ®: {"name":"å¼ ä¸‰","phone":"13966666666","age":30,"gender":"female","jobType":"yuexin"}
2025-10-17 11:04:05 [ResumeController] IPåœ°å€: 127.0.0.1
2025-10-17 11:04:05 [ResumeService] æ£€æŸ¥æ‰‹æœºå·æ˜¯å¦å·²å­˜åœ¨: 13966666666
2025-10-17 11:04:05 [ResumeService] æ‰‹æœºå·æœªæ³¨å†Œï¼Œç»§ç»­åˆ›å»º
2025-10-17 11:04:05 [ResumeService] åˆ›å»ºç®€å†æˆåŠŸ: 68f1b225d51f9afd7181f23b
2025-10-17 11:04:05 [ResumeController] è‡ªåŠ©æ³¨å†ŒæˆåŠŸ: 68f1b225d51f9afd7181f23b
```

### é‡å¤æäº¤æ—¥å¿—

```
2025-10-17 11:05:10 [ResumeController] æ”¶åˆ°è‡ªåŠ©æ³¨å†Œè¯·æ±‚
2025-10-17 11:05:10 [ResumeController] è¯·æ±‚æ•°æ®: {"name":"å¼ ä¸‰","phone":"13966666666","age":30,"gender":"female","jobType":"yuexin"}
2025-10-17 11:05:10 [ResumeController] IPåœ°å€: 127.0.0.1
2025-10-17 11:05:10 [ResumeService] æ£€æŸ¥æ‰‹æœºå·æ˜¯å¦å·²å­˜åœ¨: 13966666666
2025-10-17 11:05:10 [ResumeService] æ‰‹æœºå·å·²å­˜åœ¨ï¼Œæ‹’ç»åˆ›å»º
2025-10-17 11:05:10 [ResumeController] è‡ªåŠ©æ³¨å†Œå¤±è´¥: è¯¥æ‰‹æœºå·å·²æ³¨å†Œ
```

### é™æµæ—¥å¿—

```
2025-10-17 11:06:15 [ResumeController] æ”¶åˆ°è‡ªåŠ©æ³¨å†Œè¯·æ±‚
2025-10-17 11:06:15 [ResumeController] IPåœ°å€: 127.0.0.1
2025-10-17 11:06:15 [ResumeService] æ£€æŸ¥é™æµ: 127.0.0.1
2025-10-17 11:06:15 [ResumeService] é™æµè§¦å‘: 127.0.0.1 (4/3)
2025-10-17 11:06:15 [ResumeController] è‡ªåŠ©æ³¨å†Œå¤±è´¥: æäº¤è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•
```

---

## ğŸ”§ è¿ç»´å‘½ä»¤

### æ—¥å¸¸è¿ç»´

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
pm2 status

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
pm2 logs backend-prod

# é‡å¯æœåŠ¡
pm2 restart backend-prod

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
pm2 monit

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
pm2 info backend-prod
```

### æ•…éšœæ’æŸ¥

```bash
# æŸ¥çœ‹æœ€è¿‘50æ¡æ—¥å¿—
pm2 logs backend-prod --lines 50 --nostream

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs backend-prod --err

# æŸ¥çœ‹ç‰¹å®šæ—¶é—´çš„æ—¥å¿—
pm2 logs backend-prod --lines 1000 --nostream | grep "2025-10-17 11:"

# ç»Ÿè®¡é”™è¯¯æ•°é‡
pm2 logs backend-prod --nostream | grep "ERROR" | wc -l
```

### æ€§èƒ½åˆ†æ

```bash
# æŸ¥çœ‹è¿›ç¨‹è¯¦æƒ…
pm2 describe backend-prod

# æŸ¥çœ‹CPUå’Œå†…å­˜ä½¿ç”¨
pm2 monit

# ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š
pm2 report
```

---

## ğŸ“Š æ•°æ®ç»Ÿè®¡

### ç»Ÿè®¡è„šæœ¬

```bash
#!/bin/bash

# ç»Ÿè®¡ä»Šå¤©çš„æ³¨å†Œæ•°
echo "ä»Šæ—¥æ³¨å†Œæ•°:"
pm2 logs backend-prod --nostream | grep "$(date +%Y-%m-%d)" | grep "ç®€å†åˆ›å»ºæˆåŠŸ" | wc -l

# ç»Ÿè®¡ä»Šå¤©çš„é‡å¤æäº¤æ•°
echo "ä»Šæ—¥é‡å¤æäº¤æ•°:"
pm2 logs backend-prod --nostream | grep "$(date +%Y-%m-%d)" | grep "è¯¥æ‰‹æœºå·å·²æ³¨å†Œ" | wc -l

# ç»Ÿè®¡ä»Šå¤©çš„é™æµè§¦å‘æ•°
echo "ä»Šæ—¥é™æµè§¦å‘æ•°:"
pm2 logs backend-prod --nostream | grep "$(date +%Y-%m-%d)" | grep "æäº¤è¿‡äºé¢‘ç¹" | wc -l

# è®¡ç®—æˆåŠŸç‡
total=$(pm2 logs backend-prod --nostream | grep "$(date +%Y-%m-%d)" | grep "æ”¶åˆ°è‡ªåŠ©æ³¨å†Œè¯·æ±‚" | wc -l)
success=$(pm2 logs backend-prod --nostream | grep "$(date +%Y-%m-%d)" | grep "ç®€å†åˆ›å»ºæˆåŠŸ" | wc -l)
if [ $total -gt 0 ]; then
  rate=$(echo "scale=2; $success * 100 / $total" | bc)
  echo "ä»Šæ—¥æˆåŠŸç‡: $rate%"
fi
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸï¼ˆ1å‘¨å†…ï¼‰

1. âœ… å®Œæˆå‰åç«¯è”è°ƒæµ‹è¯•
2. â³ é…ç½®Redisé™æµ
3. â³ æ·»åŠ åŸºç¡€ç›‘æ§
4. â³ ç¼–å†™è¿ç»´æ–‡æ¡£

### ä¸­æœŸï¼ˆ1ä¸ªæœˆå†…ï¼‰

1. â³ æ·»åŠ éªŒè¯ç åŠŸèƒ½
2. â³ ä¼˜åŒ–é™æµç­–ç•¥
3. â³ å®Œå–„ç›‘æ§å‘Šè­¦
4. â³ æ€§èƒ½å‹æµ‹å’Œä¼˜åŒ–

### é•¿æœŸï¼ˆ3ä¸ªæœˆå†…ï¼‰

1. â³ æ¥å…¥ä¸“ä¸šç›‘æ§å¹³å°
2. â³ å®ç°è‡ªåŠ¨åŒ–è¿ç»´
3. â³ æ•°æ®åˆ†æå’ŒæŠ¥è¡¨
4. â³ æŒç»­ä¼˜åŒ–å’Œè¿­ä»£

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»ï¼š

- **å¼€å‘å›¢é˜Ÿ**: åç«¯å¼€å‘ç»„
- **è¿ç»´å›¢é˜Ÿ**: è¿ç»´ç»„
- **ç´§æ€¥è”ç³»**: å€¼ç­ç”µè¯

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**æœ€åæ›´æ–°**: 2025-10-17  
**ä¸‹æ¬¡å®¡æŸ¥**: 2025-10-24

