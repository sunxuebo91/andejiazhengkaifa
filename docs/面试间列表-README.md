# 📋 面试间列表功能 - 项目总览

## 🎯 项目概述

实现面试间管理功能，让每个用户可以查看和管理自己创建的面试间，支持重新进入进行中的面试间、查看历史记录等。

**核心特性**：
- ✅ 每个用户只能看到自己创建的面试间（严格权限隔离）
- ✅ 区分「进行中」和「已结束」状态
- ✅ 支持重新进入进行中的面试间
- ✅ 支持手动结束面试间
- ✅ 显示面试间详细信息（参与者、时长等）
- ❌ 暂不实现录制功能（避免性能影响和额外费用）

---

## 📚 文档导航

### 1️⃣ 开发文档（必读）

**文件**: `面试间列表功能开发文档.md`

**内容**：
- 完整的数据模型设计（Entity + DTO）
- 后端实现（Service + Controller + Module）
- 前端实现（页面 + 组件 + 样式）
- 与现有系统的整合方案
- 开发检查清单

**适合**：开发人员完整阅读，了解整体架构和实现细节

---

### 2️⃣ API 接口文档（必读）

**文件**: `面试间列表API接口文档.md`

**内容**：
- 5 个核心 API 接口详细说明
- 请求参数和响应格式
- 错误处理和权限说明
- 前端调用示例
- Postman 测试步骤

**适合**：前后端开发人员参考，API 对接时查阅

---

### 3️⃣ 开发任务清单（必读）

**文件**: `面试间列表开发任务清单.md`

**内容**：
- 详细的开发步骤（25个步骤）
- 每个步骤的具体任务和检查项
- 时间分配建议
- 常见问题和解决方案
- 测试指南

**适合**：开发时按步骤执行，确保不遗漏任何环节

---

## 🏗️ 技术架构

### 后端技术栈

- **框架**: NestJS + TypeScript
- **数据库**: MongoDB + Mongoose
- **认证**: JWT
- **验证**: class-validator

### 前端技术栈

- **框架**: React + TypeScript
- **UI 库**: Ant Design
- **路由**: React Router
- **日期处理**: Day.js
- **HTTP 客户端**: Axios

---

## 📊 核心功能

### 1. 面试间列表

- 显示当前用户创建的所有面试间
- 支持按状态筛选（全部、进行中、已结束）
- 支持搜索房间名称
- 分页显示

### 2. 房间卡片

- 显示房间基本信息（名称、房间号、状态）
- 显示时间信息（创建时间、持续时长、结束时间）
- 显示参与者信息
- 提供操作按钮（重新进入、结束面试、查看详情）

### 3. 权限控制

- 所有接口都需要 JWT 认证
- 用户只能访问自己创建的面试间
- 用户只能结束自己创建的面试间
- 严格的所有权验证

### 4. 状态管理

- **active（进行中）**：可以重新进入、可以结束
- **ended（已结束）**：只能查看详情、不能重新进入

---

## 🔌 API 接口概览

| 接口 | 方法 | 路径 | 说明 |
|-----|------|------|------|
| 创建面试间 | POST | `/api/interview/rooms` | 创建新的面试间 |
| 获取列表 | GET | `/api/interview/rooms` | 获取当前用户的面试间列表 |
| 获取详情 | GET | `/api/interview/rooms/:roomId` | 获取指定面试间详情 |
| 结束面试 | POST | `/api/interview/rooms/:roomId/end` | 结束指定面试间 |
| 检查状态 | GET | `/api/interview/rooms/:roomId/status` | 检查房间是否可进入 |

---

## 📁 文件结构

### 后端文件

```
backend/src/modules/interview/
├── interview.module.ts          # 模块定义
├── interview.controller.ts      # API控制器
├── interview.service.ts         # 业务逻辑
├── models/
│   └── interview-room.entity.ts # 面试间实体
└── dto/
    ├── create-room.dto.ts       # 创建房间DTO
    ├── query-rooms.dto.ts       # 查询房间DTO
    └── end-room.dto.ts          # 结束房间DTO
```

### 前端文件

```
frontend/src/
├── pages/interview/
│   ├── InterviewRoomList.tsx        # 面试间列表页
│   ├── InterviewRoomList.css        # 列表页样式
│   └── components/
│       ├── RoomCard.tsx             # 房间卡片组件
│       └── RoomStatusBadge.tsx      # 状态徽章组件
├── types/
│   └── interview.types.ts           # 类型定义
└── services/
    └── interview.service.ts         # API服务
```

---

## ⏰ 开发时间估算

| 阶段 | 时间 | 说明 |
|-----|------|------|
| 后端开发 | 3-4小时 | Entity + DTO + Service + Controller + Module |
| 前端开发 | 3-4小时 | 组件 + 页面 + 样式 + 路由 |
| 集成测试 | 1-2小时 | 功能测试 + 权限测试 + 边界测试 |
| 文档收尾 | 0.5小时 | 代码审查 + 提交 |
| **总计** | **7.5-10.5小时** | **建议1天完成** |

---

## ✅ 开发流程

### 第一步：阅读文档（30分钟）

1. 阅读本 README，了解项目概况
2. 阅读开发文档，理解技术架构
3. 阅读 API 文档，了解接口设计
4. 阅读任务清单，熟悉开发步骤

### 第二步：后端开发（3-4小时）

按照任务清单 Step 1-9 执行：
1. 创建数据模型
2. 创建 DTO
3. 实现 Service
4. 实现 Controller
5. 创建 Module
6. 整合 ZEGO Service
7. 测试 API

### 第三步：前端开发（3-4小时）

按照任务清单 Step 10-19 执行：
1. 创建类型定义
2. 创建 API Service
3. 创建组件
4. 创建页面
5. 配置路由和菜单
6. 测试功能

### 第四步：集成测试（1-2小时）

按照任务清单 Step 20-23 执行：
1. 完整流程测试
2. 权限隔离测试
3. 边界测试
4. 浏览器兼容性测试

### 第五步：提交代码（30分钟）

按照任务清单 Step 24-25 执行：
1. 代码审查
2. Git 提交

---

## 🚨 重要注意事项

### 1. 权限控制（最重要！）

✅ **必须做到**：
- 所有 API 都使用 `@UseGuards(JwtAuthGuard)`
- 所有查询都过滤 `hostUserId === req.user.userId`
- 所有操作都验证所有权

❌ **绝对不能**：
- 直接使用前端传来的 `userId`
- 跳过权限验证
- 返回其他用户的数据

### 2. 数据同步

- 创建时：同时写入数据库和 ZEGO 内存
- 结束时：同时更新数据库和解散 ZEGO 房间
- 检查时：同时检查数据库和 ZEGO 状态

### 3. 错误处理

- 使用统一的错误响应格式
- 区分 404（不存在）和 403（无权限）
- 前端显示友好的错误提示

---

## 🧪 测试要点

### 功能测试

- [ ] 创建面试间后自动出现在列表
- [ ] 进行中的面试间可以重新进入
- [ ] 结束面试间后状态正确更新
- [ ] 时长计算正确
- [ ] 搜索和筛选功能正常
- [ ] 分页功能正常

### 权限测试

- [ ] 用户A只能看到自己的面试间
- [ ] 用户B无法访问用户A的面试间
- [ ] 未登录用户无法访问任何接口

### 边界测试

- [ ] 空列表显示正确
- [ ] 搜索无结果显示正确
- [ ] 网络错误处理正确
- [ ] Token 过期处理正确

---

## 📖 快速开始

### 1. 启动后端

```bash
cd backend
npm run start:dev
```

### 2. 启动前端

```bash
cd frontend
npm start
```

### 3. 访问页面

```
http://localhost:3000/interview/rooms
```

---

## 🔗 相关资源

- **NestJS 文档**: https://docs.nestjs.com/
- **Ant Design 文档**: https://ant.design/components/overview-cn/
- **Day.js 文档**: https://day.js.org/
- **ZEGO 文档**: https://doc-zh.zego.im/

---

## 📞 联系方式

如有问题，请参考：
1. 开发文档中的详细说明
2. API 文档中的接口定义
3. 任务清单中的常见问题

---

**祝开发顺利！🚀**

