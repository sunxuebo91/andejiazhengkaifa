# å¾®ä¿¡å°ç¨‹åºç¯å¢ƒæ£€æµ‹ä¸é‚€è¯·åŠŸèƒ½éšè—

## ğŸ“‹ åŠŸèƒ½è¯´æ˜

åœ¨è§†é¢‘é¢è¯• H5 é¡µé¢ä¸­ï¼Œæ ¹æ®è¿è¡Œç¯å¢ƒè‡ªåŠ¨è°ƒæ•´é‚€è¯·åŠŸèƒ½çš„æ˜¾ç¤ºï¼š

- **å°ç¨‹åºç¯å¢ƒ**ï¼šéšè—é‚€è¯·æŒ‰é’®å’Œé‚€è¯·å¼¹çª—ï¼Œæç¤ºç”¨æˆ·ä½¿ç”¨å°ç¨‹åºçš„åˆ†äº«åŠŸèƒ½
- **H5 æµè§ˆå™¨ç¯å¢ƒ**ï¼šæ­£å¸¸æ˜¾ç¤ºé‚€è¯·æŒ‰é’®å’Œé‚€è¯·å¼¹çª—ï¼Œå…è®¸å¤åˆ¶é“¾æ¥é‚€è¯·

## ğŸ” ç¯å¢ƒæ£€æµ‹æ–¹æ³•

æ ¹æ®å¾®ä¿¡å®˜æ–¹æ–‡æ¡£ï¼Œä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ£€æµ‹å°ç¨‹åºç¯å¢ƒï¼š

### æ–¹æ³• 1ï¼šwindow.__wxjs_environmentï¼ˆæ¨èï¼‰

```javascript
if (window.__wxjs_environment === 'miniprogram') {
  // åœ¨å°ç¨‹åº WebView ä¸­
}
```

**ä¼˜ç‚¹**ï¼šæœ€å¯é çš„æ£€æµ‹æ–¹æ³•  
**æ³¨æ„**ï¼šå»ºè®®åœ¨ `WeixinJSBridgeReady` å›è°ƒä¸­ä½¿ç”¨

### æ–¹æ³• 2ï¼šUserAgent æ£€æµ‹

```javascript
if (/miniProgram/i.test(navigator.userAgent)) {
  // åœ¨å°ç¨‹åº WebView ä¸­
}
```

**ä¼˜ç‚¹**ï¼šä»å¾®ä¿¡ 7.0.0 å¼€å§‹æ”¯æŒ  
**æ³¨æ„**ï¼šiOS æ—©æœŸç‰ˆæœ¬å¯èƒ½ä¸åŒ…å« miniProgram å­—æ®µ

### æ–¹æ³• 3ï¼šwx.miniProgram.getEnvï¼ˆJSSDKï¼‰

```javascript
wx.miniProgram.getEnv(function(res) {
  if (res.miniprogram) {
    // åœ¨å°ç¨‹åº WebView ä¸­
  }
});
```

**ä¼˜ç‚¹**ï¼šå®˜æ–¹ JSSDK æä¾›  
**ç¼ºç‚¹**ï¼šéœ€è¦å¼•å…¥å¾®ä¿¡ JSSDKï¼Œä¸”ä¸ºå¼‚æ­¥æ–¹æ³•

## ğŸ¯ å®ç°æ–¹æ¡ˆ

### 1. å…¨å±€ç¯å¢ƒæ£€æµ‹å˜é‡

åœ¨é¡µé¢ `<head>` ä¸­æ·»åŠ ç¯å¢ƒæ£€æµ‹è„šæœ¬ï¼š

```javascript
var IS_IN_MINIPROGRAM = false;
var IS_WECHAT = false;

(function() {
  function isWechat() {
    return /MicroMessenger/i.test(navigator.userAgent);
  }

  function isInMiniProgram() {
    // æ–¹æ³•1ï¼šwindow.__wxjs_environment
    if (window.__wxjs_environment === 'miniprogram') {
      return true;
    }
    
    // æ–¹æ³•2ï¼šuserAgent
    if (/miniProgram/i.test(navigator.userAgent)) {
      return true;
    }
    
    return false;
  }

  IS_WECHAT = isWechat();
  IS_IN_MINIPROGRAM = isInMiniProgram();
})();
```

### 2. CSS æ ·å¼æ§åˆ¶

æ·»åŠ  CSS ç±»æ¥éšè—å°ç¨‹åºç¯å¢ƒä¸‹çš„é‚€è¯·æŒ‰é’®ï¼š

```css
/* å°ç¨‹åºç¯å¢ƒä¸‹éšè—é‚€è¯·æŒ‰é’® */
body.miniprogram-env .invite-placeholder {
  display: none !important;
}

/* å°ç¨‹åºç¯å¢ƒä¸‹æ˜¾ç¤ºæ™®é€šå ä½ç¬¦ */
body.miniprogram-env .video-placeholder.empty-slot {
  display: flex !important;
  background: #1a1a1a;
  border: 1px solid #333;
  cursor: default;
}
```

### 3. é¡µé¢åŠ è½½æ—¶æ·»åŠ ç¯å¢ƒæ ‡è¯†

```javascript
window.onload = function() {
  // æ ¹æ®ç¯å¢ƒæ·»åŠ  body class
  if (IS_IN_MINIPROGRAM) {
    document.body.classList.add('miniprogram-env');
    console.log('âœ… å°ç¨‹åºç¯å¢ƒï¼Œé‚€è¯·æŒ‰é’®å·²éšè—');
  }
};
```

### 4. é‚€è¯·åŠŸèƒ½é€»è¾‘æ§åˆ¶

```javascript
function showInviteModal() {
  // å°ç¨‹åºç¯å¢ƒä¸‹æç¤ºä½¿ç”¨åˆ†äº«åŠŸèƒ½
  if (IS_IN_MINIPROGRAM) {
    alert('è¯·ç‚¹å‡»å³ä¸Šè§’"..."æŒ‰é’®ï¼Œé€‰æ‹©"è½¬å‘"åˆ†äº«ç»™å€™é€‰äºº');
    return;
  }

  // æµè§ˆå™¨ç¯å¢ƒä¸‹æ˜¾ç¤ºé‚€è¯·å¼¹çª—
  const modal = document.getElementById('inviteModal');
  modal.classList.add('show');
}
```

## ğŸ“ å·²ä¿®æ”¹çš„æ–‡ä»¶

1. **frontend/public/miniprogram/video-interview-host.html**
   - æ·»åŠ ç¯å¢ƒæ£€æµ‹è„šæœ¬
   - æ·»åŠ  CSS æ ·å¼æ§åˆ¶
   - ä¿®æ”¹ `showInviteModal()` å‡½æ•°

2. **frontend/public/miniprogram/video-interview-guest-room.html**
   - æ·»åŠ ç¯å¢ƒæ£€æµ‹è„šæœ¬
   - æ·»åŠ  CSS æ ·å¼æ§åˆ¶
   - ä¿®æ”¹ `showInviteModal()` å‡½æ•°

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### æµ‹è¯•é¡µé¢

è®¿é—® `/miniprogram/test-env-detection.html` æŸ¥çœ‹ç¯å¢ƒæ£€æµ‹ç»“æœ

### æµ‹è¯•åœºæ™¯

1. **æµè§ˆå™¨ç¯å¢ƒæµ‹è¯•**
   - åœ¨ Chrome/Safari ç­‰æµè§ˆå™¨ä¸­æ‰“å¼€é¡µé¢
   - åº”è¯¥æ˜¾ç¤ºé‚€è¯·æŒ‰é’®ï¼ˆ+ é‚€è¯·ç”¨æˆ·ï¼‰
   - ç‚¹å‡»é‚€è¯·æŒ‰é’®åº”è¯¥å¼¹å‡ºé‚€è¯·é“¾æ¥å¼¹çª—

2. **å°ç¨‹åºç¯å¢ƒæµ‹è¯•**
   - åœ¨å¾®ä¿¡å°ç¨‹åºçš„ web-view ä¸­æ‰“å¼€é¡µé¢
   - é‚€è¯·æŒ‰é’®åº”è¯¥è¢«éšè—
   - ç‚¹å‡»ç©ºä½ç½®åº”è¯¥æç¤ºä½¿ç”¨åˆ†äº«åŠŸèƒ½

### éªŒè¯æ–¹æ³•

æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ŒæŸ¥çœ‹æ—¥å¿—è¾“å‡ºï¼š

```
ğŸ” ç¯å¢ƒæ£€æµ‹:
  - æ˜¯å¦åœ¨å¾®ä¿¡ä¸­: true/false
  - æ˜¯å¦åœ¨å°ç¨‹åº WebView ä¸­: true/false
  - UserAgent: ...
  - __wxjs_environment: miniprogram/undefined
```

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [å¾®ä¿¡å®˜æ–¹æ–‡æ¡£ - web-view](https://developers.weixin.qq.com/miniprogram/dev/component/web-view.html)
- [å¾®ä¿¡ JSSDK è¯´æ˜æ–‡æ¡£](https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html)

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **iOS å…¼å®¹æ€§**ï¼šæ—©æœŸ iOS ç‰ˆæœ¬çš„ UserAgent å¯èƒ½ä¸åŒ…å« `miniProgram` å­—æ®µï¼Œå› æ­¤ä½¿ç”¨åŒé‡æ£€æµ‹
2. **å¼‚æ­¥æ£€æµ‹**ï¼š`window.__wxjs_environment` å»ºè®®åœ¨ `WeixinJSBridgeReady` å›è°ƒä¸­ä½¿ç”¨
3. **é™çº§æ–¹æ¡ˆ**ï¼šå¦‚æœä¸¤ç§æ–¹æ³•éƒ½æ— æ³•æ£€æµ‹ï¼Œé»˜è®¤æŒ‰æµè§ˆå™¨ç¯å¢ƒå¤„ç†
4. **æµ‹è¯•ç¯å¢ƒ**ï¼šå¼€å‘è€…å·¥å…·å’ŒçœŸæœºç¯å¢ƒå¯èƒ½æœ‰å·®å¼‚ï¼Œå»ºè®®åœ¨çœŸæœºä¸Šæµ‹è¯•

## ğŸ‰ æ•ˆæœ

- âœ… å°ç¨‹åºç¯å¢ƒï¼šé‚€è¯·æŒ‰é’®è‡ªåŠ¨éšè—ï¼Œç”¨æˆ·ä½“éªŒæ›´æµç•…
- âœ… æµè§ˆå™¨ç¯å¢ƒï¼šé‚€è¯·åŠŸèƒ½æ­£å¸¸ä½¿ç”¨ï¼Œå¯å¤åˆ¶é“¾æ¥åˆ†äº«
- âœ… è‡ªåŠ¨æ£€æµ‹ï¼šæ— éœ€æ‰‹åŠ¨é…ç½®ï¼Œæ ¹æ®ç¯å¢ƒè‡ªåŠ¨é€‚é…

