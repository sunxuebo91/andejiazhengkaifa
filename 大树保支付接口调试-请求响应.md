# 大树保支付接口调试 - 请求响应参数（最新版本）

## 问题描述
调用支付订单接口（0022）时，大树保返回错误：`缺少支付参数!`

**更新时间**: 2025-12-19 16:26:44

---

## 📤 请求参数（我们发送的 - 最新版本）

### 接口信息
- **RequestType**: 0022（支付订单）
- **环境**: 生产环境 `https://api.dasurebao.com.cn/remoting/ws`
- **账号**: `ande`
- **密码**: `dsaoifccknferd893#`
- **时间**: 2025-12-19 16:26:44

### 完整请求XML（已添加NotifyUrl，严格按照文档格式）

```xml
<?xml version="1.0" encoding="UTF-8"?>
<Packet type="REQUEST" version="1.0">
  <Head>
    <RequestType>0022</RequestType>
    <User>ande</User>
    <Password>dsaoifccknferd893#</Password>
  </Head>
  <Body>
    <PayInfo>
      <Target>WeChat</Target>
      <TradeType>MWEB</TradeType>
      <NotifyUrl>https://api.dasurebao.com.cn/payment/notify</NotifyUrl>
    </PayInfo>

    <Policy>
      <AgencyPolicyRef>ANDE1766132624344ixftu2</AgencyPolicyRef>
      <ProductCode>MP10450132</ProductCode>
      <PlanCode>PK00029001</PlanCode>
      <EffectiveDate>20251220000000</EffectiveDate>
      <ExpireDate>20260119000000</ExpireDate>
      <GroupSize>1</GroupSize>
      <TotalPremium>12</TotalPremium>
      <SplitType>0</SplitType>
    </Policy>
    
    <PolicyHolder>
      <PolicyHolderName>北京安得家政有限公司</PolicyHolderName>
      <PHIdType>G</PHIdType>
      <PHIdNumber>91110111MACJMD2R5J</PHIdNumber>
      <PHAddress>北京市朝阳区望京园602号楼3层339</PHAddress>
      <PHProvinceCode>110000</PHProvinceCode>
      <PHCityCode>110100</PHCityCode>
      <PHDistrictCode>110105</PHDistrictCode>
    </PolicyHolder>
    
    <InsuredList>
      <Insured>
        <InsuredId>1</InsuredId>
        <InsuredName>闫凯欣</InsuredName>
        <InsuredType>1</InsuredType>
        <IdType>1</IdType>
        <IdNumber>13013219930910004X</IdNumber>
        <BirthDate>19930910000000</BirthDate>
        <Gender>F</Gender>
        <Mobile>13264518973</Mobile>
      </Insured>
    </InsuredList>
  </Body>
</Packet>
```

---

## 📥 响应参数（大树保返回的）

```xml
<?xml version="1.0" encoding="UTF-8"?>
<ResultInfo>
  <Success>false</Success>
  <OrderId>0</OrderId>
  <Message>缺少支付参数!</Message>
</ResultInfo>
```

---

## 🔍 已尝试的解决方案

1. ✅ 添加了 `<PayInfo>` 标签（包含 Target、TradeType 和 NotifyUrl）
2. ✅ 添加了完整的保单信息（Policy）
3. ✅ 添加了投保人信息（PolicyHolder）
4. ✅ 添加了被保险人列表（InsuredList）
5. ✅ 严格按照文档示例格式（移除了 IssueDate、PremiumCalType、PolicyHolderType）
6. ✅ 添加了 `<NotifyUrl>` 回调地址

---

## 📋 参数说明

### PayInfo 支付信息
- **Target**: WeChat（微信支付）
- **TradeType**: MWEB（H5支付场景）
  - 可选值：APP, MINI, OPEN, MWEB, NATIVE
- **NotifyUrl**: https://api.dasurebao.com.cn/payment/notify（支付成功回调地址）

### Policy 保单信息
- **AgencyPolicyRef**: 保单流水号
- **ProductCode**: 产品代码（MP10450132）
- **PlanCode**: 计划代码（PK00029001）
- **EffectiveDate**: 生效日期（20251220000000）
- **ExpireDate**: 失效日期（20260119000000）
- **GroupSize**: 被保险人数量（1）
- **TotalPremium**: 总保费（12元）
- **SplitType**: 保单类型（0=团单）

### PolicyHolder 投保人信息
- **PolicyHolderName**: 投保人名称（北京安得家政有限公司）
- **PHIdType**: 证件类型（G=统一社会信用代码）
- **PHIdNumber**: 证件号码（91110111MACJMD2R5J）
- **PHAddress**: 地址（北京市朝阳区望京园602号楼3层339）
- **PHProvinceCode**: 省份代码（110000）
- **PHCityCode**: 城市代码（110100）
- **PHDistrictCode**: 区县代码（110105）

### Insured 被保险人信息
- **InsuredId**: 被保险人序号（1）
- **InsuredName**: 姓名（闫凯欣）
- **InsuredType**: 类型（1=个人）
- **IdType**: 证件类型（1=身份证）
- **IdNumber**: 证件号码（13013219930910004X）
- **BirthDate**: 出生日期（19930910000000）
- **Gender**: 性别（F=女）
- **Mobile**: 手机号（13264518973）

---

## ❓ 与文档示例的对比

### ✅ 我们已包含的参数（与文档一致）：
- PayInfo: Target, TradeType, NotifyUrl
- Policy: AgencyPolicyRef, ProductCode, PlanCode, EffectiveDate, ExpireDate, GroupSize, TotalPremium, SplitType
- PolicyHolder: PolicyHolderName, PHIdType, PHIdNumber, PHAddress, PHProvinceCode, PHCityCode, PHDistrictCode
- InsuredList: 完整的被保险人信息

### ⚠️ 文档示例中有但我们没有的：
- 无（我们的请求格式已完全符合文档示例）

### 🔍 可能的问题：
1. **账号权限** - 生产环境账号 `ande` 可能未开通支付功能
2. **微信支付配置** - 可能需要在大树保后台配置微信支付商户号
3. **产品限制** - 该产品（MP10450132）可能不支持在线支付
4. **OrderId问题** - 投保接口返回 OrderId=0，可能影响支付

---

## 🆘 建议

**需要联系大树保技术支持确认：**
1. 生产环境账号 `ande` 是否已开通支付功能
2. 支付接口（0022）是否还需要其他必需参数
3. 是否需要先完成实名认证流程
4. 是否需要配置微信支付商户号等信息

