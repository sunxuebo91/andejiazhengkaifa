# 快速开始 - 5分钟部署指南

## 🎯 目标

将视频面试 H5 页面部署到你自己的服务器，并配置小程序使用新域名。

---

## ⚡ 快速部署（5步完成）

### 第 1 步：上传文件（1分钟）

将以下 3 个文件上传到服务器：

```
video-interview-host.html          # HR端页面
video-interview.html               # 访客端页面
ZegoExpressWebRTC-standalone.js    # ZEGO SDK
```

**上传位置示例**：
```
/var/www/html/h5/
```

**使用 FTP 工具**（如 FileZilla）：
1. 连接到服务器
2. 进入目标目录
3. 拖拽上传 3 个文件

**或使用 SCP 命令**：
```bash
scp video-interview-host.html root@your-server:/var/www/html/h5/
scp video-interview.html root@your-server:/var/www/html/h5/
scp ZegoExpressWebRTC-standalone.js root@your-server:/var/www/html/h5/
```

---

### 第 2 步：配置 Nginx（2分钟）

**编辑配置文件**：
```bash
sudo nano /etc/nginx/sites-available/yourdomain.conf
```

**添加以下配置**：
```nginx
server {
    listen 443 ssl http2;
    server_name api.yourdomain.com;  # 🔥 改成你的域名
    
    ssl_certificate /etc/letsencrypt/live/api.yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/api.yourdomain.com/privkey.pem;
    
    location /h5/ {
        alias /var/www/html/h5/;  # 🔥 改成你的路径
        index video-interview-host.html;
        
        add_header Access-Control-Allow-Origin *;
    }
}
```

**重启 Nginx**：
```bash
sudo nginx -t
sudo systemctl reload nginx
```

---

### 第 3 步：测试访问（30秒）

在浏览器中访问：

```
https://api.yourdomain.com/h5/video-interview-host.html
```

**检查**：
- ✅ 页面能正常打开
- ✅ 没有 SSL 错误
- ✅ 点击"创建面试间"能正常工作

---

### 第 4 步：配置小程序业务域名（1分钟）

1. 登录小程序后台：https://mp.weixin.qq.com/
2. 进入：**开发 → 开发管理 → 开发设置 → 业务域名**
3. 点击"添加"，输入：`api.yourdomain.com`
4. 下载校验文件（如 `WxVerifyFile.txt`）
5. 上传到服务器根目录：`/var/www/html/`
6. 点击"验证"

---

### 第 5 步：修改小程序代码（30秒）

**文件**：`miniprogram/pages/video-interview-webview/index.js`

**找到第 17 行**，修改域名：

```javascript
// 🔥 修改这一行
const h5Domain = 'https://api.yourdomain.com/h5';  // 改成你的域名
```

**完整代码**：
```javascript
onLoad(options) {
  console.log('WebView 页面加载，参数:', options);

  const role = options.role || 'guest';
  const roomId = options.roomId || options.room || '';

  // 🔥 修改这里：使用你自己的域名
  const h5Domain = 'https://api.yourdomain.com/h5';
  
  let h5Url = '';
  let webviewUrl = '';

  if (role === 'host') {
    h5Url = `${h5Domain}/video-interview-host.html`;
    webviewUrl = h5Url;
  } else {
    if (!roomId) {
      wx.showModal({
        title: '提示',
        content: '缺少房间号参数',
        showCancel: false,
        success: () => {
          wx.navigateBack();
        }
      });
      return;
    }
    h5Url = `${h5Domain}/video-interview.html`;
    webviewUrl = `${h5Url}?room=${roomId}`;
  }

  this.setData({
    roomId: roomId,
    role: role,
    webviewUrl: webviewUrl
  });
}
```

**保存并重新编译小程序**。

---

## ✅ 完成！

现在你可以：

1. **在小程序中点击"视频面试"**
2. **创建面试间**
3. **邀请用户加入**

所有功能都已迁移到你自己的服务器！

---

## 🔧 如果使用宝塔面板

### 第 1 步：创建网站

1. 登录宝塔面板
2. 点击"网站" → "添加站点"
3. 域名：`api.yourdomain.com`
4. 根目录：`/www/wwwroot/api.yourdomain.com`
5. 不创建数据库

### 第 2 步：配置 SSL

1. 点击网站 → "设置" → "SSL"
2. 选择"Let's Encrypt"
3. 点击"申请"
4. 开启"强制HTTPS"

### 第 3 步：上传文件

1. 点击"文件"
2. 进入：`/www/wwwroot/api.yourdomain.com`
3. 创建 `h5` 文件夹
4. 上传 3 个文件到 `h5` 文件夹

### 第 4 步：测试

访问：`https://api.yourdomain.com/h5/video-interview-host.html`

---

## 📝 域名配置示例

### 示例 1：使用子目录

**域名**：`api.yourdomain.com`  
**路径**：`/h5/`  
**访问地址**：
- HR端：`https://api.yourdomain.com/h5/video-interview-host.html`
- 访客端：`https://api.yourdomain.com/h5/video-interview.html?room=xxx`

**小程序配置**：
```javascript
const h5Domain = 'https://api.yourdomain.com/h5';
```

---

### 示例 2：使用子域名

**域名**：`interview.yourdomain.com`  
**路径**：`/`（根目录）  
**访问地址**：
- HR端：`https://interview.yourdomain.com/video-interview-host.html`
- 访客端：`https://interview.yourdomain.com/video-interview.html?room=xxx`

**小程序配置**：
```javascript
const h5Domain = 'https://interview.yourdomain.com';
```

---

## ⚠️ 重要提示

### 1. 必须使用 HTTPS

视频面试功能必须使用 HTTPS 协议，否则浏览器会阻止摄像头和麦克风权限。

**解决方案**：
- 使用 Let's Encrypt 免费 SSL 证书
- 或购买商业 SSL 证书

### 2. 配置业务域名

必须在小程序后台配置业务域名，否则小程序无法加载 H5 页面。

### 3. 文件权限

确保上传的文件权限正确：
```bash
chmod 644 video-interview-host.html
chmod 644 video-interview.html
chmod 644 ZegoExpressWebRTC-standalone.js
```

### 4. 防火墙设置

确保服务器防火墙允许 443 端口（HTTPS）：
```bash
sudo ufw allow 443/tcp
```

---

## 🆘 遇到问题？

### 问题 1：页面打不开

**检查**：
- 域名是否解析到服务器 IP
- Nginx 配置是否正确
- SSL 证书是否有效

**测试命令**：
```bash
curl -I https://api.yourdomain.com/h5/video-interview-host.html
```

---

### 问题 2：小程序提示"不在业务域名列表中"

**检查**：
- 是否在小程序后台添加了域名
- 校验文件是否上传到正确位置
- 域名是否验证成功

---

### 问题 3：视频无法显示

**检查**：
- 浏览器是否允许摄像头和麦克风权限
- ZEGO AppID 和 ServerSecret 是否正确
- 网络是否正常

**查看控制台**：
按 F12 打开浏览器控制台，查看错误信息。

---

## 📞 获取帮助

如果遇到问题，请查看：
- `README.md` - 完整部署说明
- `部署配置说明.md` - 详细配置指南
- ZEGO 官方文档：https://doc-zh.zego.im/

---

## 🎉 恭喜！

你已经成功将视频面试功能迁移到自己的服务器！

现在你可以：
- ✅ 完全控制 H5 页面
- ✅ 随时修改和更新
- ✅ 无需依赖云开发
- ✅ 更好的性能和稳定性

**下一步**：
- 测试完整的面试流程
- 优化页面性能
- 添加更多功能

