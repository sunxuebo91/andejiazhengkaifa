# 小程序合同菜单更新说明

## 📅 更新时间
2026-02-24

## 🎯 更新内容

### 1. 菜单结构更新

在"合同管理"菜单下新增了"小程序合同"选项：

```
合同管理
├── 合同列表
├── 创建合同
└── 小程序合同 ✨ (新增)
```

### 2. 文件变更清单

#### 前端文件变更

1. **菜单配置** - `frontend/src/layouts/BasicLayout.tsx`
   - 在合同管理菜单中添加了"小程序合同"菜单项
   - 使用 `QrcodeOutlined` 图标
   - 路径：`/contracts/miniprogram`

2. **路由配置** - `frontend/src/router.tsx`
   - 添加了合同相关的懒加载组件导入
   - 新增三个路由：
     - `/contracts/list` - 合同列表
     - `/contracts/create` - 创建合同
     - `/contracts/miniprogram` - 小程序合同

3. **新增页面组件**
   - `frontend/src/pages/contracts/ContractCreate.tsx` - 创建合同页面（占位页面）
   - `frontend/src/pages/contracts/MiniProgramContractList.tsx` - 小程序合同列表页面

### 3. 小程序合同列表页面功能

#### 主要功能
- ✅ 分页查询小程序合同列表
- ✅ 搜索功能（支持合同编号、客户姓名、电话）
- ✅ 统计卡片展示（合同总数、签约中、已签约、其他状态）
- ✅ 查看合同详情（新标签页打开）
- ✅ 刷新功能

#### 数据字段
- 合同编号
- 客户姓名
- 客户电话
- 服务人员
- 服务人员电话
- 合同类型
- 签署状态（带颜色标签）
- 创建时间

#### API接口
调用后端接口：`GET /api/contracts/miniprogram/list`

参数：
- `page`: 页码
- `limit`: 每页数量
- `search`: 搜索关键词

### 4. 部署状态

✅ 前端已构建完成
✅ 生产环境已更新（PM2 已重启 frontend-prod）
✅ 服务运行正常

### 5. 访问方式

1. 登录 CRM 系统：https://crm.andejiazheng.com
2. 在左侧菜单找到"合同管理"
3. 点击"小程序合同"子菜单
4. 即可查看小程序端创建的所有合同

### 6. 技术细节

#### 状态颜色映射
```typescript
'0': 'default',  // 草稿
'1': 'processing',  // 签约中
'2': 'success',  // 已签约
'3': 'error',  // 已拒签
'4': 'warning',  // 已撤销
'5': 'default',  // 已过期
```

#### 响应式设计
- 表格支持横向滚动（x: 1200）
- 操作列固定在右侧
- 支持分页、快速跳转、每页数量调整

### 7. 后续优化建议

1. **筛选功能**
   - 添加合同类型筛选
   - 添加签署状态筛选
   - 添加日期范围筛选

2. **批量操作**
   - 批量导出合同
   - 批量同步状态

3. **详情页优化**
   - 在当前页面展示详情（抽屉或模态框）
   - 添加签署进度可视化

4. **实时更新**
   - WebSocket 实时推送合同状态变更
   - 自动刷新列表

## 📝 注意事项

1. 小程序合同列表调用的是公开接口，无需认证
2. 合同详情页面会在新标签页打开
3. 统计数据基于当前页面的数据计算，不是全局统计

## 🔗 相关文档

- [小程序合同创建完整API列表](./小程序合同创建完整API列表.md)
- [小程序合同完整业务流程](./小程序合同完整业务流程.md)
- [小程序API完整文档](./backend/docs/小程序API完整文档.md)

