# å°ç¨‹åºç”¨æˆ·ç®¡ç†åŠŸèƒ½å®ç°æ€»ç»“

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

ä¸ºè¤“è´åå°æ·»åŠ äº†å°ç¨‹åºç”¨æˆ·ç®¡ç†åŠŸèƒ½ï¼Œç”¨äºæ¥æ”¶å’Œç®¡ç†å°ç¨‹åºç«¯ä¼ è¾“çš„ç”¨æˆ·æ³¨å†Œä¿¡æ¯ã€‚

## âœ… å·²å®ç°åŠŸèƒ½

### 1. åç«¯APIå®ç°

#### æ•°æ®æ¨¡å‹ (`MiniProgramUser`)
- **æ‰‹æœºå·** (phone) - å¿…å¡«ï¼Œå”¯ä¸€æ ‡è¯†
- **æ˜µç§°** (nickname) - å¯é€‰
- **å¤´åƒ** (avatar) - å¯é€‰
- **å¾®ä¿¡ä¿¡æ¯** (openid, unionid) - å¯é€‰
- **çŠ¶æ€** (status) - active/inactive/blocked
- **ç™»å½•ä¿¡æ¯** (lastLoginAt, lastLoginIp, loginCount)
- **ç”¨æˆ·ä¿¡æ¯** (gender, city, province, country, language)
- **æ—¶é—´æˆ³** (createdAt, updatedAt) - è‡ªåŠ¨ç”Ÿæˆ

#### APIæ¥å£

**å…¬å¼€æ¥å£ï¼ˆæ— éœ€è®¤è¯ï¼‰ï¼š**
- `POST /api/miniprogram-users/register` - æ³¨å†Œæˆ–æ›´æ–°ç”¨æˆ·
- `POST /api/miniprogram-users/login` - è®°å½•ç”¨æˆ·ç™»å½•

**ç®¡ç†æ¥å£ï¼ˆéœ€è¦JWTè®¤è¯ï¼‰ï¼š**
- `GET /api/miniprogram-users` - è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µå’Œæœç´¢ï¼‰
- `GET /api/miniprogram-users/statistics` - è·å–ç»Ÿè®¡ä¿¡æ¯
- `GET /api/miniprogram-users/:id` - è·å–ç”¨æˆ·è¯¦æƒ…
- `PATCH /api/miniprogram-users/:id` - æ›´æ–°ç”¨æˆ·ä¿¡æ¯
- `DELETE /api/miniprogram-users/:id` - åˆ é™¤ç”¨æˆ·

### 2. å‰ç«¯é¡µé¢å®ç°

#### ç”¨æˆ·åˆ—è¡¨é¡µé¢ (`/miniprogram-users`)

**ç»Ÿè®¡å¡ç‰‡ï¼š**
- æ€»ç”¨æˆ·æ•°
- ä»Šæ—¥æ–°å¢ç”¨æˆ·æ•°
- ä»Šæ—¥æ´»è·ƒç”¨æˆ·æ•°

**ç”¨æˆ·åˆ—è¡¨è¡¨æ ¼ï¼š**
- ç”¨æˆ·ä¿¡æ¯ï¼ˆå¤´åƒã€æ˜µç§°ã€æ‰‹æœºå·ï¼‰
- æ€§åˆ«
- åœ°åŒºï¼ˆçœä»½ + åŸå¸‚ï¼‰
- çŠ¶æ€ï¼ˆæ´»è·ƒ/ä¸æ´»è·ƒ/å·²å°ç¦ï¼‰
- ç™»å½•æ¬¡æ•°
- æœ€è¿‘ç™»å½•æ—¶é—´
- æ³¨å†Œæ—¶é—´

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- æœç´¢åŠŸèƒ½ï¼ˆæ‰‹æœºå·æˆ–æ˜µç§°ï¼‰
- åˆ†é¡µæ˜¾ç¤ºï¼ˆæ¯é¡µ20æ¡ï¼‰
- å“åº”å¼å¸ƒå±€

## ğŸ“Š æ•°æ®åº“è®¾è®¡

**é›†åˆåç§°ï¼š** `miniprogram_users`

**ç´¢å¼•ï¼š**
- `phone` - å”¯ä¸€ç´¢å¼•
- `openid` - æ™®é€šç´¢å¼•
- `createdAt` - é™åºç´¢å¼•
- `lastLoginAt` - é™åºç´¢å¼•

## ğŸ”Œ å°ç¨‹åºç«¯è°ƒç”¨ç¤ºä¾‹

### ç”¨æˆ·æ³¨å†Œ/ç™»å½•

```javascript
// å°ç¨‹åºç«¯è°ƒç”¨ç¤ºä¾‹
wx.request({
  url: 'https://crm.andejiazheng.com/api/miniprogram-users/register',
  method: 'POST',
  data: {
    phone: '13800138000',
    nickname: 'å¾®ä¿¡ç”¨æˆ·',
    avatar: 'https://example.com/avatar.jpg',
    openid: 'wx_openid_xxx',
    gender: 1, // 0-æœªçŸ¥, 1-ç”·, 2-å¥³
    city: 'åŒ—äº¬',
    province: 'åŒ—äº¬',
    country: 'ä¸­å›½',
    language: 'zh_CN'
  },
  success: (res) => {
    console.log('æ³¨å†ŒæˆåŠŸ:', res.data);
    // {
    //   success: true,
    //   data: { _id, phone, nickname, ... },
    //   message: 'æ³¨å†ŒæˆåŠŸ'
    // }
  }
});
```

### è®°å½•ç™»å½•

```javascript
wx.request({
  url: 'https://crm.andejiazheng.com/api/miniprogram-users/login',
  method: 'POST',
  data: {
    phone: '13800138000'
  },
  success: (res) => {
    console.log('ç™»å½•è®°å½•æˆåŠŸ:', res.data);
  }
});
```

## ğŸ¯ ä¸šåŠ¡é€»è¾‘

### æ³¨å†Œæˆ–æ›´æ–°é€»è¾‘
1. æ ¹æ®æ‰‹æœºå·æŸ¥æ‰¾ç”¨æˆ·
2. å¦‚æœç”¨æˆ·å­˜åœ¨ï¼š
   - æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼ˆæ˜µç§°ã€å¤´åƒç­‰ï¼‰
   - æ›´æ–°æœ€è¿‘ç™»å½•æ—¶é—´å’ŒIP
   - ç™»å½•æ¬¡æ•° +1
3. å¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼š
   - åˆ›å»ºæ–°ç”¨æˆ·è®°å½•
   - è®¾ç½®åˆå§‹ç™»å½•ä¿¡æ¯
   - çŠ¶æ€è®¾ä¸º 'active'

### ç»Ÿè®¡ä¿¡æ¯è®¡ç®—
- **æ€»ç”¨æˆ·æ•°**ï¼šæ‰€æœ‰ç”¨æˆ·è®°å½•æ•°
- **ä»Šæ—¥æ–°å¢**ï¼šcreatedAt åœ¨ä»Šå¤©çš„ç”¨æˆ·æ•°
- **ä»Šæ—¥æ´»è·ƒ**ï¼šlastLoginAt åœ¨ä»Šå¤©çš„ç”¨æˆ·æ•°

## ğŸŒ è®¿é—®åœ°å€

- **ç”Ÿäº§ç¯å¢ƒ**: https://crm.andejiazheng.com
- **ç”¨æˆ·ç®¡ç†é¡µé¢**: https://crm.andejiazheng.com/miniprogram-users

## ğŸ“ æ–‡ä»¶æ¸…å•

### åç«¯æ–‡ä»¶
- `backend/src/modules/miniprogram-user/models/miniprogram-user.entity.ts` - æ•°æ®æ¨¡å‹
- `backend/src/modules/miniprogram-user/dto/register-miniprogram-user.dto.ts` - æ³¨å†ŒDTO
- `backend/src/modules/miniprogram-user/dto/update-miniprogram-user.dto.ts` - æ›´æ–°DTO
- `backend/src/modules/miniprogram-user/miniprogram-user.service.ts` - ä¸šåŠ¡é€»è¾‘
- `backend/src/modules/miniprogram-user/miniprogram-user.controller.ts` - APIæ§åˆ¶å™¨
- `backend/src/modules/miniprogram-user/miniprogram-user.module.ts` - æ¨¡å—å®šä¹‰
- `backend/src/app.module.ts` - å·²æ³¨å†Œæ¨¡å—

### å‰ç«¯æ–‡ä»¶
- `frontend/src/pages/miniprogram-users/MiniProgramUserList.tsx` - ç”¨æˆ·åˆ—è¡¨é¡µé¢
- `frontend/src/router.tsx` - å·²æ·»åŠ è·¯ç”±é…ç½®

## âœ… æµ‹è¯•ç»“æœ

- âœ… ç”¨æˆ·æ³¨å†ŒAPIæµ‹è¯•é€šè¿‡
- âœ… ç”¨æˆ·åˆ—è¡¨APIæµ‹è¯•é€šè¿‡
- âœ… ç»Ÿè®¡ä¿¡æ¯APIæµ‹è¯•é€šè¿‡
- âœ… åˆ›å»ºäº†4ä¸ªæµ‹è¯•ç”¨æˆ·
- âœ… å‰åç«¯æœåŠ¡å·²éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

## ğŸ‰ éƒ¨ç½²çŠ¶æ€

- âœ… åç«¯æœåŠ¡ï¼šå·²æ„å»ºå¹¶é‡å¯ï¼ˆbackend-prodï¼‰
- âœ… å‰ç«¯æœåŠ¡ï¼šå·²æ„å»ºå¹¶é‡å¯ï¼ˆfrontend-prodï¼‰
- âœ… æ•°æ®åº“ï¼šMongoDBé›†åˆå·²è‡ªåŠ¨åˆ›å»º
- âœ… ç´¢å¼•ï¼šå·²è‡ªåŠ¨åˆ›å»º

åŠŸèƒ½å·²å®Œå…¨å®ç°å¹¶æˆåŠŸéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼

