# ğŸ“± å°ç¨‹åºè§†é¢‘é¢è¯•åŠŸèƒ½ - é›†æˆæ–‡æ¡£

> **é€‚ç”¨å¯¹è±¡**ï¼šå°ç¨‹åºå¼€å‘è€…  
> **å¼€å‘æ—¶é—´**ï¼š4-6å°æ—¶  
> **ä¸»é¢˜è‰²**ï¼š#5DBFB3ï¼ˆé’ç»¿è‰²ï¼‰

---

## ğŸ“– ç›®å½•

- [åŠŸèƒ½æ¦‚è¿°](#åŠŸèƒ½æ¦‚è¿°)
- [é¡µé¢ç»“æ„](#é¡µé¢ç»“æ„)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [å®Œæ•´ä»£ç ](#å®Œæ•´ä»£ç )
- [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
- [æµ‹è¯•æŒ‡å—](#æµ‹è¯•æŒ‡å—)

---

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

### HRç«¯åŠŸèƒ½
âœ… åˆ›å»ºè§†é¢‘é¢è¯•æˆ¿é—´  
âœ… è‡ªåŠ¨ç”Ÿæˆæˆ¿é—´å·  
âœ… ä»¥ä¸»æŒäººèº«ä»½è¿›å…¥æˆ¿é—´  
âœ… åˆ†äº«æˆ¿é—´ç»™æ±‚èŒè€…  
âœ… ç®¡ç†å‚ä¸è€…  

### æ±‚èŒè€…ç«¯åŠŸèƒ½
âœ… é€šè¿‡åˆ†äº«é“¾æ¥/æ‰«ç åŠ å…¥  
âœ… å¡«å†™ä¸ªäººä¿¡æ¯ï¼ˆå§“åã€èº«ä»½ï¼‰  
âœ… ä»¥è®¿å®¢èº«ä»½å‚ä¸é¢è¯•  
âœ… å®æ—¶éŸ³è§†é¢‘äº¤æµ  

---

## ğŸ“ é¡µé¢ç»“æ„

```
miniprogram/
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ interview/
â”‚       â”œâ”€â”€ create/      # åˆ›å»ºæˆ¿é—´ï¼ˆåŸç”Ÿé¡µé¢ï¼‰
â”‚       â”‚   â”œâ”€â”€ create.wxml
â”‚       â”‚   â”œâ”€â”€ create.js
â”‚       â”‚   â”œâ”€â”€ create.wxss
â”‚       â”‚   â””â”€â”€ create.json
â”‚       â”œâ”€â”€ host/        # HRè§†é¢‘ï¼ˆWebViewï¼‰
â”‚       â”‚   â”œâ”€â”€ host.wxml
â”‚       â”‚   â”œâ”€â”€ host.js
â”‚       â”‚   â”œâ”€â”€ host.wxss
â”‚       â”‚   â””â”€â”€ host.json
â”‚       â”œâ”€â”€ guest/       # è®¿å®¢åŠ å…¥ï¼ˆåŸç”Ÿé¡µé¢ï¼‰
â”‚       â”‚   â”œâ”€â”€ guest.wxml
â”‚       â”‚   â”œâ”€â”€ guest.js
â”‚       â”‚   â”œâ”€â”€ guest.wxss
â”‚       â”‚   â””â”€â”€ guest.json
â”‚       â””â”€â”€ video/       # è®¿å®¢è§†é¢‘ï¼ˆWebViewï¼‰
â”‚           â”œâ”€â”€ video.wxml
â”‚           â”œâ”€â”€ video.js
â”‚           â”œâ”€â”€ video.wxss
â”‚           â””â”€â”€ video.json
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ api.js          # APIå°è£…
â”‚   â””â”€â”€ util.js         # å·¥å…·å‡½æ•°
â”œâ”€â”€ app.js
â”œâ”€â”€ app.json
â””â”€â”€ app.wxss
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ­¥ï¼šé…ç½®åŸŸå

ç™»å½•å¾®ä¿¡å…¬ä¼—å¹³å° https://mp.weixin.qq.com

**1. é…ç½®æœåŠ¡å™¨åŸŸå**
```
å¼€å‘ â†’ å¼€å‘ç®¡ç† â†’ å¼€å‘è®¾ç½® â†’ æœåŠ¡å™¨åŸŸå
æ·»åŠ ï¼šhttps://crm.andejiazheng.com
```

**2. é…ç½®ä¸šåŠ¡åŸŸåï¼ˆWebViewï¼‰**
```
å¼€å‘ â†’ å¼€å‘ç®¡ç† â†’ å¼€å‘è®¾ç½® â†’ ä¸šåŠ¡åŸŸå
æ·»åŠ ï¼šcrm.andejiazheng.com
ä¸‹è½½æ ¡éªŒæ–‡ä»¶å¹¶ä¸Šä¼ åˆ°æœåŠ¡å™¨æ ¹ç›®å½•
```

### ç¬¬äºŒæ­¥ï¼šåˆ›å»ºç›®å½•

åœ¨å°ç¨‹åºé¡¹ç›®ä¸­åˆ›å»ºä»¥ä¸‹ç›®å½•ï¼š

```bash
mkdir -p pages/interview/create
mkdir -p pages/interview/host
mkdir -p pages/interview/guest
mkdir -p pages/interview/video
mkdir -p utils
```

### ç¬¬ä¸‰æ­¥ï¼šå¤åˆ¶ä»£ç 

æŒ‰ç…§ä¸‹é¢çš„ä»£ç æ¨¡æ¿ï¼Œå¤åˆ¶åˆ°å¯¹åº”æ–‡ä»¶ä¸­ã€‚

---

## ğŸ“„ å®Œæ•´ä»£ç 

### 1. å·¥å…·å‡½æ•° - utils/util.js

```javascript
/**
 * ç”Ÿæˆæˆ¿é—´å·
 */
function generateRoomId() {
  const timestamp = Date.now();
  const random = Math.random().toString(36).substring(2, 8);
  return `room_${timestamp}_${random}`;
}

/**
 * æ ¼å¼åŒ–æ—¶é—´
 */
function formatTime(date) {
  const year = date.getFullYear();
  const month = date.getMonth() + 1;
  const day = date.getDate();
  const hour = date.getHours();
  const minute = date.getMinutes();
  const second = date.getSeconds();
  return `${[year, month, day].map(formatNumber).join('-')} ${[hour, minute, second].map(formatNumber).join(':')}`;
}

function formatNumber(n) {
  n = n.toString();
  return n[1] ? n : `0${n}`;
}

function showLoading(title = 'åŠ è½½ä¸­...') {
  wx.showLoading({ title, mask: true });
}

function hideLoading() {
  wx.hideLoading();
}

function showSuccess(title) {
  wx.showToast({ title, icon: 'success', duration: 2000 });
}

function showError(title) {
  wx.showToast({ title, icon: 'none', duration: 2000 });
}

module.exports = {
  generateRoomId,
  formatTime,
  showLoading,
  hideLoading,
  showSuccess,
  showError
};
```

### 2. APIå°è£… - utils/api.js

```javascript
const BASE_URL = 'https://crm.andejiazheng.com/api';

function request(url, method = 'GET', data = {}) {
  return new Promise((resolve, reject) => {
    const token = wx.getStorageSync('token');
    
    wx.request({
      url: `${BASE_URL}${url}`,
      method,
      data,
      header: {
        'Content-Type': 'application/json',
        'Authorization': token ? `Bearer ${token}` : ''
      },
      success: (res) => {
        if (res.statusCode === 200) {
          resolve(res.data);
        } else if (res.statusCode === 401) {
          wx.showModal({
            title: 'æç¤º',
            content: 'ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•',
            showCancel: false
          });
          reject(new Error('æœªæˆæƒ'));
        } else {
          reject(new Error(res.data.message || 'è¯·æ±‚å¤±è´¥'));
        }
      },
      fail: (error) => {
        console.error('è¯·æ±‚å¤±è´¥:', error);
        reject(error);
      }
    });
  });
}

function createRoom(data) {
  return request('/interview/create-room', 'POST', data);
}

function getRoomInfo(roomId) {
  return request(`/interview/room/${roomId}`, 'GET');
}

function wxLogin(code) {
  return request('/wechat/login', 'POST', { code });
}

module.exports = {
  request,
  createRoom,
  getRoomInfo,
  wxLogin
};
```

### 3. åˆ›å»ºé¢è¯•é—´é¡µé¢

#### pages/interview/create/create.wxml
```xml
<view class="container">
  <view class="header">
    <image class="icon" src="/images/video-icon.png" mode="aspectFit"></image>
    <text class="title">è§†é¢‘é¢è¯•</text>
    <text class="subtitle">æ”¯æŒ 3-6 äººè§†é¢‘é¢è¯•ï¼Œå†…ç½®ç¾é¢œã€å±å¹•å…±äº«ã€èŠå¤©ç­‰åŠŸèƒ½</text>
  </view>

  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-card">
    <view class="user-avatar">
      <text class="avatar-text">{{userName ? userName.substring(0, 1) : 'HR'}}</text>
    </view>
    <view class="user-info">
      <text class="user-name">{{userName || 'åŠ è½½ä¸­...'}}</text>
      <text class="user-role">é¢è¯•å®˜</text>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="actions">
    <button class="btn-primary" bindtap="createInterview" disabled="{{!userName}}">
      <text class="btn-icon">ğŸ“¹</text>
      <text class="btn-text">åˆ›å»ºé¢è¯•é—´</text>
    </button>

    <button class="btn-secondary" bindtap="rejoinInterview" disabled="{{!lastRoomId}}" wx:if="{{lastRoomId}}">
      <text class="btn-icon">ğŸ”„</text>
      <text class="btn-text">é‡æ–°è¿›å…¥</text>
    </button>
  </view>

  <!-- åŠŸèƒ½è¯´æ˜ -->
  <view class="features">
    <view class="feature-title">åŠŸèƒ½è¯´æ˜</view>
    <view class="feature-item">
      <text class="feature-icon">âœ…</text>
      <text class="feature-text">æ”¯æŒ 3-6 äººåŒæ—¶è§†é¢‘é¢è¯•</text>
    </view>
    <view class="feature-item">
      <text class="feature-icon">âœ…</text>
      <text class="feature-text">å†…ç½®ç¾é¢œåŠŸèƒ½ï¼ˆç‚¹å‡»è®¾ç½®æŒ‰é’®è°ƒèŠ‚ï¼‰</text>
    </view>
    <view class="feature-item">
      <text class="feature-icon">âœ…</text>
      <text class="feature-text">æ”¯æŒå±å¹•å…±äº«ï¼ˆå¯å±•ç¤ºç®€å†ï¼‰</text>
    </view>
    <view class="feature-item">
      <text class="feature-icon">âœ…</text>
      <text class="feature-text">æ”¯æŒæ–‡å­—èŠå¤©</text>
    </view>
    <view class="feature-item">
      <text class="feature-icon">âœ…</text>
      <text class="feature-text">æ”¯æŒæŸ¥çœ‹æˆå‘˜åˆ—è¡¨</text>
    </view>
    <view class="feature-item">
      <text class="feature-icon">âœ…</text>
      <text class="feature-text">æ”¯æŒè¸¢å‡ºæˆå‘˜ï¼ˆæˆ¿ä¸»æƒé™ï¼‰</text>
    </view>
  </view>
</view>
```

#### pages/interview/create/create.js
```javascript
const app = getApp();
const api = require('../../../utils/api.js');
const util = require('../../../utils/util.js');

Page({
  data: {
    userName: '',      // å½“å‰ç”¨æˆ·åç§°
    lastRoomId: ''     // ä¸Šæ¬¡çš„æˆ¿é—´å·ï¼ˆç”¨äºé‡æ–°è¿›å…¥ï¼‰
  },

  onLoad() {
    this.loadUserInfo();
    this.loadLastRoom();
  },

  onShow() {
    // æ¯æ¬¡æ˜¾ç¤ºé¡µé¢æ—¶åˆ·æ–°ç”¨æˆ·ä¿¡æ¯
    this.loadUserInfo();
  },

  /**
   * åŠ è½½ç”¨æˆ·ä¿¡æ¯
   */
  async loadUserInfo() {
    try {
      // ä»æœ¬åœ°ç¼“å­˜è¯»å–
      const userInfo = wx.getStorageSync('userInfo');
      if (userInfo && userInfo.name) {
        this.setData({ userName: userInfo.name });
        return;
      }

      // å¦‚æœæœ¬åœ°æ²¡æœ‰ï¼Œä»æœåŠ¡å™¨è·å–
      util.showLoading('åŠ è½½ä¸­...');
      const res = await api.request('/user/info', 'GET');
      util.hideLoading();

      if (res.success && res.data) {
        const userName = res.data.name || res.data.realName || res.data.username;
        this.setData({ userName });
        // ä¿å­˜åˆ°æœ¬åœ°
        wx.setStorageSync('userInfo', { name: userName });
      }
    } catch (error) {
      util.hideLoading();
      console.error('åŠ è½½ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
      wx.showModal({
        title: 'æç¤º',
        content: 'è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥ï¼Œè¯·é‡æ–°ç™»å½•',
        showCancel: false
      });
    }
  },

  /**
   * åŠ è½½ä¸Šæ¬¡çš„æˆ¿é—´ä¿¡æ¯
   */
  loadLastRoom() {
    const lastRoomId = wx.getStorageSync('lastRoomId');
    if (lastRoomId) {
      this.setData({ lastRoomId });
    }
  },

  /**
   * åˆ›å»ºé¢è¯•é—´
   */
  async createInterview() {
    const { userName } = this.data;
    if (!userName) {
      wx.showToast({ title: 'ç”¨æˆ·ä¿¡æ¯åŠ è½½ä¸­ï¼Œè¯·ç¨å€™', icon: 'none' });
      return;
    }

    // è‡ªåŠ¨ç”Ÿæˆæˆ¿é—´å·
    const roomId = util.generateRoomId();

    util.showLoading('åˆ›å»ºé¢è¯•é—´...');
    try {
      const res = await api.createRoom({
        roomId,
        roomName: `${userName}çš„é¢è¯•é—´`,
        hostName: userName
      });

      util.hideLoading();

      if (res.success) {
        // ä¿å­˜æˆ¿é—´å·ï¼Œç”¨äºé‡æ–°è¿›å…¥
        wx.setStorageSync('lastRoomId', roomId);

        // è¿›å…¥é¢è¯•é—´
        wx.navigateTo({
          url: `/pages/interview/host/host?roomId=${roomId}&userName=${encodeURIComponent(userName)}`
        });
      } else {
        throw new Error(res.message || 'åˆ›å»ºé¢è¯•é—´å¤±è´¥');
      }
    } catch (error) {
      util.hideLoading();
      wx.showModal({
        title: 'åˆ›å»ºå¤±è´¥',
        content: error.message || 'åˆ›å»ºé¢è¯•é—´å¤±è´¥ï¼Œè¯·é‡è¯•',
        showCancel: false
      });
    }
  },

  /**
   * é‡æ–°è¿›å…¥ä¸Šæ¬¡çš„é¢è¯•é—´
   */
  async rejoinInterview() {
    const { lastRoomId, userName } = this.data;
    if (!lastRoomId) {
      wx.showToast({ title: 'æ²¡æœ‰å¯é‡æ–°è¿›å…¥çš„é¢è¯•é—´', icon: 'none' });
      return;
    }

    util.showLoading('è¿›å…¥é¢è¯•é—´...');
    try {
      // æ£€æŸ¥æˆ¿é—´æ˜¯å¦è¿˜å­˜åœ¨
      const res = await api.getRoomInfo(lastRoomId);
      util.hideLoading();

      if (res.success && res.data) {
        // æˆ¿é—´å­˜åœ¨ï¼Œç›´æ¥è¿›å…¥
        wx.navigateTo({
          url: `/pages/interview/host/host?roomId=${lastRoomId}&userName=${encodeURIComponent(userName)}`
        });
      } else {
        // æˆ¿é—´ä¸å­˜åœ¨
        wx.showModal({
          title: 'æç¤º',
          content: 'è¯¥é¢è¯•é—´å·²ç»“æŸï¼Œè¯·åˆ›å»ºæ–°çš„é¢è¯•é—´',
          showCancel: false,
          success: () => {
            // æ¸…é™¤ä¿å­˜çš„æˆ¿é—´å·
            wx.removeStorageSync('lastRoomId');
            this.setData({ lastRoomId: '' });
          }
        });
      }
    } catch (error) {
      util.hideLoading();
      wx.showModal({
        title: 'è¿›å…¥å¤±è´¥',
        content: error.message || 'è¿›å…¥é¢è¯•é—´å¤±è´¥ï¼Œè¯·é‡è¯•',
        showCancel: false
      });
    }
  }
});
```

#### pages/interview/create/create.wxss
```css
.container {
  min-height: 100vh;
  background: linear-gradient(135deg, #5DBFB3 0%, #4AA89E 100%);
  padding: 40rpx;
  box-sizing: border-box;
}

/* å¤´éƒ¨ */
.header {
  text-align: center;
  padding: 60rpx 0 40rpx;
}

.icon {
  width: 120rpx;
  height: 120rpx;
  margin-bottom: 24rpx;
}

.title {
  display: block;
  font-size: 48rpx;
  font-weight: bold;
  color: #fff;
  margin-bottom: 16rpx;
}

.subtitle {
  display: block;
  font-size: 24rpx;
  color: rgba(255, 255, 255, 0.9);
  line-height: 36rpx;
  padding: 0 40rpx;
}

/* ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ */
.user-card {
  background: #fff;
  border-radius: 24rpx;
  padding: 32rpx;
  margin-bottom: 32rpx;
  display: flex;
  align-items: center;
  box-shadow: 0 8rpx 32rpx rgba(0, 0, 0, 0.1);
}

.user-avatar {
  width: 96rpx;
  height: 96rpx;
  border-radius: 50%;
  background: linear-gradient(135deg, #5DBFB3 0%, #4AA89E 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 24rpx;
}

.avatar-text {
  font-size: 40rpx;
  color: #fff;
  font-weight: bold;
}

.user-info {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.user-name {
  font-size: 32rpx;
  color: #333;
  font-weight: bold;
  margin-bottom: 8rpx;
}

.user-role {
  font-size: 24rpx;
  color: #999;
}

/* æ“ä½œæŒ‰é’® */
.actions {
  margin-bottom: 32rpx;
}

.btn-primary,
.btn-secondary {
  width: 100%;
  height: 96rpx;
  border: none;
  border-radius: 16rpx;
  font-size: 32rpx;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 24rpx;
}

.btn-primary {
  background: #fff;
  color: #5DBFB3;
  box-shadow: 0 8rpx 32rpx rgba(0, 0, 0, 0.1);
}

.btn-primary[disabled] {
  background: rgba(255, 255, 255, 0.5);
  color: rgba(93, 191, 179, 0.5);
}

.btn-secondary {
  background: rgba(255, 255, 255, 0.2);
  color: #fff;
  border: 2rpx solid rgba(255, 255, 255, 0.5);
}

.btn-secondary[disabled] {
  opacity: 0.5;
}

.btn-icon {
  font-size: 36rpx;
  margin-right: 12rpx;
}

.btn-text {
  font-size: 32rpx;
}

/* åŠŸèƒ½è¯´æ˜ */
.features {
  background: rgba(255, 255, 255, 0.15);
  border-radius: 24rpx;
  padding: 32rpx;
  backdrop-filter: blur(10rpx);
}

.feature-title {
  font-size: 28rpx;
  color: #fff;
  font-weight: bold;
  margin-bottom: 24rpx;
}

.feature-item {
  display: flex;
  align-items: flex-start;
  margin-bottom: 16rpx;
}

.feature-item:last-child {
  margin-bottom: 0;
}

.feature-icon {
  font-size: 28rpx;
  margin-right: 12rpx;
  line-height: 40rpx;
}

.feature-text {
  flex: 1;
  font-size: 26rpx;
  color: rgba(255, 255, 255, 0.95);
  line-height: 40rpx;
}
```

#### pages/interview/create/create.json
```json
{
  "navigationBarTitleText": "åˆ›å»ºé¢è¯•",
  "navigationBarBackgroundColor": "#5DBFB3",
  "navigationBarTextStyle": "white"
}
```

### 4. HRä¸»æŒäººè§†é¢‘é¡µé¢

#### pages/interview/host/host.wxml
```xml
<web-view src="{{webviewUrl}}" bindmessage="handleMessage"></web-view>
```

#### pages/interview/host/host.js
```javascript
Page({
  data: {
    webviewUrl: '',
    roomId: '',
    userName: ''
  },

  onLoad(options) {
    const { roomId, userName } = options;
    if (!roomId || !userName) {
      wx.showModal({
        title: 'æç¤º',
        content: 'ç¼ºå°‘å¿…è¦å‚æ•°',
        showCancel: false,
        success: () => wx.navigateBack()
      });
      return;
    }

    const baseUrl = 'https://crm.andejiazheng.com';
    const webviewUrl = `${baseUrl}/interview/video-mobile/${roomId}?userName=${encodeURIComponent(userName)}`;
    this.setData({ webviewUrl, roomId, userName });
  },

  handleMessage(e) {
    const messages = e.detail.data;
    if (messages && messages.length > 0) {
      const lastMessage = messages[messages.length - 1];
      if (lastMessage.type === 'leave') {
        wx.showModal({
          title: 'æç¤º',
          content: 'é¢è¯•å·²ç»“æŸ',
          showCancel: false,
          success: () => wx.navigateBack({ delta: 2 })
        });
      }
    }
  },

  onShareAppMessage() {
    return {
      title: 'è§†é¢‘é¢è¯•é‚€è¯·',
      path: `/pages/interview/guest/guest?roomId=${this.data.roomId}`
    };
  }
});
```

#### pages/interview/host/host.wxss
```css
page {
  width: 100%;
  height: 100%;
}
```

#### pages/interview/host/host.json
```json
{
  "navigationBarTitleText": "è§†é¢‘é¢è¯•",
  "navigationBarBackgroundColor": "#5DBFB3",
  "navigationBarTextStyle": "white",
  "disableScroll": true
}
```

---

**ç»§ç»­æŸ¥çœ‹å®Œæ•´ä»£ç ï¼Œè¯·å‚è€ƒé¡¹ç›®ä¸­çš„è¯¦ç»†æ–‡æ¡£ï¼š**
- `MINIPROGRAM_CODE_TEMPLATES.md` - å®Œæ•´ä»£ç ï¼ˆç¬¬1éƒ¨åˆ†ï¼‰
- `MINIPROGRAM_CODE_TEMPLATES_PART2.md` - å®Œæ•´ä»£ç ï¼ˆç¬¬2éƒ¨åˆ†ï¼‰
- `MINIPROGRAM_BACKEND_API.md` - åç«¯APIæ–‡æ¡£
- `MINIPROGRAM_DEPLOYMENT_GUIDE.md` - éƒ¨ç½²æŒ‡å—
- `MINIPROGRAM_QUICK_START.md` - å¿«é€Ÿå¼€å§‹æŒ‡å—

