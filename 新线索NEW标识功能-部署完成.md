# æ–°çº¿ç´¢ NEW æ ‡è¯†åŠŸèƒ½ - éƒ¨ç½²å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

åœ¨å®¢æˆ·åˆ—è¡¨çš„å®¢æˆ·ç¼–å·æ—è¾¹æ·»åŠ ç»¿è‰²çš„ "NEW" æ ‡è¯†ï¼Œç”¨äºæ ‡è¯†é¦–æ¬¡åˆ›å»ºã€æœªè¢«è½®è½¬ã€æœªè¢«æ‰‹åŠ¨åˆ†é…çš„æ–°çº¿ç´¢ã€‚

## âœ… éƒ¨ç½²çŠ¶æ€

- **éƒ¨ç½²æ—¶é—´**: 2026-01-05 18:31
- **éƒ¨ç½²ç¯å¢ƒ**: ç”Ÿäº§ç¯å¢ƒ (frontend-prod)
- **éƒ¨ç½²çŠ¶æ€**: âœ… æˆåŠŸ

## ğŸ¯ åŠŸèƒ½è¯´æ˜

### NEW æ ‡è¯†æ˜¾ç¤ºæ¡ä»¶

çº¿ç´¢ä¼šæ˜¾ç¤ºç»¿è‰² "NEW" æ ‡è¯†ï¼Œå½“æ»¡è¶³ä»¥ä¸‹**æ‰€æœ‰**æ¡ä»¶æ—¶ï¼š

1. **æœªè¢«è½®è½¬** - `transferCount === 0` æˆ–æœªå®šä¹‰
2. **æœªè¢«æ‰‹åŠ¨åˆ†é…** - `assignmentReason` ä¸ºä»¥ä¸‹ä¹‹ä¸€ï¼š
   - `åˆ›å»ºé»˜è®¤åˆ†é…ç»™åˆ›å»ºäºº`
   - åŒ…å« `ç³»ç»Ÿè‡ªåŠ¨åˆ†é…`
   - åŒ…å« `å¾®ä¿¡`

### è§†è§‰æ•ˆæœ

```
å®¢æˆ·ç¼–å·              å§“å
CUS79382022685 [NEW]  å¼ ä¸‰
CUS47980118257        æå››
```

- æ ‡è¯†é¢œè‰²ï¼šç»¿è‰² (green)
- æ ‡è¯†æ–‡å­—ï¼šNEW
- ä½ç½®ï¼šå®¢æˆ·ç¼–å·å³ä¾§

## ğŸ“ ä»£ç å˜æ›´

### 1. å‰ç«¯ç±»å‹å®šä¹‰ (`frontend/src/types/customer.types.ts`)

æ·»åŠ äº†çº¿ç´¢æµè½¬ç›¸å…³å­—æ®µï¼š

```typescript
// çº¿ç´¢æµè½¬ç›¸å…³å­—æ®µ
transferCount?: number;
lastTransferredAt?: string;
```

### 2. å®¢æˆ·åˆ—è¡¨ç»„ä»¶ (`frontend/src/pages/customers/CustomerList.tsx`)

ä¿®æ”¹äº†"å®¢æˆ·ç¼–å·"åˆ—çš„æ¸²æŸ“é€»è¾‘ï¼š

```typescript
render: (customerId: string, record: Customer) => {
  // åˆ¤æ–­æ˜¯å¦ä¸ºæ–°çº¿ç´¢ï¼šé¦–æ¬¡åˆ›å»ºã€æœªè¢«è½®è½¬ã€æœªè¢«æ‰‹åŠ¨åˆ†é…
  const isNewLead = (record.transferCount === 0 || !record.transferCount) && 
                    (record.assignmentReason === 'åˆ›å»ºé»˜è®¤åˆ†é…ç»™åˆ›å»ºäºº' ||
                     record.assignmentReason?.includes('ç³»ç»Ÿè‡ªåŠ¨åˆ†é…') ||
                     record.assignmentReason?.includes('å¾®ä¿¡'));
  
  return (
    <Space size={4}>
      <Link to={`/customers/${record._id}`} style={{ color: '#1890ff', fontWeight: 'bold' }}>
        {customerId}
      </Link>
      {isNewLead && (
        <Tag color="green" style={{ fontSize: '10px', padding: '0 4px', lineHeight: '16px', margin: 0 }}>
          NEW
        </Tag>
      )}
    </Space>
  );
}
```

## ğŸ”§ æŠ€æœ¯å®ç°

### åç«¯æ”¯æŒ

åç«¯å·²ç»è¿”å›æ‰€éœ€å­—æ®µï¼Œæ— éœ€ä¿®æ”¹ï¼š
- `transferCount` - çº¿ç´¢æµè½¬æ¬¡æ•°
- `assignmentReason` - åˆ†é…åŸå› 
- è¿™äº›å­—æ®µé€šè¿‡ `.lean()` æŸ¥è¯¢è‡ªåŠ¨åŒ…å«åœ¨å“åº”ä¸­

### å‰ç«¯å®ç°

- ä½¿ç”¨ Ant Design çš„ `Tag` ç»„ä»¶æ˜¾ç¤ºæ ‡è¯†
- ä½¿ç”¨ `Space` ç»„ä»¶æ§åˆ¶é—´è·
- æ ·å¼ä¼˜åŒ–ï¼šå°å­—ä½“ã€ç´§å‡‘å¸ƒå±€

## ğŸ“Š å½±å“èŒƒå›´

### ä¿®æ”¹çš„æ–‡ä»¶
1. `frontend/src/types/customer.types.ts` - ç±»å‹å®šä¹‰
2. `frontend/src/pages/customers/CustomerList.tsx` - å®¢æˆ·åˆ—è¡¨ç»„ä»¶

### ä¸å—å½±å“çš„åŠŸèƒ½
- åç«¯ API æ— éœ€ä¿®æ”¹
- æ•°æ®åº“ç»“æ„æ— éœ€ä¿®æ”¹
- å…¶ä»–é¡µé¢ä¸å—å½±å“

## ğŸ§ª æµ‹è¯•å»ºè®®

### æµ‹è¯•åœºæ™¯

1. **æ–°åˆ›å»ºçš„çº¿ç´¢**
   - åˆ›å»ºæ–°å®¢æˆ·ï¼Œé»˜è®¤åˆ†é…ç»™åˆ›å»ºäºº
   - âœ… åº”è¯¥æ˜¾ç¤º NEW æ ‡è¯†

2. **æ‰‹åŠ¨åˆ†é…çš„çº¿ç´¢**
   - ç®¡ç†å‘˜æ‰‹åŠ¨åˆ†é…ç»™æŸä¸ªå‘˜å·¥
   - âŒ ä¸åº”è¯¥æ˜¾ç¤º NEW æ ‡è¯†

3. **è¢«è½®è½¬çš„çº¿ç´¢**
   - é€šè¿‡è‡ªåŠ¨æµè½¬è§„åˆ™è½®è½¬è¿‡çš„çº¿ç´¢
   - âŒ ä¸åº”è¯¥æ˜¾ç¤º NEW æ ‡è¯†

4. **ä»å…¬æµ·é¢†å–çš„çº¿ç´¢**
   - ä»å…¬æµ·é¢†å–çš„å®¢æˆ·
   - âŒ ä¸åº”è¯¥æ˜¾ç¤º NEW æ ‡è¯†ï¼ˆclaimCount > 0ï¼‰

### éªŒè¯æ­¥éª¤

1. ç™»å½• CRM ç³»ç»Ÿ
2. è¿›å…¥"å®¢æˆ·ç®¡ç†"é¡µé¢
3. æŸ¥çœ‹å®¢æˆ·åˆ—è¡¨ä¸­çš„å®¢æˆ·ç¼–å·åˆ—
4. ç¡®è®¤æ–°çº¿ç´¢æ˜¾ç¤ºç»¿è‰² NEW æ ‡è¯†
5. ç¡®è®¤å·²åˆ†é…/å·²è½®è½¬çš„çº¿ç´¢ä¸æ˜¾ç¤ºæ ‡è¯†

## ğŸš€ éƒ¨ç½²æ­¥éª¤ï¼ˆå·²å®Œæˆï¼‰

```bash
# 1. æ„å»ºå‰ç«¯
cd frontend && npm run build

# 2. é‡å¯ç”Ÿäº§ç¯å¢ƒ
pm2 restart frontend-prod

# 3. éªŒè¯æœåŠ¡çŠ¶æ€
pm2 logs frontend-prod --lines 20
```

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **æµè§ˆå™¨ç¼“å­˜**ï¼šç”¨æˆ·å¯èƒ½éœ€è¦æ¸…é™¤æµè§ˆå™¨ç¼“å­˜æˆ–å¼ºåˆ¶åˆ·æ–°ï¼ˆCtrl+F5ï¼‰æ‰èƒ½çœ‹åˆ°æ›´æ–°
2. **å…¼å®¹æ€§**ï¼šåŠŸèƒ½å‘åå…¼å®¹ï¼Œæ—§æ•°æ®å¦‚æœæ²¡æœ‰ `transferCount` å­—æ®µä¼šè¢«è§†ä¸º 0
3. **æ€§èƒ½**ï¼šæ ‡è¯†åˆ¤æ–­é€»è¾‘åœ¨å‰ç«¯æ‰§è¡Œï¼Œä¸å½±å“åç«¯æ€§èƒ½

## ğŸ”„ å›æ»šæ–¹æ¡ˆ

å¦‚éœ€å›æ»šï¼Œæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

```bash
# 1. æ¢å¤ä»£ç åˆ°ä¹‹å‰çš„ç‰ˆæœ¬
git checkout <previous-commit>

# 2. é‡æ–°æ„å»º
cd frontend && npm run build

# 3. é‡å¯æœåŠ¡
pm2 restart frontend-prod
```

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚

---

**éƒ¨ç½²å®Œæˆæ—¶é—´**: 2026-01-05 18:31:53  
**éƒ¨ç½²äººå‘˜**: AI Assistant  
**ç‰ˆæœ¬**: v1.0.0

