# 测试邀请功能隐藏 - 快速指南

## 🎯 测试目标

验证视频面试 H5 页面能够正确检测运行环境，并在小程序环境下隐藏邀请功能。

## 📋 测试准备

### 1. 确认文件已修改

以下文件已完成修改：
- ✅ `frontend/public/miniprogram/video-interview-host.html`
- ✅ `frontend/public/miniprogram/video-interview-guest-room.html`

### 2. 部署到服务器

确保修改后的文件已部署到服务器：
```bash
# 如果使用 PM2 部署
cd /home/ubuntu/andejiazhengcrm
pm2 restart frontend-prod

# 或者重新构建前端
cd frontend
npm run build
```

## 🧪 测试步骤

### 测试 1：环境检测测试页面

**目的**：验证环境检测功能是否正常工作

**步骤**：
1. 在浏览器中访问：`https://crm.andejiazheng.com/miniprogram/test-env-detection.html`
2. 查看页面显示的环境信息：
   - 是否在微信中：应该显示 **否**
   - 是否在小程序 WebView 中：应该显示 **否**
   - UserAgent：查看浏览器信息
3. 点击"测试邀请功能"按钮
   - 应该弹出：`浏览器环境：显示邀请链接弹窗`

**预期结果**：
```
✅ 是否在微信中：否
✅ 是否在小程序 WebView 中：否
✅ window.__wxjs_environment：(未定义)
✅ UserAgent：Mozilla/5.0 (Macintosh; ...) Chrome/...
✅ UserAgent 包含 miniProgram：否
```

---

### 测试 2：浏览器环境 - 主持人页面

**目的**：验证浏览器环境下邀请功能正常显示

**步骤**：
1. 在浏览器中访问：`https://crm.andejiazheng.com/miniprogram/video-interview-host.html`
2. 创建面试间
3. 查看远程视频位置（位置 2、3、4、5）
   - 应该显示 **+ 邀请用户** 按钮
4. 点击任意一个邀请按钮
   - 应该弹出邀请链接弹窗
   - 可以复制链接

**预期结果**：
```
✅ 控制台输出：✅ 浏览器环境，邀请按钮正常显示
✅ 显示邀请按钮（+ 邀请用户）
✅ 点击后弹出邀请链接弹窗
✅ 可以复制邀请链接
```

---

### 测试 3：小程序环境 - 主持人页面

**目的**：验证小程序环境下邀请功能被隐藏

**步骤**：
1. 在微信小程序中打开视频面试页面
2. 创建面试间
3. 查看远程视频位置（位置 2、3、4、5）
   - 邀请按钮应该 **被隐藏**
   - 显示空白占位符或其他参与者视频
4. 如果尝试点击空位置
   - 不应该有任何反应（因为按钮已隐藏）

**预期结果**：
```
✅ 控制台输出：✅ 已添加小程序环境标识，邀请按钮将被隐藏
✅ 邀请按钮不可见
✅ body 标签包含 class="miniprogram-env"
✅ 用户使用小程序分享功能邀请其他人
```

---

### 测试 4：浏览器环境 - 访客页面

**目的**：验证访客页面的邀请功能

**步骤**：
1. 在浏览器中访问访客页面（通过邀请链接）
2. 加入面试间
3. 查看远程视频位置
   - 应该显示 **+ 邀请用户** 按钮
4. 点击邀请按钮
   - 应该弹出邀请链接弹窗

**预期结果**：
```
✅ 显示邀请按钮
✅ 点击后弹出邀请链接弹窗
✅ 可以复制邀请链接
```

---

### 测试 5：小程序环境 - 访客页面

**目的**：验证小程序环境下访客页面的邀请功能被隐藏

**步骤**：
1. 在微信小程序中打开访客页面
2. 加入面试间
3. 查看远程视频位置
   - 邀请按钮应该 **被隐藏**

**预期结果**：
```
✅ 邀请按钮不可见
✅ 控制台输出环境检测信息
```

## 🔍 调试方法

### 查看控制台日志

在浏览器或微信开发者工具中打开控制台，查看以下日志：

**浏览器环境**：
```
🔍 环境检测:
  - 是否在微信中: false
  - 是否在小程序 WebView 中: false
  - UserAgent: Mozilla/5.0 ...
  - __wxjs_environment: undefined
✅ 浏览器环境，邀请按钮正常显示
```

**小程序环境**：
```
🔍 环境检测:
  - 是否在微信中: true
  - 是否在小程序 WebView 中: true
  - UserAgent: Mozilla/5.0 ... miniProgram/wx...
  - __wxjs_environment: miniprogram
✅ 已添加小程序环境标识，邀请按钮将被隐藏
💡 邀请功能将被隐藏（小程序环境使用分享功能）
```

### 检查 DOM 元素

在浏览器开发者工具中：

1. 检查 `<body>` 标签：
   - 小程序环境：`<body class="miniprogram-env">`
   - 浏览器环境：`<body>`

2. 检查邀请按钮元素：
   - 小程序环境：`display: none !important`
   - 浏览器环境：正常显示

## ✅ 测试检查清单

- [ ] 环境检测测试页面正常工作
- [ ] 浏览器环境下邀请按钮正常显示
- [ ] 浏览器环境下可以弹出邀请链接弹窗
- [ ] 浏览器环境下可以复制邀请链接
- [ ] 小程序环境下邀请按钮被隐藏
- [ ] 小程序环境下 body 包含 miniprogram-env class
- [ ] 控制台日志输出正确
- [ ] 主持人页面和访客页面都正常工作

## 🐛 常见问题

### 问题 1：小程序环境下邀请按钮仍然显示

**原因**：环境检测失败或 CSS 未生效

**解决方法**：
1. 检查控制台日志，确认 `IS_IN_MINIPROGRAM` 的值
2. 检查 `<body>` 标签是否包含 `miniprogram-env` class
3. 清除浏览器缓存，刷新页面

### 问题 2：浏览器环境下邀请按钮被隐藏

**原因**：环境检测误判

**解决方法**：
1. 检查控制台日志，确认环境检测结果
2. 确认 UserAgent 中不包含 `miniProgram` 字样
3. 确认 `window.__wxjs_environment` 为 `undefined`

### 问题 3：控制台没有日志输出

**原因**：脚本未加载或执行失败

**解决方法**：
1. 检查页面源代码，确认环境检测脚本存在
2. 检查浏览器控制台是否有 JavaScript 错误
3. 刷新页面重新加载

## 📞 需要帮助？

如果测试过程中遇到问题，请提供以下信息：
1. 测试环境（浏览器/小程序）
2. 控制台日志截图
3. 页面截图
4. UserAgent 信息

## 🎉 测试完成

完成所有测试后，确认：
- ✅ 环境检测功能正常
- ✅ 邀请功能在不同环境下表现正确
- ✅ 用户体验符合预期

恭喜！邀请功能隐藏已成功实现！

