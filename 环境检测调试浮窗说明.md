# 环境检测调试浮窗说明

## 📋 功能说明

为了帮助调试小程序环境下邀请按钮的显示问题，我添加了一个**环境检测调试浮窗**。

这个浮窗会在页面加载后自动显示，展示详细的环境检测信息和邀请按钮的实际状态。

## 🎯 浮窗显示内容

### 1. 环境状态
- **✅ 小程序环境** - 绿色显示，表示在小程序 WebView 中
- **🌐 浏览器环境** - 蓝色显示，表示在普通浏览器中

### 2. 检测变量
- **IS_WECHAT**: 是否在微信中（true/false）
- **IS_IN_MINIPROGRAM**: 是否在小程序 WebView 中（true/false）
- **__wxjs_environment**: 微信官方环境变量的值
- **UserAgent**: 完整的浏览器 UserAgent 字符串

### 3. DOM 状态
- **Body Class**: `<body>` 标签的 class 属性
  - 小程序环境应该包含 `miniprogram-env`
  - 浏览器环境应该为空或不包含 `miniprogram-env`

### 4. 邀请按钮状态
- **预期邀请按钮状态**: 根据环境检测结果，按钮应该显示还是隐藏
- **实际邀请按钮**: 页面中实际找到的邀请按钮数量和可见数量
  - 例如：`找到 4 个邀请按钮，0 个可见`（小程序环境）
  - 例如：`找到 4 个邀请按钮，4 个可见`（浏览器环境）

## 🔍 如何使用

### 自动显示
浮窗会在页面加载后 **1 秒自动显示**，无需手动操作。

### 手动调用
如果需要手动显示浮窗，可以在浏览器控制台执行：
```javascript
window.showEnvDebugPanel()
```

### 刷新信息
点击浮窗中的 **"刷新"** 按钮，可以重新检测并更新显示的信息。

### 关闭浮窗
点击浮窗中的 **"关闭"** 按钮，可以关闭浮窗。

## 🐛 问题诊断

### 问题 1：小程序环境下邀请按钮仍然显示

**检查步骤**：

1. **查看环境状态**
   - 浮窗顶部应该显示 **✅ 小程序环境**（绿色）
   - 如果显示 **🌐 浏览器环境**（蓝色），说明环境检测失败

2. **检查检测变量**
   - `IS_IN_MINIPROGRAM` 应该为 **✅ true**
   - `__wxjs_environment` 应该为 **miniprogram**
   - UserAgent 应该包含 **miniProgram** 字样

3. **检查 Body Class**
   - 应该包含 **miniprogram-env** class
   - 如果没有，说明 class 没有正确添加

4. **检查邀请按钮状态**
   - **预期状态** 应该显示：**❌ 应隐藏**
   - **实际邀请按钮** 应该显示：**找到 X 个邀请按钮，0 个可见**
   - 如果可见数量 > 0，说明 CSS 样式没有生效

### 问题 2：浏览器环境下邀请按钮被隐藏

**检查步骤**：

1. **查看环境状态**
   - 浮窗顶部应该显示 **🌐 浏览器环境**（蓝色）
   - 如果显示 **✅ 小程序环境**（绿色），说明环境检测误判

2. **检查检测变量**
   - `IS_IN_MINIPROGRAM` 应该为 **❌ false**
   - `__wxjs_environment` 应该为 **(undefined)**
   - UserAgent 不应该包含 **miniProgram** 字样

3. **检查 Body Class**
   - 不应该包含 **miniprogram-env** class

4. **检查邀请按钮状态**
   - **预期状态** 应该显示：**✅ 应显示**
   - **实际邀请按钮** 应该显示：**找到 X 个邀请按钮，X 个可见**

### 问题 3：浮窗没有显示

**可能原因**：
1. JavaScript 执行失败
2. 页面加载未完成
3. 浮窗被其他元素遮挡

**解决方法**：
1. 打开浏览器控制台，查看是否有 JavaScript 错误
2. 手动执行 `window.showEnvDebugPanel()` 显示浮窗
3. 检查浮窗的 z-index（应该是 99999）

## 📊 示例输出

### 小程序环境（正常）
```
✅ 小程序环境

IS_WECHAT: ✅ true
IS_IN_MINIPROGRAM: ✅ true
__wxjs_environment: miniprogram
UserAgent: Mozilla/5.0 ... miniProgram/wx...
Body Class: miniprogram-env
预期邀请按钮状态: ❌ 应隐藏
实际邀请按钮: 找到 4 个邀请按钮，0 个可见
```

### 浏览器环境（正常）
```
🌐 浏览器环境

IS_WECHAT: ❌ false
IS_IN_MINIPROGRAM: ❌ false
__wxjs_environment: (undefined)
UserAgent: Mozilla/5.0 ... Chrome/...
Body Class: (无)
预期邀请按钮状态: ✅ 应显示
实际邀请按钮: 找到 4 个邀请按钮，4 个可见
```

### 小程序环境（异常 - 按钮仍然显示）
```
✅ 小程序环境

IS_WECHAT: ✅ true
IS_IN_MINIPROGRAM: ✅ true
__wxjs_environment: miniprogram
UserAgent: Mozilla/5.0 ... miniProgram/wx...
Body Class: miniprogram-env
预期邀请按钮状态: ❌ 应隐藏
实际邀请按钮: 找到 4 个邀请按钮，4 个可见  ⚠️ 异常！
```

**如果出现上述异常情况**，说明：
- 环境检测正常（IS_IN_MINIPROGRAM = true）
- Body class 已正确添加（miniprogram-env）
- 但 CSS 样式没有生效（按钮仍然可见）

**可能的原因**：
1. CSS 样式被其他样式覆盖
2. 浏览器缓存问题
3. CSS 选择器优先级不够

**解决方法**：
1. 清除浏览器缓存，强制刷新页面（Ctrl+Shift+R 或 Cmd+Shift+R）
2. 检查 CSS 样式是否正确加载
3. 在浏览器开发者工具中检查 `.invite-placeholder` 元素的计算样式

## 🎯 调试流程

1. **打开视频面试页面**
   - 在小程序或浏览器中打开页面

2. **等待浮窗自动显示**
   - 页面加载后 1 秒会自动显示

3. **查看环境状态**
   - 确认环境检测是否正确

4. **检查邀请按钮状态**
   - 对比预期状态和实际状态

5. **如果发现异常**
   - 截图保存浮窗信息
   - 打开浏览器控制台查看日志
   - 检查 DOM 元素和 CSS 样式

6. **尝试刷新**
   - 点击"刷新"按钮重新检测
   - 或者刷新整个页面

## 📝 注意事项

1. **浮窗仅用于调试**
   - 生产环境可以考虑移除或添加开关控制

2. **不影响正常功能**
   - 浮窗只是显示信息，不会影响页面功能

3. **可以随时关闭**
   - 点击"关闭"按钮即可关闭浮窗

4. **支持多次调用**
   - 可以多次调用 `window.showEnvDebugPanel()` 刷新信息

## 🚀 下一步

如果通过浮窗发现了问题，请：
1. 截图保存浮窗信息
2. 记录控制台日志
3. 提供给开发人员进行进一步调试

这样可以快速定位问题，找到解决方案！

