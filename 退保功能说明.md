# é€€ä¿åŠŸèƒ½è¯´æ˜

## âœ… åŠŸèƒ½çŠ¶æ€

é€€ä¿åŠŸèƒ½**å·²å®Œæ•´å®ç°**ï¼ŒåŒ…æ‹¬ï¼š
- âœ… åç«¯æ¥å£ï¼ˆå·²å®ç°ï¼‰
- âœ… å‰ç«¯ç•Œé¢ï¼ˆåˆšåˆšæ·»åŠ ï¼‰

---

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

### åç«¯æ¥å£

**æ¥å£è·¯å¾„**: `POST /api/dashubao/policy/surrender`

**è¯·æ±‚å‚æ•°**:
```json
{
  "policyNo": "ä¿å•å·",
  "removeReason": "é€€ä¿åŸå› ä»£ç "
}
```

**é€€ä¿åŸå› ä»£ç **:
- `13` - é€€ç¥¨é€€ä¿
- `14` - èˆªç­å–æ¶ˆ
- `15` - èˆªç­æ”¹ç­¾

**å®ç°ä½ç½®**:
- Controller: `backend/src/modules/dashubao/dashubao.controller.ts` (ç¬¬136-144è¡Œ)
- Service: `backend/src/modules/dashubao/dashubao.service.ts` (ç¬¬600-622è¡Œ)
- DTO: `backend/src/modules/dashubao/dto/create-policy.dto.ts` (ç¬¬330-341è¡Œ)

---

## ğŸ¨ å‰ç«¯ç•Œé¢

### æ–°å¢åŠŸèƒ½

1. **é€€ä¿æŒ‰é’®**
   - ä½ç½®ï¼šä¿å•åˆ—è¡¨æ“ä½œåˆ—
   - æ˜¾ç¤ºæ¡ä»¶ï¼šä¿å•çŠ¶æ€ä¸º"å·²ç”Ÿæ•ˆ"ï¼ˆ`active`ï¼‰
   - å›¾æ ‡ï¼š`RollbackOutlined`ï¼ˆå›é€€å›¾æ ‡ï¼‰
   - é¢œè‰²ï¼šçº¢è‰²ï¼ˆdangerï¼‰

2. **é€€ä¿å¼¹çª—**
   - æ˜¾ç¤ºä¿å•ä¿¡æ¯ï¼ˆä¿å•å·ã€è¢«ä¿é™©äººã€æ€»ä¿è´¹ï¼‰
   - é€€ä¿åŸå› é€‰æ‹©ï¼ˆå•é€‰æ¡†ï¼‰
     - é€€ç¥¨é€€ä¿
     - èˆªç­å–æ¶ˆ
     - èˆªç­æ”¹ç­¾
   - ç¡®è®¤/å–æ¶ˆæŒ‰é’®

3. **é€€ä¿æµç¨‹**
   ```
   ç‚¹å‡»é€€ä¿æŒ‰é’®
       â†“
   å¼¹å‡ºé€€ä¿ç¡®è®¤çª—å£
       â†“
   é€‰æ‹©é€€ä¿åŸå› 
       â†“
   ç‚¹å‡»"ç¡®è®¤é€€ä¿"
       â†“
   è°ƒç”¨åç«¯æ¥å£
       â†“
   æ›´æ–°ä¿å•çŠ¶æ€ä¸º"å·²é€€ä¿"
       â†“
   åˆ·æ–°ä¿å•åˆ—è¡¨
   ```

---

## ğŸ” ä¸æ³¨é”€çš„åŒºåˆ«

| åŠŸèƒ½ | æ³¨é”€ï¼ˆCancelï¼‰ | é€€ä¿ï¼ˆSurrenderï¼‰ |
|------|---------------|------------------|
| **é€‚ç”¨çŠ¶æ€** | å¾…æ”¯ä»˜ï¼ˆpendingï¼‰ | å·²ç”Ÿæ•ˆï¼ˆactiveï¼‰ |
| **æ¥å£ä»£ç ** | 0004 | 0014 |
| **æŒ‰é’®å›¾æ ‡** | CloseCircleOutlined | RollbackOutlined |
| **æ˜¯å¦éœ€è¦åŸå› ** | å¦ | æ˜¯ï¼ˆå¿…é€‰ï¼‰ |
| **æœ€ç»ˆçŠ¶æ€** | cancelled | surrendered |

---

## ğŸ“ ä»£ç ä¿®æ”¹è¯¦æƒ…

### 1. å‰ç«¯æ–‡ä»¶ä¿®æ”¹ï¼ˆ`frontend/src/pages/insurance/InsuranceList.tsx`ï¼‰

#### å¯¼å…¥æ–°ç»„ä»¶
```typescript
import {
  // ... å…¶ä»–å¯¼å…¥
  Radio,
  Form,
} from 'antd';
import {
  // ... å…¶ä»–å›¾æ ‡
  RollbackOutlined,
} from '@ant-design/icons';
```

#### æ–°å¢çŠ¶æ€
```typescript
const [surrenderModalVisible, setSurrenderModalVisible] = useState(false);
const [surrenderPolicy, setSurrenderPolicy] = useState<InsurancePolicy | null>(null);
const [surrenderForm] = Form.useForm();
```

#### æ–°å¢å¤„ç†å‡½æ•°
```typescript
// æ‰“å¼€é€€ä¿å¼¹çª—
const handleOpenSurrender = (record: InsurancePolicy) => {
  setSurrenderPolicy(record);
  setSurrenderModalVisible(true);
  surrenderForm.resetFields();
};

// é€€ä¿
const handleSurrender = async () => {
  try {
    const values = await surrenderForm.validateFields();
    const result = await insuranceService.surrenderPolicy({
      policyNo: surrenderPolicy.policyNo,
      removeReason: values.removeReason,
    });

    if (result.Success === 'true') {
      message.success('é€€ä¿æˆåŠŸ');
      setSurrenderModalVisible(false);
      loadPolicies();
    } else {
      message.error(result.Message || 'é€€ä¿å¤±è´¥');
    }
  } catch (error: any) {
    message.error(error.message || 'é€€ä¿å¤±è´¥');
  }
};
```

#### æ–°å¢é€€ä¿æŒ‰é’®
```typescript
{record.status === PolicyStatus.ACTIVE && (
  <Tooltip title="é€€ä¿">
    <Button
      type="link"
      size="small"
      danger
      icon={<RollbackOutlined />}
      onClick={() => handleOpenSurrender(record)}
    />
  </Tooltip>
)}
```

#### æ–°å¢é€€ä¿å¼¹çª—
```typescript
<Modal
  title="é€€ä¿ç”³è¯·"
  open={surrenderModalVisible}
  onOk={handleSurrender}
  onCancel={() => setSurrenderModalVisible(false)}
  okText="ç¡®è®¤é€€ä¿"
  cancelText="å–æ¶ˆ"
  okButtonProps={{ danger: true }}
>
  <Form form={surrenderForm} layout="vertical">
    <Form.Item label="ä¿å•ä¿¡æ¯">
      <Descriptions bordered column={1} size="small">
        <Descriptions.Item label="ä¿å•å·">{surrenderPolicy?.policyNo}</Descriptions.Item>
        <Descriptions.Item label="è¢«ä¿é™©äºº">
          {surrenderPolicy?.insuredList?.map(i => i.insuredName).join(', ')}
        </Descriptions.Item>
        <Descriptions.Item label="æ€»ä¿è´¹">Â¥{surrenderPolicy?.totalPremium?.toFixed(2)}</Descriptions.Item>
      </Descriptions>
    </Form.Item>
    <Form.Item
      name="removeReason"
      label="é€€ä¿åŸå› "
      rules={[{ required: true, message: 'è¯·é€‰æ‹©é€€ä¿åŸå› ' }]}
    >
      <Radio.Group>
        <Radio value="13">é€€ç¥¨é€€ä¿</Radio>
        <Radio value="14">èˆªç­å–æ¶ˆ</Radio>
        <Radio value="15">èˆªç­æ”¹ç­¾</Radio>
      </Radio.Group>
    </Form.Item>
  </Form>
</Modal>
```

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

1. **åˆ·æ–°é¡µé¢**ï¼ˆæ¸…é™¤ç¼“å­˜ï¼‰

2. **æ‰¾åˆ°å·²ç”Ÿæ•ˆçš„ä¿å•**
   - çŠ¶æ€ä¸º"å·²ç”Ÿæ•ˆ"ï¼ˆç»¿è‰²æ ‡ç­¾ï¼‰

3. **ç‚¹å‡»é€€ä¿æŒ‰é’®**
   - æ“ä½œåˆ—ä¸­çš„çº¢è‰²å›é€€å›¾æ ‡

4. **é€‰æ‹©é€€ä¿åŸå› **
   - é€€ç¥¨é€€ä¿
   - èˆªç­å–æ¶ˆ
   - èˆªç­æ”¹ç­¾

5. **ç¡®è®¤é€€ä¿**
   - ç‚¹å‡»"ç¡®è®¤é€€ä¿"æŒ‰é’®
   - ç­‰å¾…æ¥å£è¿”å›

6. **æŸ¥çœ‹ç»“æœ**
   - æˆåŠŸï¼šä¿å•çŠ¶æ€å˜ä¸º"å·²é€€ä¿"
   - å¤±è´¥ï¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **åªæœ‰å·²ç”Ÿæ•ˆçš„ä¿å•æ‰èƒ½é€€ä¿**
   - å¾…æ”¯ä»˜ä¿å•ä½¿ç”¨"æ³¨é”€"åŠŸèƒ½
   - å·²é€€ä¿/å·²æ³¨é”€ä¿å•ä¸èƒ½å†æ¬¡æ“ä½œ

2. **é€€ä¿åŸå› å¿…é€‰**
   - æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©åˆé€‚çš„åŸå› 

3. **é€€ä¿ä¸å¯æ’¤é”€**
   - é€€ä¿åä¿å•çŠ¶æ€å˜ä¸º"å·²é€€ä¿"
   - æ— æ³•æ¢å¤

4. **é€€ä¿è´¹ç”¨**
   - å…·ä½“é€€ä¿è´¹ç”¨ç”±å¤§æ ‘ä¿è®¡ç®—
   - å¯èƒ½ä¸æ˜¯å…¨é¢é€€æ¬¾

---

## ğŸ‰ æ€»ç»“

âœ… é€€ä¿åŠŸèƒ½å·²å®Œæ•´å®ç°
âœ… å‰ç«¯ç•Œé¢å·²æ·»åŠ 
âœ… å‰ç«¯å·²ç¼–è¯‘å®Œæˆ
ğŸš€ åˆ·æ–°é¡µé¢å³å¯ä½¿ç”¨

